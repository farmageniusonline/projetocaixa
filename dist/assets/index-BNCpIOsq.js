import{r as e,b as t,R as r}from"./vendor-Bv3D8o60.js";import{C as a,T as s,z as n,E as o,D as i,F as c,a as l,Z as d,L as u,b as m}from"./ui-BIUt_rIB.js";import{c as h,D as p}from"./database-DtHO001A.js";import{o as g,s as x,p as f,a as y,$ as b,b as v,c as _,d as w,u as j,e as N,n as S,_ as k}from"./forms-BWTEYwRY.js";import{u as C,N as D,R as I,a as E,B as T}from"./router-DTIirpx0.js";import{r as M,u as B,w as O,S as $}from"./excel-DmnQR-ck.js";import{w as F,r as L}from"./workers-CJVFC4Kr.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var R={exports:{}},A={},V=e,z=Symbol.for("react.element"),U=Symbol.for("react.fragment"),P=Object.prototype.hasOwnProperty,q=V.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,H={key:!0,ref:!0,__self:!0,__source:!0};function W(e,t,r){var a,s={},n=null,o=null;for(a in void 0!==r&&(n=""+r),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(o=t.ref),t)P.call(t,a)&&!H.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===s[a]&&(s[a]=t[a]);return{$$typeof:z,type:e,key:n,ref:o,props:s,_owner:q.current}}A.Fragment=U,A.jsx=W,A.jsxs=W,R.exports=A;var J,X=R.exports,K=t;J=K.createRoot,K.hydrateRoot;const Y=h("https://artgvpolienazfaalwtk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFydGd2cG9saWVuYXpmYWFsd3RrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxMDEwOTMsImV4cCI6MjA3MzY3NzA5M30.h7MDx9CLxFte-OJCoLcfcsRoo15gDEtp9B8nUJLYJIg",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:window.localStorage},db:{schema:"public"},global:{headers:{"x-application":"farmageniuscaixa"}}}),G=async(e,t)=>{const{data:r,error:a}=await Y.rpc("search_transactions_by_value",{p_user_id:e,p_value:t});return{data:r,error:a}},Z=async(e,t)=>{const{data:r,error:a}=await Y.rpc("transfer_to_conference",{p_user_id:e,p_transaction_id:t});return{data:r,error:a}},Q=async(e,t)=>{const{data:r,error:a}=await Y.rpc("remove_from_conference",{p_user_id:e,p_conference_id:t});return{data:r,error:a}},ee=async(e,t,r)=>{const{data:a,error:s}=await Y.rpc("register_not_found",{p_user_id:e,p_searched_value:t,p_normalized_value:r});return{data:a,error:s}},te=async e=>{const{data:t,error:r}=await Y.rpc("get_user_stats",{p_user_id:e});return{data:t,error:r}},re=async e=>{const{data:t,error:r}=await Y.rpc("restart_work_day",{p_user_id:e});return{data:t,error:r}},ae=async(e,t,r)=>{const a=r.map((r,a)=>({file_id:t,user_id:e,transaction_date:r.date,payment_type:r.paymentType,cpf:r.cpf,value:r.value,original_history:r.originalHistory,row_index:a,original_data:r})),{data:s,error:n}=await Y.from("banking_transactions").insert(a).select();return{data:s,error:n}},se=async e=>{const{data:t,error:r}=await Y.from("cash_conferences").select("*").eq("user_id",e).eq("conference_status","active").order("conference_date",{ascending:!1});return{data:t,error:r}},ne=async e=>{const{data:t,error:r}=await Y.from("not_found_history").select("*").eq("user_id",e).eq("status","not_found").order("search_timestamp",{ascending:!1});return{data:t,error:r}},oe={debug:0,info:1,warn:2,error:3,silent:4};function ie(e){const t=(t,r,a,...s)=>{if(n=e.level,!(oe[t]>=oe[n]))return;var n;const o=function(e,t,r,...a){return[[r.enableTimestamp?`[${(new Date).toISOString()}]`:"",r.prefix?`[${r.prefix}]`:"",`[${e.toUpperCase()}]`,t].filter(Boolean).join(" "),...a]}(t,a,e,...s);if(e.enableStackTrace&&"error"===t){const e=(new Error).stack;o.push("\nStack trace:",e)}r(...o)};return{debug:(e,...r)=>t("debug",console.log,e,...r),info:(e,...r)=>t("info",console.info,e,...r),warn:(e,...r)=>t("warn",console.warn,e,...r),error:(e,...r)=>t("error",console.error,e,...r)}}const ce={level:"error",enableTimestamp:!1,enableStackTrace:!0,prefix:"APP"},le=ie(ce),de=(e,t)=>ie({...ce,...t,prefix:e});de("PERF",{level:"silent"}),de("WORKER",{level:"warn"});const ue=de("AUTH",{level:"info",enableTimestamp:!0});de("DB",{level:"error"});const me=e.createContext(void 0),he=({children:t})=>{const[r,a]=e.useState(()=>{ue.debug("Initializing user state");try{if("undefined"==typeof window)return null;const e=localStorage.getItem("auth_user");if(e){const t=JSON.parse(e);if(t&&"object"==typeof t&&t.username)return t}return null}catch(e){try{localStorage.removeItem("auth_user")}catch{}return null}}),[s,n]=e.useState(!0),[o,i]=e.useState(""),c=async()=>{try{await Y.auth.signOut()}catch(e){}a(null),localStorage.removeItem("auth_user"),localStorage.removeItem("dashboard_filters")};e.useEffect(()=>{if(r){n(!1);try{Y.auth.getSession().then(({data:{session:e}})=>{e?.user||c()}).catch(e=>{})}catch(e){}}else{try{Y.auth.getSession().then(({data:{session:e}})=>{e?.user&&Y.from("profiles").select("*").eq("id",e.user.id).single().then(({data:t})=>{const r={username:t?.username||e.user.email?.split("@")[0]||"user",id:e.user.id,email:e.user.email,profile:t};a(r),localStorage.setItem("auth_user",JSON.stringify(r))}),n(!1)}).catch(e=>{n(!1)})}catch(e){n(!1)}try{const{data:{subscription:e}}=Y.auth.onAuthStateChange(async(e,t)=>{if("SIGNED_IN"===e&&t?.user){const{data:e}=await Y.from("profiles").select("*").eq("id",t.user.id).single(),r={username:e?.username||t.user.email?.split("@")[0]||"user",id:t.user.id,email:t.user.email,profile:e};a(r),localStorage.setItem("auth_user",JSON.stringify(r))}else"SIGNED_OUT"===e&&(a(null),localStorage.removeItem("auth_user"),localStorage.removeItem("dashboard_filters"));n(!1)});return()=>e.unsubscribe()}catch(e){}}},[]);const l={user:r,isLoading:s,loginError:o,login:async(e,t)=>{n(!0),i("");try{const{data:r,error:s}=await Y.auth.signInWithPassword({email:e.includes("@")?e:`${e}@manipularium.com`,password:t});if(s)return i("Senha ou Usuario Incorretos"),!1;if(r.user){let{data:e,error:t}=await Y.from("profiles").select("*").eq("id",r.user.id).single();if(t&&"PGRST116"===t.code){const{data:t,error:a}=await Y.from("profiles").insert({id:r.user.id,username:r.user.email?.split("@")[0]||"user",full_name:r.user.user_metadata?.full_name||r.user.email?.split("@")[0],role:"user"}).select().single();e=a?{id:r.user.id,username:r.user.email?.split("@")[0]||"user",full_name:r.user.email?.split("@")[0]||"user",role:"user"}:t}const s={username:e?.username||r.user.email?.split("@")[0]||"user",id:r.user.id,email:r.user.email,profile:e};return a(s),localStorage.setItem("auth_user",JSON.stringify(s)),!0}return i("Senha ou Usuario Incorretos"),!1}catch(r){return i("Senha ou Usuario Incorretos"),!1}finally{n(!1)}},logout:c,clearLoginError:()=>{i("")}};return X.jsx(me.Provider,{value:l,children:t})},pe=()=>{const t=e.useContext(me);if(void 0===t)throw new Error("useAuth must be used within an AuthProvider");return t};function ge(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function xe(e,t){for(var r={};e.length;){var a=e[0],s=a.code,n=a.message,o=a.path.join(".");if(!r[o])if("unionErrors"in a){var i=a.unionErrors[0].errors[0];r[o]={message:i.message,type:i.code}}else r[o]={message:n,type:s};if("unionErrors"in a&&a.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),t){var c=r[o].types,l=c&&c[a.code];r[o]=v(o,t,r,s,l?[].concat(l,a.message):a.message)}e.shift()}return r}function fe(e,t){for(var r={};e.length;){var a=e[0],s=a.code,n=a.message,o=a.path.join(".");if(!r[o])if("invalid_union"===a.code&&a.errors.length>0){var i=a.errors[0][0];r[o]={message:i.message,type:i.code}}else r[o]={message:n,type:s};if("invalid_union"===a.code&&a.errors.forEach(function(t){return t.forEach(function(t){return e.push(t)})}),t){var c=r[o].types,l=c&&c[a.code];r[o]=v(o,t,r,s,l?[].concat(l,a.message):a.message)}e.shift()}return r}function ye(e,t,r){if(void 0===r&&(r={}),"_def"in(a=e)&&"object"==typeof a._def&&"typeName"in a._def)return function(s,n,o){try{return Promise.resolve(ge(function(){return Promise.resolve(e["sync"===r.mode?"parse":"parseAsync"](s,t)).then(function(e){return o.shouldUseNativeValidation&&g({},o),{errors:{},values:r.raw?Object.assign({},s):e}})},function(e){if(function(e){return Array.isArray(null==e?void 0:e.issues)}(e))return{values:{},errors:x(xe(e.errors,!o.shouldUseNativeValidation&&"all"===o.criteriaMode),o)};throw e}))}catch(a){return Promise.reject(a)}};var a;if(function(e){return"_zod"in e&&"object"==typeof e._zod}(e))return function(s,n,o){try{return Promise.resolve(ge(function(){return Promise.resolve(("sync"===r.mode?f:y)(e,s,t)).then(function(e){return o.shouldUseNativeValidation&&g({},o),{errors:{},values:r.raw?Object.assign({},s):e}})},function(e){if(function(e){return e instanceof b}(e))return{values:{},errors:x(fe(e.issues,!o.shouldUseNativeValidation&&"all"===o.criteriaMode),o)};throw e}))}catch(a){return Promise.reject(a)}};throw new Error("Invalid input: not a Zod schema")}const be=_({username:w().min(1,"Nome de usuário é obrigatório").min(3,"Nome de usuário deve ter pelo menos 3 caracteres"),password:w().min(1,"Senha é obrigatória").min(6,"Senha deve ter pelo menos 6 caracteres")}),ve=le.createModule("SECURITY");function _e(e){return"string"!=typeof e?(ve.warn("Non-string input passed to sanitizeHtml",{input:typeof e}),String(e)):e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/<object\b[^<]*(?:(?!<\/object>)<[^<]*)*<\/object>/gi,"").replace(/<embed\b[^<]*(?:(?!<\/embed>)<[^<]*)*<\/embed>/gi,"").replace(/<link\b[^<]*>/gi,"").replace(/<meta\b[^<]*>/gi,"").replace(/javascript:/gi,"").replace(/data:text\/html/gi,"").replace(/on\w+\s*=/gi,"").replace(/style\s*=/gi,"").trim()}function we(e,t=1e3){return"string"!=typeof e?(ve.warn("Non-string input passed to sanitizeText",{input:typeof e}),""):_e(e).replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").substring(0,t).trim()}const je=new Map;function Ne(e,t={}){const{type:r="text",maxLength:a=1e3,allowHtml:s=!1,strictMode:n=!0}=t;let o="string"==typeof e?e:String(e||"");if(n&&!function(e,t=100,r=6e4){const a=Date.now(),s=`rate_limit_${e}`,n=je.get(s);return!n||a-n.lastReset>r?(je.set(s,{count:1,lastReset:a}),!0):n.count>=t?(ve.warn("Rate limit exceeded",{identifier:e,count:n.count}),!1):(n.count++,!0)}(`sanitize_${r}`,1e3,6e4))return"";if(n){const e=function(e){const t=[];if("string"!=typeof e)return t.push("Non-string input"),{isSafe:!1,violations:t};const r=[{pattern:/<script/gi,type:"XSS script tag"},{pattern:/javascript:/gi,type:"JavaScript protocol"},{pattern:/on\w+\s*=/gi,type:"Event handler"},{pattern:/\bUNION\b.*\bSELECT\b/gi,type:"SQL injection"},{pattern:/\bDROP\b.*\bTABLE\b/gi,type:"SQL DROP command"},{pattern:/\.\.\//gi,type:"Directory traversal"},{pattern:/\${.*}/g,type:"Template injection"},{pattern:/<%.*%>/g,type:"Server-side template"}];for(const{pattern:a,type:s}of r)a.test(e)&&(t.push(s),ve.warn("Dangerous pattern detected",{type:s,input:e.substring(0,100)}));return{isSafe:0===t.length,violations:t}}(o);if(!e.isSafe)return ve.error("Unsafe input blocked",{violations:e.violations}),""}switch(r){case"html":return s?we(o,a):_e(o).substring(0,a);case"email":return function(e){return"string"!=typeof e?"":e.replace(/[^a-zA-Z0-9@._-]/g,"").toLowerCase().substring(0,254).trim()}(o);case"url":return function(e){if("string"!=typeof e)return"";try{const t=new URL(e);return["http:","https:","mailto:","tel:"].includes(t.protocol)?e.replace(/javascript:/gi,"").replace(/data:/gi,"").replace(/vbscript:/gi,"").substring(0,2048):(ve.warn("Dangerous URL protocol blocked",{protocol:t.protocol}),"")}catch{return ve.warn("Invalid URL format sanitized",{input:e.substring(0,100)}),""}}(o);case"cpf":return function(e){return"string"!=typeof e?"":e.replace(/[^\d.-]/g,"").substring(0,14).trim()}(o);case"cnpj":return function(e){return"string"!=typeof e?"":e.replace(/[^\d./-]/g,"").substring(0,18).trim()}(o);case"currency":return function(e){return"string"!=typeof e?"0":e.replace(/[^\d,.-]/g,"").replace(/,/g,".").substring(0,20).trim()}(o);case"phone":return function(e){return"string"!=typeof e?"":e.replace(/[^\d()+-\s]/g,"").substring(0,20).trim()}(o);case"filename":return function(e){return"string"!=typeof e?"untitled":e.replace(/[<>:"/\\|?*\x00-\x1f]/g,"").replace(/^\.+/,"").substring(0,255).trim()||"untitled"}(o);case"date":return function(e){return"string"!=typeof e?"":e.replace(/[^\d/]/g,"").substring(0,10).trim()}(o);default:return we(o,a)}}const Se="/assets/ManipulariumLogo-8slJorZ1.png",ke=()=>{const e=C(),{login:t,isLoading:r,loginError:a,clearLoginError:s}=pe(),{register:n,handleSubmit:o,formState:{errors:i}}=j({resolver:ye(be)}),c=async r=>{s();const a=Ne(r.username,{type:"text",maxLength:100,strictMode:!0}),n=Ne(r.password,{type:"text",maxLength:200,strictMode:!0});if(!a||!n)return;await t(a,n)&&e("/dashboard")};try{return X.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 to-black px-4 py-12",children:X.jsxs("div",{className:"w-full max-w-md space-y-8",children:[X.jsxs("div",{className:"text-center",children:[X.jsx("div",{className:"mx-auto mb-6",children:X.jsx("img",{src:Se,alt:"Manipularium Logo",className:"h-24 w-24 mx-auto drop-shadow-lg",style:{backgroundColor:"transparent"}})}),X.jsx("h2",{className:"text-3xl font-bold text-gray-100",children:"Manipularium"}),X.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Conferência Bancária - Acesso Restrito"})]}),X.jsx("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 px-6 py-8",children:X.jsxs("form",{className:"space-y-6",onSubmit:o(c),children:[X.jsxs("div",{children:[X.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-300 mb-2",children:"Nome de usuário"}),X.jsx("input",{...n("username"),id:"username",name:"username",type:"text",autoComplete:"username","aria-describedby":i.username?"username-error":void 0,className:"w-full px-3 py-2 border rounded-md shadow-sm bg-gray-700 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors "+(i.username?"border-red-400":"border-gray-600"),placeholder:"Digite seu nome de usuário"}),i.username&&X.jsx("p",{id:"username-error",className:"mt-1 text-sm text-red-400",role:"alert",children:i.username.message})]}),X.jsxs("div",{children:[X.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-2",children:"Senha"}),X.jsx("input",{...n("password"),id:"password",name:"password",type:"password",autoComplete:"current-password","aria-describedby":i.password?"password-error":void 0,className:"w-full px-3 py-2 border rounded-md shadow-sm bg-gray-700 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors "+(i.password?"border-red-400":"border-gray-600"),placeholder:"Digite sua senha"}),i.password&&X.jsx("p",{id:"password-error",className:"mt-1 text-sm text-red-400",role:"alert",children:i.password.message})]}),a&&X.jsx("div",{className:"bg-red-900/20 border border-red-400 rounded-md p-3",children:X.jsx("p",{className:"text-sm text-red-400",role:"alert",children:a})}),X.jsx("button",{type:"submit",disabled:r,className:"w-full flex justify-center items-center py-2.5 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:r?X.jsxs(X.Fragment,{children:[X.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[X.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),X.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Entrando..."]}):"Entrar"})]})})]})})}catch(l){return X.jsxs("div",{className:"min-h-screen bg-red-500 flex items-center justify-center text-white",children:["Error rendering LoginForm: ",String(l)]})}},Ce=({children:e})=>{const{user:t}=pe();return t?X.jsx(X.Fragment,{children:e}):X.jsx(D,{to:"/",replace:!0})};function De(){return De=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},De.apply(null,arguments)}function Ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e,t){return Ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ee(e,t)}var Te=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function Me(e,t){return e===t||!(!Te(e)||!Te(t))}function Be(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!Me(e[r],t[r]))return!1;return!0}function Oe(e,t){var r;void 0===t&&(t=Be);var a,s=[],n=!1;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return n&&r===this&&t(o,s)||(a=e.apply(this,o),n=!0,r=this,s=o),a}}var $e="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function Fe(e){cancelAnimationFrame(e.id)}var Le=-1;function Re(e){if(void 0===e&&(e=!1),-1===Le||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(t),Le=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return Le}var Ae=null;function Ve(e){if(void 0===e&&(e=!1),null===Ae||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var a=document.createElement("div"),s=a.style;return s.width="100px",s.height="100px",t.appendChild(a),document.body.appendChild(t),t.scrollLeft>0?Ae="positive-descending":(t.scrollLeft=1,Ae=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),Ae}return Ae}var ze=function(e,t){return e};function Ue(t){var r,a=t.getItemOffset,s=t.getEstimatedTotalSize,n=t.getItemSize,o=t.getOffsetForIndexAndAlignment,i=t.getStartIndexForOffset,c=t.getStopIndexForStartIndex,l=t.initInstanceProps,d=t.shouldResetStyleCacheOnItemSizeChange,u=t.validateProps;return r=function(t){function r(e){var r;return(r=t.call(this,e)||this)._instanceProps=l(r.props,Ie(r)),r._outerRef=void 0,r._resetIsScrollingTimeoutId=null,r.state={instance:Ie(r),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof r.props.initialScrollOffset?r.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},r._callOnItemsRendered=void 0,r._callOnItemsRendered=Oe(function(e,t,a,s){return r.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:a,visibleStopIndex:s})}),r._callOnScroll=void 0,r._callOnScroll=Oe(function(e,t,a){return r.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:a})}),r._getItemStyle=void 0,r._getItemStyle=function(e){var t,s=r.props,o=s.direction,i=s.itemSize,c=s.layout,l=r._getItemStyleCache(d&&i,d&&c,d&&o);if(l.hasOwnProperty(e))t=l[e];else{var u=a(r.props,e,r._instanceProps),m=n(r.props,e,r._instanceProps),h="horizontal"===o||"horizontal"===c,p="rtl"===o,g=h?u:0;l[e]=t={position:"absolute",left:p?void 0:g,right:p?g:void 0,top:h?0:u,height:h?"100%":m,width:h?m:"100%"}}return t},r._getItemStyleCache=void 0,r._getItemStyleCache=Oe(function(e,t,r){return{}}),r._onScrollHorizontal=function(e){var t=e.currentTarget,a=t.clientWidth,s=t.scrollLeft,n=t.scrollWidth;r.setState(function(e){if(e.scrollOffset===s)return null;var t=r.props.direction,o=s;if("rtl"===t)switch(Ve()){case"negative":o=-s;break;case"positive-descending":o=n-a-s}return o=Math.max(0,Math.min(o,n-a)),{isScrolling:!0,scrollDirection:e.scrollOffset<s?"forward":"backward",scrollOffset:o,scrollUpdateWasRequested:!1}},r._resetIsScrollingDebounced)},r._onScrollVertical=function(e){var t=e.currentTarget,a=t.clientHeight,s=t.scrollHeight,n=t.scrollTop;r.setState(function(e){if(e.scrollOffset===n)return null;var t=Math.max(0,Math.min(n,s-a));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}},r._resetIsScrollingDebounced)},r._outerRefSetter=function(e){var t=r.props.outerRef;r._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},r._resetIsScrollingDebounced=function(){var e,t,a,s;null!==r._resetIsScrollingTimeoutId&&Fe(r._resetIsScrollingTimeoutId),r._resetIsScrollingTimeoutId=(e=r._resetIsScrolling,t=150,a=$e(),s={id:requestAnimationFrame(function r(){$e()-a>=t?e.call(null):s.id=requestAnimationFrame(r)})})},r._resetIsScrolling=function(){r._resetIsScrollingTimeoutId=null,r.setState({isScrolling:!1},function(){r._getItemStyleCache(-1,null)})},r}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ee(e,t)}(r,t),r.getDerivedStateFromProps=function(e,t){return Pe(e,t),u(e),null};var m=r.prototype;return m.scrollTo=function(e){e=Math.max(0,e),this.setState(function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},m.scrollToItem=function(e,t){void 0===t&&(t="auto");var r=this.props,a=r.itemCount,s=r.layout,n=this.state.scrollOffset;e=Math.max(0,Math.min(e,a-1));var i=0;if(this._outerRef){var c=this._outerRef;i="vertical"===s?c.scrollWidth>c.clientWidth?Re():0:c.scrollHeight>c.clientHeight?Re():0}this.scrollTo(o(this.props,e,t,n,this._instanceProps,i))},m.componentDidMount=function(){var e=this.props,t=e.direction,r=e.initialScrollOffset,a=e.layout;if("number"==typeof r&&null!=this._outerRef){var s=this._outerRef;"horizontal"===t||"horizontal"===a?s.scrollLeft=r:s.scrollTop=r}this._callPropsCallbacks()},m.componentDidUpdate=function(){var e=this.props,t=e.direction,r=e.layout,a=this.state,s=a.scrollOffset;if(a.scrollUpdateWasRequested&&null!=this._outerRef){var n=this._outerRef;if("horizontal"===t||"horizontal"===r)if("rtl"===t)switch(Ve()){case"negative":n.scrollLeft=-s;break;case"positive-ascending":n.scrollLeft=s;break;default:var o=n.clientWidth,i=n.scrollWidth;n.scrollLeft=i-o-s}else n.scrollLeft=s;else n.scrollTop=s}this._callPropsCallbacks()},m.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&Fe(this._resetIsScrollingTimeoutId)},m.render=function(){var t=this.props,r=t.children,a=t.className,n=t.direction,o=t.height,i=t.innerRef,c=t.innerElementType,l=t.innerTagName,d=t.itemCount,u=t.itemData,m=t.itemKey,h=void 0===m?ze:m,p=t.layout,g=t.outerElementType,x=t.outerTagName,f=t.style,y=t.useIsScrolling,b=t.width,v=this.state.isScrolling,_="horizontal"===n||"horizontal"===p,w=_?this._onScrollHorizontal:this._onScrollVertical,j=this._getRangeToRender(),N=j[0],S=j[1],k=[];if(d>0)for(var C=N;C<=S;C++)k.push(e.createElement(r,{data:u,key:h(C,u),index:C,isScrolling:y?v:void 0,style:this._getItemStyle(C)}));var D=s(this.props,this._instanceProps);return e.createElement(g||x||"div",{className:a,onScroll:w,ref:this._outerRefSetter,style:De({position:"relative",height:o,width:b,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:n},f)},e.createElement(c||l||"div",{children:k,ref:i,style:{height:_?"100%":D,pointerEvents:v?"none":void 0,width:_?D:"100%"}}))},m._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],r=e[1],a=e[2],s=e[3];this._callOnItemsRendered(t,r,a,s)}if("function"==typeof this.props.onScroll){var n=this.state,o=n.scrollDirection,i=n.scrollOffset,c=n.scrollUpdateWasRequested;this._callOnScroll(o,i,c)}},m._getRangeToRender=function(){var e=this.props,t=e.itemCount,r=e.overscanCount,a=this.state,s=a.isScrolling,n=a.scrollDirection,o=a.scrollOffset;if(0===t)return[0,0,0,0];var l=i(this.props,o,this._instanceProps),d=c(this.props,l,o,this._instanceProps),u=s&&"backward"!==n?1:Math.max(1,r),m=s&&"forward"!==n?1:Math.max(1,r);return[Math.max(0,l-u),Math.max(0,Math.min(t-1,d+m)),l,d]},r}(e.PureComponent),r.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},r}var Pe=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},qe=Ue({getItemOffset:function(e,t){return t*e.itemSize},getItemSize:function(e,t){return e.itemSize},getEstimatedTotalSize:function(e){var t=e.itemCount;return e.itemSize*t},getOffsetForIndexAndAlignment:function(e,t,r,a,s,n){var o=e.direction,i=e.height,c=e.itemCount,l=e.itemSize,d=e.layout,u=e.width,m="horizontal"===o||"horizontal"===d?u:i,h=Math.max(0,c*l-m),p=Math.min(h,t*l),g=Math.max(0,t*l-m+l+n);switch("smart"===r&&(r=a>=g-m&&a<=p+m?"auto":"center"),r){case"start":return p;case"end":return g;case"center":var x=Math.round(g+(p-g)/2);return x<Math.ceil(m/2)?0:x>h+Math.floor(m/2)?h:x;default:return a>=g&&a<=p?a:a<g?g:p}},getStartIndexForOffset:function(e,t){var r=e.itemCount,a=e.itemSize;return Math.max(0,Math.min(r-1,Math.floor(t/a)))},getStopIndexForStartIndex:function(e,t,r){var a=e.direction,s=e.height,n=e.itemCount,o=e.itemSize,i=e.layout,c=e.width,l=t*o,d="horizontal"===a||"horizontal"===i?c:s,u=Math.ceil((d+r-l)/o);return Math.max(0,Math.min(n-1,t+u-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}});function He(t,r,a){const[s,n]=e.useState(()=>{try{if("undefined"==typeof window)return r;const e=localStorage.getItem(t);if(e&&"undefined"!==e&&"null"!==e){const t=a?.deserialize?a.deserialize(e):JSON.parse(e);if(null!=t)return t}return r}catch(e){try{localStorage.removeItem(t)}catch{}return r}});return e.useEffect(()=>{try{const e=a?.serialize?a.serialize(s):JSON.stringify(s);localStorage.setItem(t,e)}catch(e){}},[t,s,a]),[s,n]}function We(){return He("dashboard_filters",{selectedDate:(new Date).toISOString().split("T")[0],searchValue:"",currentPage:1,statusFilter:"all",conferenceValue:""})}function Je(e){if(!e)return"";try{let t;if("string"==typeof e)if(e.includes("/")){const[r,a,s]=e.split("/");t=4===r.length?new Date(parseInt(r),parseInt(a)-1,parseInt(s)):4===s.length?new Date(parseInt(s),parseInt(a)-1,parseInt(r)):new Date(e)}else if(e.includes("-")){const[r,a,s]=e.split("-");t=4===r.length?new Date(e):new Date(parseInt(s),parseInt(a)-1,parseInt(r))}else t=new Date(e);else t="number"==typeof e&&e<1e5?new Date(86400*(e-25569)*1e3):new Date(e);if(isNaN(t.getTime()))return"";const r=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0");return`${r}-${a}-${t.getFullYear()}`}catch{return""}}function Xe(e){if(!e)return null;try{const[t,r,a]=e.split("-").map(e=>parseInt(e,10));if(!t||!r||!a||t<1||t>31||r<1||r>12)return null;const s=new Date(a,r-1,t);return s.getDate()!==t||s.getMonth()!==r-1||s.getFullYear()!==a?null:s}catch{return null}}function Ke(e){if(!e)return"";try{let t;if("string"==typeof e)if(e.includes("-")&&2===e.split("-")[0].length){if(t=Xe(e),!t)return""}else t=new Date(e);else t=new Date(e);return isNaN(t.getTime())?"":t.toISOString().split("T")[0]}catch{return""}}function Ye(e){if(!e)return"";try{let t;if("string"==typeof e)if(e.includes("-")&&2===e.split("-")[0].length){if(t=Xe(e),!t)return""}else t=new Date(e);else t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return""}}function Ge(e){if(!e)return"";try{const t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}}function Ze(){return Je(new Date)}const Qe=r.memo(({index:e,style:t,data:r})=>{const a=r.items[e],s=r.transferredIds.has(a.id);return X.jsxs("div",{style:t,className:"grid grid-cols-12 gap-2 px-4 py-2 border-b border-gray-700 text-sm "+(s?"bg-gray-800 opacity-50":e%2==0?"bg-gray-900":"bg-gray-850"),children:[X.jsx("div",{className:"col-span-1 text-gray-400 font-mono",children:e+1}),X.jsx("div",{className:"col-span-2 text-gray-300",children:a.date?Ye(a.date):"-"}),X.jsx("div",{className:"col-span-2",children:(e=>{const t={"PIX RECEBIDO":"bg-green-900 text-green-200","PIX ENVIADO":"bg-red-900 text-red-200",TED:"bg-blue-900 text-blue-200",DOC:"bg-purple-900 text-purple-200","CARTÃO":"bg-indigo-900 text-indigo-200",DINHEIRO:"bg-yellow-900 text-yellow-200",BOLETO:"bg-orange-900 text-orange-200"}[e]||"bg-gray-700 text-gray-300";return X.jsx("span",{className:`px-2 py-1 text-xs rounded ${t}`,children:e})})(a.paymentType)}),X.jsx("div",{className:"col-span-2 text-gray-300 font-mono",children:a.cpf?`${a.cpf.slice(0,3)}.${a.cpf.slice(3,6)}.${a.cpf.slice(6,9)}-${a.cpf.slice(9)}`:"-"}),X.jsx("div",{className:"col-span-2 text-right font-semibold",children:X.jsx("span",{className:a.value>=0?"text-green-400":"text-red-400",children:(n=a.value,new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n))})}),X.jsx("div",{className:"col-span-2",children:(e=>{switch(e){case"valid":return X.jsx("span",{className:"px-2 py-1 text-xs bg-green-900 text-green-200 rounded",children:"Válido"});case"warning":return X.jsx("span",{className:"px-2 py-1 text-xs bg-yellow-900 text-yellow-200 rounded",children:"Aviso"});case"error":return X.jsx("span",{className:"px-2 py-1 text-xs bg-red-900 text-red-200 rounded",children:"Erro"});default:return X.jsx("span",{className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded",children:"Desconhecido"})}})(a.validationStatus||"unknown")}),X.jsx("div",{className:"col-span-1 text-center",children:s?X.jsx("span",{className:"text-xs text-green-400",children:"✓ Transferido"}):X.jsx("span",{className:"text-xs text-gray-400",children:"Disponível"})})]});var n});Qe.displayName="TableRow";const et=({parseResult:t,transferredIds:r,className:a=""})=>{const[s,n]=He("banking_table_filters",{dateFilter:"",typeFilter:"all",statusFilter:"all",searchText:""}),{filteredData:o,stats:i,isEmpty:c,hasFilters:l}=function(t,r,a){const s=e.useMemo(()=>t?.data?t.data.filter(e=>{if(r.has(e.id))return!1;if(a.dateFilter&&!e.date?.includes(a.dateFilter))return!1;if(a.typeFilter&&"all"!==a.typeFilter&&e.paymentType!==a.typeFilter)return!1;if(a.searchText){const t=a.searchText.toLowerCase();if(![e.originalHistory,e.description,e.cpf,e.value?.toString()].join(" ").toLowerCase().includes(t))return!1}return!(void 0!==a.minValue&&e.value<a.minValue||void 0!==a.maxValue&&e.value>a.maxValue)}):[],[t?.data,r,a]),n=e.useMemo(()=>{const e=(t?.data||[]).filter(e=>!r.has(e.id)),a=e.reduce((e,t)=>e+(t.value||0),0),n=s.reduce((e,t)=>e+(t.value||0),0),o={};e.forEach(e=>{const t=e.validationStatus||"unknown";o[t]=(o[t]||0)+1});const i={};return e.forEach(e=>{const t=e.paymentType||"OUTROS";i[t]=(i[t]||0)+1}),{totalItems:e.length,totalValue:a,itemsByStatus:o,itemsByType:i,averageValue:e.length>0?a/e.length:0,filteredCount:s.length,filteredValue:n}},[t?.data,r,s]),o=e.useMemo(()=>[...s].sort((e,t)=>(t.value||0)-(e.value||0)),[s]);return{filteredData:o,stats:n,isEmpty:0===o.length,hasFilters:Object.values(a).some(e=>""!==e&&"all"!==e&&void 0!==e)}}(t,r,s),d=e.useMemo(()=>{if(!t?.data)return{paymentTypes:[],statuses:[]};return{paymentTypes:[...new Set(t.data.map(e=>e.paymentType))].sort(),statuses:[...new Set(t.data.map(e=>e.validationStatus||"unknown"))].sort()}},[t?.data]),u=e.useMemo(()=>({items:o,transferredIds:r}),[o,r]),m=e.useCallback((e,t)=>{n(r=>({...r,[e]:t}))},[n]),h=e.useCallback(()=>{n({dateFilter:"",typeFilter:"all",statusFilter:"all",searchText:""})},[n]);if(!t?.data)return X.jsx("div",{className:`bg-gray-800 border border-gray-700 rounded-lg ${a}`,children:X.jsx("div",{className:"p-8 text-center text-gray-400",children:"Carregue uma planilha para visualizar os dados bancários"})});const p=Math.min(600,Math.max(300,60*o.length+50));return X.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-lg ${a}`,children:[X.jsxs("div",{className:"p-4 border-b border-gray-700",children:[X.jsxs("div",{className:"flex justify-between items-center mb-4",children:[X.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Dados Bancários"}),X.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-400",children:[X.jsxs("span",{children:["Total: ",i.totalItems]}),X.jsxs("span",{children:["Filtrados: ",i.filteredCount]}),X.jsxs("span",{children:["Valor: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.filteredValue)]})]})]}),X.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[X.jsx("input",{type:"text",placeholder:"Buscar...",value:s.searchText,onChange:e=>m("searchText",e.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),X.jsxs("select",{value:s.typeFilter,onChange:e=>m("typeFilter",e.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[X.jsx("option",{value:"all",children:"Todos os tipos"}),d.paymentTypes.map(e=>X.jsx("option",{value:e,children:e},e))]}),X.jsxs("select",{value:s.statusFilter,onChange:e=>m("statusFilter",e.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[X.jsx("option",{value:"all",children:"Todos os status"}),d.statuses.map(e=>X.jsx("option",{value:e,children:"valid"===e?"Válido":"warning"===e?"Aviso":"error"===e?"Erro":e},e))]}),l&&X.jsx("button",{onClick:h,className:"px-3 py-2 text-sm text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Limpar Filtros"})]})]}),X.jsxs("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 bg-gray-750 border-b border-gray-700 text-sm font-semibold text-gray-300",children:[X.jsx("div",{className:"col-span-1",children:"#"}),X.jsx("div",{className:"col-span-2",children:"Data"}),X.jsx("div",{className:"col-span-2",children:"Tipo"}),X.jsx("div",{className:"col-span-2",children:"CPF"}),X.jsx("div",{className:"col-span-2 text-right",children:"Valor"}),X.jsx("div",{className:"col-span-2",children:"Status"}),X.jsx("div",{className:"col-span-1 text-center",children:"Situação"})]}),c?X.jsx("div",{className:"p-8 text-center text-gray-400",children:l?"Nenhum resultado encontrado com os filtros aplicados":"Nenhum dado disponível"}):X.jsx(qe,{height:p,itemCount:o.length,itemSize:60,itemData:u,className:"custom-scrollbar",children:Qe}),!c&&X.jsx("div",{className:"p-3 border-t border-gray-700 bg-gray-750",children:X.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400",children:[X.jsxs("div",{children:["Média: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.averageValue)]}),X.jsx("div",{children:Object.entries(i.itemsByType).slice(0,3).map(([e,t])=>X.jsxs("span",{className:"mr-4",children:[e,": ",t]},e))})]})})]})},tt=r.memo(({index:t,style:r,data:n})=>{const o=n.items[t],i=e.useCallback(()=>{n.onRemoveItem(o.conferredId)},[n.onRemoveItem,o.conferredId]);return X.jsxs("div",{style:r,className:`grid grid-cols-12 gap-2 px-4 py-3 border-b border-gray-700 text-sm ${t%2==0?"bg-gray-900":"bg-gray-850"} hover:bg-gray-800 transition-colors`,children:[X.jsx("div",{className:"col-span-1 text-gray-400 font-mono flex items-center",children:t+1}),X.jsxs("div",{className:"col-span-2 text-gray-300 flex items-center",children:[X.jsx(a,{className:"h-4 w-4 mr-1 text-gray-500"}),X.jsx("span",{className:"text-xs",children:(l=o.conferredAt,new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(l))})]}),X.jsx("div",{className:"col-span-2 flex items-center",children:(e=>{const t={"PIX RECEBIDO":"bg-green-900 text-green-200","PIX ENVIADO":"bg-red-900 text-red-200",TED:"bg-blue-900 text-blue-200",DOC:"bg-purple-900 text-purple-200","CARTÃO":"bg-indigo-900 text-indigo-200",DINHEIRO:"bg-yellow-900 text-yellow-200",BOLETO:"bg-orange-900 text-orange-200",MANUAL:"bg-pink-900 text-pink-200"}[e]||"bg-gray-700 text-gray-300";return X.jsx("span",{className:`px-2 py-1 text-xs rounded ${t}`,children:e})})(o.paymentType)}),X.jsx("div",{className:"col-span-2 text-gray-300 font-mono flex items-center",children:o.cpf?`${o.cpf.slice(0,3)}.${o.cpf.slice(3,6)}.${o.cpf.slice(6,9)}-${o.cpf.slice(9)}`:"-"}),X.jsx("div",{className:"col-span-2 text-right font-semibold flex items-center justify-end",children:X.jsx("span",{className:o.value>=0?"text-green-400":"text-red-400",children:(c=o.value,new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c))})}),X.jsx("div",{className:"col-span-2 text-gray-300 flex items-center",children:X.jsx("span",{className:"truncate",title:o.originalHistory,children:o.originalHistory||o.description||"-"})}),X.jsx("div",{className:"col-span-1 flex items-center justify-center",children:X.jsx("button",{onClick:i,className:"p-1 text-red-400 hover:text-red-300 hover:bg-red-900/20 rounded transition-colors",title:"Remover da conferência de caixa",children:X.jsx(s,{className:"h-4 w-4"})})})]});var c,l});tt.displayName="CashTableRow";const rt=({conferredItems:t,onRemoveItem:r,className:a=""})=>{const[s,n]=He("cash_table_filters",{dateFilter:"",typeFilter:"all",statusFilter:"all",searchText:""}),{filteredData:o,stats:i,isEmpty:c,hasFilters:l}=function(t,r){const a=e.useMemo(()=>t.filter(e=>{if(r.dateFilter&&!e.conferredAt.toLocaleDateString("pt-BR").includes(r.dateFilter))return!1;if(r.typeFilter&&"all"!==r.typeFilter&&e.paymentType!==r.typeFilter)return!1;if(r.searchText){const t=r.searchText.toLowerCase();if(![e.originalHistory,e.description,e.cpf,e.value?.toString(),e.conferredId].join(" ").toLowerCase().includes(t))return!1}return!(void 0!==r.minValue&&e.value<r.minValue||void 0!==r.maxValue&&e.value>r.maxValue)}),[t,r]),s=e.useMemo(()=>{const e=t.reduce((e,t)=>e+(t.value||0),0),r=a.reduce((e,t)=>e+(t.value||0),0),s={};t.forEach(e=>{const t=e.paymentType||"OUTROS";s[t]=(s[t]||0)+1});const n={conferred:t.length};return{totalItems:t.length,totalValue:e,itemsByStatus:n,itemsByType:s,averageValue:t.length>0?e/t.length:0,filteredCount:a.length,filteredValue:r}},[t,a]),n=e.useMemo(()=>[...a].sort((e,t)=>t.conferredAt.getTime()-e.conferredAt.getTime()),[a]);return{filteredData:n,stats:s,isEmpty:0===n.length,hasFilters:Object.values(r).some(e=>""!==e&&"all"!==e&&void 0!==e)}}(t,s),d=e.useMemo(()=>({paymentTypes:[...new Set(t.map(e=>e.paymentType))].sort()}),[t]),u=e.useMemo(()=>({items:o,onRemoveItem:r}),[o,r]),m=e.useCallback((e,t)=>{n(r=>({...r,[e]:t}))},[n]),h=e.useCallback(()=>{n({dateFilter:"",typeFilter:"all",statusFilter:"all",searchText:""})},[n]),p=Math.min(600,Math.max(300,70*o.length+50));return X.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-lg ${a}`,children:[X.jsxs("div",{className:"p-4 border-b border-gray-700",children:[X.jsxs("div",{className:"flex justify-between items-center mb-4",children:[X.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Conferência de Caixa"}),X.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-400",children:[X.jsxs("span",{children:["Total: ",i.totalItems]}),X.jsxs("span",{children:["Filtrados: ",i.filteredCount]}),X.jsxs("span",{children:["Valor: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.filteredValue)]})]})]}),X.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[X.jsx("input",{type:"text",placeholder:"Buscar por descrição, CPF, valor...",value:s.searchText,onChange:e=>m("searchText",e.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),X.jsxs("select",{value:s.typeFilter,onChange:e=>m("typeFilter",e.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[X.jsx("option",{value:"all",children:"Todos os tipos"}),d.paymentTypes.map(e=>X.jsx("option",{value:e,children:e},e))]}),l&&X.jsx("button",{onClick:h,className:"px-3 py-2 text-sm text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Limpar Filtros"})]})]}),X.jsxs("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 bg-gray-750 border-b border-gray-700 text-sm font-semibold text-gray-300",children:[X.jsx("div",{className:"col-span-1",children:"#"}),X.jsx("div",{className:"col-span-2",children:"Conferido em"}),X.jsx("div",{className:"col-span-2",children:"Tipo"}),X.jsx("div",{className:"col-span-2",children:"CPF"}),X.jsx("div",{className:"col-span-2 text-right",children:"Valor"}),X.jsx("div",{className:"col-span-2",children:"Descrição"}),X.jsx("div",{className:"col-span-1 text-center",children:"Ações"})]}),c?X.jsx("div",{className:"p-8 text-center text-gray-400",children:l?"Nenhum resultado encontrado com os filtros aplicados":"Nenhum item conferido ainda"}):X.jsx(qe,{height:p,itemCount:o.length,itemSize:70,itemData:u,className:"custom-scrollbar",children:tt}),!c&&X.jsx("div",{className:"p-3 border-t border-gray-700 bg-gray-750",children:X.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400",children:[X.jsxs("div",{children:["Média: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.averageValue)]}),X.jsx("div",{className:"flex space-x-4",children:Object.entries(i.itemsByType).slice(0,3).map(([e,t])=>X.jsxs("span",{children:[e,": ",t]},e))})]})})]})};function at(e){if("number"==typeof e)return Math.round(100*e)/100;if(!e||"string"!=typeof e)return 0;let t=e.trim().replace(/[R$\s]/g,"").replace(/[^\d,.-]/g,"");const r=t.lastIndexOf(","),a=t.lastIndexOf(".");r>a?t=t.replace(/\./g,"").replace(",","."):a>r&&(t=t.replace(/,/g,""));const s=parseFloat(t);return isNaN(s)?0:Math.round(100*s)/100}const st=new WeakMap;function nt(e){const t=new Map;return e.forEach((e,r)=>{let a=st.get(e);void 0===a&&(a=at(e.value),st.set(e,a)),0!==a&&(t.has(a)||t.set(a,[]),t.get(a).push({id:`row-${r}-${e.date}-${e.value}`,date:e.date,paymentType:e.paymentType,cpf:e.cpf,value:e.value,originalHistory:e.originalHistory,rowIndex:r}))}),t}function ot(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}const it=(t,r=!0)=>{const a=e.useCallback(e=>{if(!r)return;const a=e.target,s="INPUT"===a.tagName||"TEXTAREA"===a.tagName||"true"===a.contentEditable;for(const r of t){const t=e.key.toLowerCase()===r.key.toLowerCase(),a=!!r.ctrlKey===e.ctrlKey,n=!!r.altKey===e.altKey,o=!!r.shiftKey===e.shiftKey;if(t&&a&&n&&o){if("enter"===r.key.toLowerCase()&&s)continue;if("escape"===r.key.toLowerCase())return!1!==r.preventDefault&&e.preventDefault(),!1!==r.stopPropagation&&e.stopPropagation(),void r.action();if(r.ctrlKey||r.altKey||r.shiftKey)return!1!==r.preventDefault&&e.preventDefault(),!1!==r.stopPropagation&&e.stopPropagation(),void r.action();if(!s)return!1!==r.preventDefault&&e.preventDefault(),!1!==r.stopPropagation&&e.stopPropagation(),void r.action()}}},[t,r]);e.useEffect(()=>{if(r)return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[a,r])},ct=()=>{const t=e.useRef(null);return{saveFocus:e.useCallback(()=>{t.current=document.activeElement},[]),restoreFocus:e.useCallback(()=>{t.current&&"function"==typeof t.current.focus&&setTimeout(()=>{t.current&&t.current.focus()},0)},[])}},lt=({isOpen:e,matches:t,searchValue:r,onSelect:a,onClose:s})=>{if(it([{key:"Escape",action:s,description:"Fechar modal (Esc)"},{key:"Enter",action:()=>{t.length>0&&a(t[0])},description:"Selecionar primeiro item (Enter)"}],e),!e)return null;return X.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:e=>{e.target===e.currentTarget&&s()},onKeyDown:e=>{"Escape"===e.key&&s()},children:X.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 w-full max-w-4xl mx-4 max-h-[80vh] overflow-hidden",children:[X.jsx("div",{className:"bg-gray-900 px-6 py-4 border-b border-gray-700",children:X.jsxs("div",{className:"flex items-center justify-between",children:[X.jsxs("div",{children:[X.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:"Múltiplas Correspondências Encontradas"}),X.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Valor pesquisado: ",X.jsx("span",{className:"text-indigo-400 font-mono",children:ot(r)}),"- Encontrados ",t.length," registros"]})]}),X.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-100 hover:bg-gray-700 rounded-md transition-colors","aria-label":"Fechar modal",children:X.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),X.jsxs("div",{className:"p-6",children:[X.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Selecione qual registro deseja transferir para a Conferência de Caixa:"}),X.jsx("div",{className:"overflow-auto max-h-96",children:X.jsx("div",{className:"space-y-2",children:t.map((e,t)=>{return X.jsxs("button",{onClick:()=>a(e),className:"w-full p-4 bg-gray-700 hover:bg-gray-600 border border-gray-600 hover:border-indigo-500 rounded-lg transition-colors text-left focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-gray-800",children:[X.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[X.jsxs("div",{children:[X.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Data"}),X.jsx("p",{className:"text-sm text-gray-100 font-medium",children:e.date})]}),X.jsxs("div",{children:[X.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Tipo de Pagamento"}),X.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("PIX RECEBIDO"===e.paymentType?"bg-green-900/50 text-green-300 border border-green-700":"PIX ENVIADO"===e.paymentType?"bg-red-900/50 text-red-300 border border-red-700":"TED"===e.paymentType?"bg-blue-900/50 text-blue-300 border border-blue-700":"CARTÃO"===e.paymentType?"bg-purple-900/50 text-purple-300 border border-purple-700":"bg-gray-600 text-gray-300 border border-gray-500"),children:e.paymentType})]}),X.jsxs("div",{children:[X.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"CPF"}),X.jsx("p",{className:"text-sm text-gray-100 font-mono",children:(r=e.cpf,r?r.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):"-")})]}),X.jsxs("div",{children:[X.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Valor"}),X.jsx("p",{className:"text-sm font-mono font-semibold "+(e.value>=0?"text-green-400":"text-red-400"),children:ot(e.value)})]})]}),e.originalHistory&&X.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-600",children:[X.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Histórico Original"}),X.jsx("p",{className:"text-xs text-gray-300 truncate",title:e.originalHistory,children:e.originalHistory})]}),X.jsx("div",{className:"mt-3 flex items-center justify-end",children:X.jsxs("div",{className:"flex items-center text-indigo-400",children:[X.jsx("span",{className:"text-xs",children:"Clique para selecionar"}),X.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]},e.id);var r})})})]}),X.jsx("div",{className:"bg-gray-900 px-6 py-4 border-t border-gray-700 flex justify-end space-x-3",children:X.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 hover:text-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500 transition-colors",children:"Cancelar"})})]})})},dt={"PIX RECEBIDO":/pix\s*recebid/i,"PIX ENVIADO":/pix\s*enviad/i,TED:/\bted\b/i,DOC:/\bdoc\b/i,"CARTÃO":/cart[aã]o/i,DINHEIRO:/dinheiro/i,BOLETO:/boleto/i,"TRANSFERÊNCIA":/transfer[eê]ncia/i,"DEPÓSITO":/dep[oó]sito/i,SAQUE:/saque/i},ut={date:["data","date","data do lançamento","data do lancamento","dt","data mov","data movimento"],history:["histórico","historico","descrição","descricao","histórico/descrição","historico/descricao","descrição/histórico","descricao/historico","desc"],value:["valor","valor (r$)","valor r$","vlr","val"],credit:["crédito","credito","entrada","receita"],debit:["débito","debito","saída","saida","despesa"]};async function mt(e){try{const t=await e.arrayBuffer(),r=M(t,{type:"array"});if(0===r.SheetNames.length)return{success:!1,data:[],errors:["Arquivo não contém planilhas"],warnings:[],stats:{totalRows:0,validRows:0,rowsWithWarnings:0,rowsWithErrors:0,totalValue:0}};const a=r.Sheets[r.SheetNames[0]],s=B.sheet_to_json(a,{header:1});if(s.length<2)return{success:!1,data:[],errors:["Arquivo não contém dados suficientes"],warnings:[],stats:{totalRows:0,validRows:0,rowsWithWarnings:0,rowsWithErrors:0,totalValue:0}};const n=function(e){for(let t=0;t<Math.min(10,e.length);t++){const r=e[t];if(!r)continue;const a=ht(r.map(e=>String(e||"").toLowerCase().trim()));if(-1!==a.date&&-1!==a.history&&(-1!==a.value||-1!==a.credit&&-1!==a.debit))return{headerRowIndex:t,columnIndexes:a}}return null}(s);if(!n)return{success:!1,data:[],errors:["Não foi possível encontrar cabeçalhos válidos. Verifique se o arquivo contém colunas: Data, Histórico e Valor"],warnings:[],stats:{totalRows:0,validRows:0,rowsWithWarnings:0,rowsWithErrors:0,totalValue:0}};const{headerRowIndex:o,columnIndexes:i}=n,c=[];if(-1===i.date&&c.push("Data"),-1===i.history&&c.push("Histórico"),-1!==i.value||-1!==i.credit&&-1!==i.debit||c.push("Valor (ou Crédito/Débito)"),c.length>0)return{success:!1,data:[],errors:[`Colunas essenciais não encontradas: ${c.join(", ")}. Sugestões de nomes aceitos: Data/Date, Histórico/Descrição, Valor/Valor(R$)`],warnings:[],stats:{totalRows:s.length-o-1,validRows:0,rowsWithWarnings:0,rowsWithErrors:0,totalValue:0}};const l=[],d=[];let u=0,m=0,h=0,p=0;for(let e=o+1;e<s.length;e++){const t=s[e];if(!t||t.every(e=>!e||""===String(e).trim()))continue;const r=pt(t,i,e+1);l.push(r),"valid"===r.validationStatus?(m++,u+=r.value):"warning"===r.validationStatus?(h++,u+=r.value,r.validationMessage&&d.push(`Linha ${e+1}: ${r.validationMessage}`)):p++}return{success:!0,data:l,errors:[],warnings:d,stats:{totalRows:l.length,validRows:m,rowsWithWarnings:h,rowsWithErrors:p,totalValue:u}}}catch(t){return{success:!1,data:[],errors:[`Erro ao processar arquivo: ${t instanceof Error?t.message:"Erro desconhecido"}`],warnings:[],stats:{totalRows:0,validRows:0,rowsWithWarnings:0,rowsWithErrors:0,totalValue:0}}}}function ht(e){const t={date:-1,history:-1,value:-1,credit:-1,debit:-1};return e.forEach((e,r)=>{const a=e.toLowerCase().trim();a&&(-1===t.date&&ut.date.some(e=>a.includes(e))&&(t.date=r),-1===t.history&&ut.history.some(e=>a.includes(e))&&(t.history=r),-1===t.value&&ut.value.some(e=>a.includes(e))&&(t.value=r),-1===t.credit&&ut.credit.some(e=>a.includes(e))&&(t.credit=r),-1===t.debit&&ut.debit.some(e=>a.includes(e))&&(t.debit=r))}),t}function pt(e,t,r){const a=[];let s="valid";const n=function(e){if(!e)return null;try{let t;if("number"==typeof e)t=new Date(86400*(e-25569)*1e3);else{const r=String(e).trim();if(r.match(/^\d{2}\/\d{2}\/\d{4}$/)){const[e,a,s]=r.split("/");t=new Date(parseInt(s),parseInt(a)-1,parseInt(e))}else if(r.match(/^\d{4}-\d{2}-\d{2}$/))t=new Date(r);else if(r.match(/^\d{2}-\d{2}-\d{4}$/)){const[e,a,s]=r.split("-");t=new Date(parseInt(s),parseInt(a)-1,parseInt(e))}else t=new Date(r)}return isNaN(t.getTime())?null:Je(t)}catch{return null}}(e[t.date]);n||(a.push("Data inválida"),s="warning");const o=String(e[t.history]||""),i=function(e){const t=e.toUpperCase();for(const[r,a]of Object.entries(dt))if(a.test(e))return r;if(t.includes("PIX"))return t.includes("ENVIO")||t.includes("TRANSF")?"PIX ENVIADO":"PIX RECEBIDO";return null}(o),c=function(e){const t=e.replace(/\D/g,"").match(/\d{11}/);if(t){const e=t[0];if(!/^(\d)\1{10}$/.test(e))return e}const r=e.match(/\d{3}\.?\d{3}\.?\d{3}-?\d{2}/);if(r)return r[0].replace(/\D/g,"");return null}(o);c||(a.push("CPF não encontrado"),"valid"===s&&(s="warning"));let l=0;if(-1!==t.value)l=gt(e[t.value]);else if(-1!==t.credit&&-1!==t.debit){l=gt(e[t.credit])-gt(e[t.debit])}return isNaN(l)&&(a.push("Valor inválido"),s="error",l=0),{date:n||"Data inválida",paymentType:i||"OUTROS",cpf:c||"",value:Math.round(100*l)/100,originalHistory:o,validationStatus:s,validationMessage:a.length>0?a.join(", "):void 0}}function gt(e){if("number"==typeof e)return e;if("string"==typeof e){let t=e.replace(/[R$\s]/g,"");t=t.replace(",","."),t=t.replace(/[^\d.-]/g,"");const r=parseFloat(t);return isNaN(r)?0:r}return 0}const xt=({selectedFile:t,onDateSelected:r,className:a=""})=>{const[s,n]=e.useState("automatic"),[o,i]=e.useState(Ke(new Date)),[c,l]=e.useState(null),[d,u]=e.useState(!1),[m,h]=e.useState(null);e.useEffect(()=>{t&&"automatic"===s&&p()},[t,s]);const p=async()=>{if(t){u(!0),h(null);try{const e=await mt(t);if(e.success&&e.data.length>0){const t=e.data.map(e=>e.date).filter(e=>e&&"Invalid Date"!==e);if(t.length>0){const e=t.reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{}),a=Object.entries(e).sort(([,e],[,t])=>t-e)[0][0],s=Je(a);l(s),r(s,"automatic")}else{const e=Ze();l(e),h("Nenhuma data válida encontrada no arquivo. Usando data atual."),r(e,"automatic")}}else{const e=Ze();l(e),h("Não foi possível detectar data do arquivo. Usando data atual."),r(e,"automatic")}}catch(e){const t=Ze();l(t),h("Erro ao detectar data. Usando data atual."),r(t,"automatic")}finally{u(!1)}}},g=e=>{if(n(e),h(null),"automatic"===e&&c)r(c,"automatic");else if("manual"===e){const e=Je(o);r(e,"manual")}};return X.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 border border-gray-700 ${a}`,children:[X.jsxs("h3",{className:"text-sm font-semibold text-gray-100 mb-3 flex items-center",children:[X.jsx("span",{className:"bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center mr-2 text-xs",children:"2"}),"Selecionar Dia"]}),X.jsxs("div",{className:"space-y-3",children:[X.jsxs("div",{className:"space-y-2",children:[X.jsxs("label",{className:"flex items-center cursor-pointer group",children:[X.jsx("input",{type:"radio",name:"dateMode",value:"automatic",checked:"automatic"===s,onChange:()=>g("automatic"),className:"mr-2 text-indigo-600 focus:ring-indigo-500"}),X.jsxs("div",{className:"flex-1",children:[X.jsx("span",{className:"text-sm text-gray-300 group-hover:text-gray-100",children:"Data Automática"}),"automatic"===s&&c&&X.jsxs("span",{className:"ml-2 text-xs text-indigo-400",children:["(",Ye(c),")"]})]})]}),X.jsxs("label",{className:"flex items-center cursor-pointer group",children:[X.jsx("input",{type:"radio",name:"dateMode",value:"manual",checked:"manual"===s,onChange:()=>g("manual"),className:"mr-2 text-indigo-600 focus:ring-indigo-500"}),X.jsx("span",{className:"text-sm text-gray-300 group-hover:text-gray-100",children:"Selecionar Manualmente"})]})]}),"manual"===s&&X.jsxs("div",{className:"mt-2",children:[X.jsx("label",{htmlFor:"manual-date-input",className:"sr-only",children:"Data manual"}),X.jsx("input",{id:"manual-date-input",type:"date",value:o,onChange:e=>(e=>{if(i(e),"manual"===s){const t=Je(e);r(t,"manual")}})(e.target.value),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500","aria-label":"Selecionar data manualmente"})]}),d&&X.jsx("div",{className:"p-2 bg-indigo-900/20 border border-indigo-600 rounded-md",children:X.jsxs("div",{className:"flex items-center",children:[X.jsxs("svg",{className:"animate-spin h-4 w-4 text-indigo-400 mr-2",fill:"none",viewBox:"0 0 24 24",children:[X.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),X.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),X.jsx("span",{className:"text-xs text-indigo-400",children:"Detectando data do arquivo..."})]})}),m&&X.jsx("div",{className:"p-2 bg-yellow-900/20 border border-yellow-600 rounded-md",children:X.jsx("p",{className:"text-xs text-yellow-400",children:m})}),X.jsx("div",{className:"bg-gray-900 rounded p-3 border border-gray-600",children:X.jsxs("div",{className:"flex items-center justify-between",children:[X.jsx("span",{className:"text-xs text-gray-400",children:"Data selecionada:"}),X.jsxs("div",{className:"text-right",children:[X.jsx("span",{className:"text-sm text-indigo-400 font-medium",children:Ye("automatic"===s?c||Ze():Je(o))}),X.jsxs("span",{className:"block text-xs text-gray-500 mt-1",children:["Modo: ","automatic"===s?"Automático":"Manual"]})]})]})}),X.jsx("div",{className:"p-2 bg-gray-700 rounded-md",children:X.jsx("p",{className:"text-xs text-gray-400",children:"automatic"===s?"A data será detectada automaticamente do arquivo carregado.":"Você está selecionando a data manualmente."})})]})]})},ft=Y;async function yt(){const{data:e}=await Y.auth.getUser();return e?.user?.id||"00000000-0000-0000-0000-000000000001"}const bt=new class extends p{constructor(){super("CaixaDatabase"),this.version(1).stores({bank_uploads:"++id, day, user_id, file_name, upload_mode, created_at",bank_entries:"++id, upload_id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",cash_conference_entries:"++id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",not_found_history:"++id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",manual_entries:"++id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",day_selection:"++id, &day, user_id, last_accessed"}),this.version(2).stores({bank_uploads:"++id, day, user_id, file_name, upload_mode, created_at",bank_entries:"++id, upload_id, source_id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",cash_conference_entries:"++id, &source_id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",not_found_history:"++id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",manual_entries:"++id, &source_id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",day_selection:"++id, &day, user_id, last_accessed"}).upgrade(e=>e.manual_entries.toCollection().modify(e=>{e.source_id||(e.source_id=`manual_${crypto.randomUUID?crypto.randomUUID():Date.now().toString(36)}`)})),this.version(3).stores({bank_uploads:"++id, day, user_id, file_name, upload_mode, created_at",bank_entries:"++id, upload_id, source_id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",cash_conference_entries:"++id, &source_id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",not_found_history:"++id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",manual_entries:"++id, &source_id, day, status, [status+day], value_cents, [value_cents+day], source, [source+day], user_id, created_at",day_selection:"++id, &day, user_id, last_accessed",action_log:"++id, day, user_id, action_type, timestamp, result, [action_type+day], [result+day]"}),this.bank_entries.hook("creating",(e,t,r)=>{t.value_cents=Math.round(100*(t.value||0)),t.created_at=t.created_at||(new Date).toISOString()}),this.cash_conference_entries.hook("creating",(e,t,r)=>{t.value_cents=Math.round(100*(t.value||0)),t.created_at=t.created_at||(new Date).toISOString()}),this.not_found_history.hook("creating",(e,t,r)=>{t.value_cents=Math.round(100*(t.value||0)),t.created_at=t.created_at||(new Date).toISOString()}),this.manual_entries.hook("creating",(e,t,r)=>{t.value_cents=Math.round(100*(t.value||0)),t.created_at=t.created_at||(new Date).toISOString()}),this.bank_uploads.hook("creating",(e,t,r)=>{t.created_at=t.created_at||(new Date).toISOString()}),this.day_selection.hook("creating",(e,t,r)=>{t.last_accessed=t.last_accessed||(new Date).toISOString()}),this.bank_entries.hook("updating",(e,t,r,a)=>{void 0!==e.value&&(e.value_cents=Math.round(100*(e.value||0)))}),this.cash_conference_entries.hook("updating",(e,t,r,a)=>{void 0!==e.value&&(e.value_cents=Math.round(100*(e.value||0)))}),this.not_found_history.hook("updating",(e,t,r,a)=>{void 0!==e.value&&(e.value_cents=Math.round(100*(e.value||0)))}),this.manual_entries.hook("updating",(e,t,r,a)=>{void 0!==e.value&&(e.value_cents=Math.round(100*(e.value||0)))}),this.day_selection.hook("updating",(e,t,r,a)=>{e.last_accessed=(new Date).toISOString()}),this.action_log.hook("creating",(e,t,r)=>{t.timestamp=t.timestamp||(new Date).toISOString()})}static valueToCents(e){return Math.round(100*e)}static centsToValue(e){return e/100}async clearUserData(e){await this.transaction("rw",this.bank_uploads,this.bank_entries,this.cash_conference_entries,this.not_found_history,this.manual_entries,this.day_selection,this.action_log,async()=>{await this.bank_uploads.where("user_id").equals(e).delete(),await this.bank_entries.where("user_id").equals(e).delete(),await this.cash_conference_entries.where("user_id").equals(e).delete(),await this.not_found_history.where("user_id").equals(e).delete(),await this.manual_entries.where("user_id").equals(e).delete(),await this.day_selection.where("user_id").equals(e).delete(),await this.action_log.where("user_id").equals(e).delete()})}async getStats(){const[e,t,r,a,s,n,o]=await Promise.all([this.bank_uploads.count(),this.bank_entries.count(),this.cash_conference_entries.count(),this.not_found_history.count(),this.manual_entries.count(),this.day_selection.count(),this.action_log.count()]);return{bank_uploads:e,bank_entries:t,cash_conference_entries:r,not_found_history:a,manual_entries:s,day_selection:n,action_log:o}}},vt=()=>{try{return"undefined"!=typeof indexedDB}catch(e){return!1}};function _t(e,t,r,a){const s=function(e){let t=0;if(0===e.length)return t.toString();for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return Math.abs(t).toString(36)}(`${e?.trim()||""}|${t?.replace(/\D/g,"")||""}|${Math.round(100*r)}|${a?.trim().toLowerCase()||""}`);return`origin_${s}`}function wt(){if("undefined"!=typeof crypto&&crypto.randomUUID)return`manual_${crypto.randomUUID()}`;return`manual_${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}`}const jt=/^(\d{2})\/(\d{2})\/(\d{4})$/,Nt=w().transform(e=>e.replace(/\D/g,"")).pipe(w().length(11,{message:"CPF deve ter 11 dígitos"}).regex(/^\d{11}$/,{message:"CPF deve conter apenas números"}).refine(e=>{if("00000000000"===e||"11111111111"===e||"22222222222"===e||"33333333333"===e||"44444444444"===e||"55555555555"===e||"66666666666"===e||"77777777777"===e||"88888888888"===e||"99999999999"===e)return!1;let t=0;for(let a=0;a<9;a++)t+=parseInt(e.charAt(a))*(10-a);let r=10*t%11;if(10!==r&&11!==r||(r=0),r!==parseInt(e.charAt(9)))return!1;t=0;for(let a=0;a<10;a++)t+=parseInt(e.charAt(a))*(11-a);return r=10*t%11,10!==r&&11!==r||(r=0),r===parseInt(e.charAt(10))},{message:"CPF inválido"})),St=w().min(1,{message:"Data é obrigatória"}).regex(jt,{message:"Data deve estar no formato DD/MM/AAAA"}).refine(e=>{const t=e.match(jt);if(!t)return!1;const r=parseInt(t[1],10),a=parseInt(t[2],10),s=parseInt(t[3],10);if(a<1||a>12)return!1;if(r<1||r>31)return!1;if(s<1900||s>2100)return!1;const n=new Date(s,a-1,r);return n.getDate()===r&&n.getMonth()===a-1&&n.getFullYear()===s},{message:"Data inválida"});w().min(1,{message:"Data é obrigatória"}).regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Data deve estar no formato DD-MM-AAAA"}).refine(e=>{const[t,r,a]=e.split("-").map(e=>parseInt(e,10));if(r<1||r>12)return!1;if(t<1||t>31)return!1;if(a<1900||a>2100)return!1;const s=new Date(a,r-1,t);return s.getDate()===t&&s.getMonth()===r-1&&s.getFullYear()===a},{message:"Data inválida"});const kt=N([S(),w()]).transform(e=>{if("number"==typeof e)return e;const t=e.replace(/[R$\s]/g,"").replace(/\./g,"").replace(",","."),r=parseFloat(t);return isNaN(r)?0:r}).pipe(S().finite({message:"Valor deve ser um número válido"}).min(.01,{message:"Valor deve ser maior que zero"}).max(999999999.99,{message:"Valor muito alto"}));S().int({message:"Valor em centavos deve ser inteiro"}).min(1,{message:"Valor deve ser maior que zero"}).max(99999999999,{message:"Valor muito alto"});const Ct=w().min(1,{message:"Descrição é obrigatória"}).max(500,{message:"Descrição muito longa (máx. 500 caracteres)"}).transform(e=>e.trim()),Dt=w().max(500,{message:"Descrição muito longa (máx. 500 caracteres)"}).transform(e=>e.trim()).optional(),It=_({date:St.optional(),document_number:Nt.optional(),description:Dt,value:kt,transaction_type:w().optional(),balance:S().optional()}),Et=_({document_number:Nt.optional(),description:Ct,value:kt,entry_type:k(["income","expense","transfer"],{errorMap:()=>({message:"Tipo deve ser: receita, despesa ou transferência"})}),category:w().optional()}),Tt=_({value:kt,document_number:Nt.optional(),description:Dt}),Mt=_({value:kt}),Bt=_({value:kt}),Ot=_({date:N([St,w().optional()]).optional(),paymentType:w().optional(),cpf:N([Nt,w().optional()]).optional(),value:kt,originalHistory:w().optional()}),$t=e=>{if(!e.errors||0===e.errors.length)return"Dados inválidos";const t=e.errors[0];return t?.message||"Dados inválidos"},Ft=(e,t)=>{const r=e.safeParse(t);return r.success?{success:!0,data:r.data}:{success:!1,error:$t(r.error)}};w().min(1,{message:"Nome do arquivo é obrigatório"}).max(255,{message:"Nome do arquivo muito longo"}).refine(e=>[".xlsx",".xls",".csv"].some(t=>e.toLowerCase().endsWith(t)),{message:"Arquivo deve ser Excel (.xlsx, .xls) ou CSV"});const Lt={bankingEntry:It,manualEntry:Et,cashConference:Tt,conferenceValue:Mt,notFoundValue:Bt,excelRow:Ot};const Rt=new class{constructor(){this.isEnabled=!1,this.activeOperations=new Map,this.dbName="performance_metrics",this.dbVersion=1,this.storeName="metrics",this.isEnabled="true"===localStorage.getItem("performance_logging_enabled"),this.isEnabled&&(this.initDatabase(),this.cleanOldMetrics())}setEnabled(e){this.isEnabled=e,localStorage.setItem("performance_logging_enabled",e.toString()),e&&this.initDatabase()}isLoggingEnabled(){return this.isEnabled}startOperation(e,t){if(!this.isEnabled)return"";const r=`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a=performance.now();return this.activeOperations.set(r,{operation:e,startTime:a,metadata:t}),r}endOperation(e){if(!this.isEnabled||!e)return null;const t=this.activeOperations.get(e);if(!t)return null;const r=performance.now(),a=r-t.startTime,s={id:e,operation:t.operation,startTime:t.startTime,endTime:r,duration:a,metadata:t.metadata,timestamp:new Date};return this.activeOperations.delete(e),this.saveMetric(s),s}measureSync(e,t,r){if(!this.isEnabled)return t();const a=this.startOperation(e,r);try{const e=t();return this.endOperation(a),e}catch(s){throw this.endOperation(a),s}}async measureAsync(e,t,r){if(!this.isEnabled)return t();const a=this.startOperation(e,r);try{const e=await t();return this.endOperation(a),e}catch(s){throw this.endOperation(a),s}}async getTodaysStats(){if(!this.isEnabled)return[];const e=new Date;e.setHours(0,0,0,0);const t=new Date(e);t.setDate(t.getDate()+1);const r=await this.getMetricsByDateRange(e,t);return this.calculateStats(r)}async getOperationStats(e,t=24){if(!this.isEnabled)return null;const r=new Date(Date.now()-60*t*60*1e3),a=(await this.getMetricsByDateRange(r,new Date)).filter(t=>t.operation===e);if(0===a.length)return null;return this.calculateStats(a).find(t=>t.operation===e)||null}async getMetricsByDateRange(e,t){return this.isEnabled?new Promise((r,a)=>{const s=indexedDB.open(this.dbName,this.dbVersion);s.onsuccess=()=>{const s=o.result.transaction([this.storeName],"readonly").objectStore(this.storeName).index("timestamp"),n=IDBKeyRange.bound(e,t),o=s.getAll(n);o.onsuccess=()=>{r(o.result||[])},o.onerror=()=>{a(o.error)}},s.onerror=()=>{a(s.error)}}):[]}calculateStats(e){const t=new Map;e.forEach(e=>{t.has(e.operation)||t.set(e.operation,[]),t.get(e.operation).push(e)});const r=[];return t.forEach((e,t)=>{const a=e.map(e=>e.duration).sort((e,t)=>e-t),s=a.length,n=a.reduce((e,t)=>e+t,0),o=n/s,i=a[Math.floor(s/2)],c=a[Math.floor(.95*s)]||a[s-1],l=a[0],d=a[s-1];r.push({operation:t,count:s,average:o,median:i,p95:c,min:l,max:d,totalTime:n})}),r.sort((e,t)=>t.average-e.average)}initDatabase(){const e=indexedDB.open(this.dbName,this.dbVersion);e.onupgradeneeded=()=>{const t=e.result;if(!t.objectStoreNames.contains(this.storeName)){const e=t.createObjectStore(this.storeName,{keyPath:"id"});e.createIndex("operation","operation",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}},e.onerror=()=>{}}saveMetric(e){const t=indexedDB.open(this.dbName,this.dbVersion);t.onsuccess=()=>{const r=t.result.transaction([this.storeName],"readwrite");r.objectStore(this.storeName).add(e),r.onerror=()=>{}},t.onerror=()=>{}}cleanOldMetrics(){const e=new Date(Date.now()-864e5),t=indexedDB.open(this.dbName,this.dbVersion);t.onsuccess=()=>{const t=s.result.transaction([this.storeName],"readwrite"),r=t.objectStore(this.storeName).index("timestamp"),a=IDBKeyRange.upperBound(e),s=r.openCursor(a);s.onsuccess=()=>{const e=s.result;e&&(e.delete(),e.continue())},t.onerror=()=>{}},t.onerror=()=>{}}async exportMetrics(){if(!this.isEnabled)return[];const e=new Date(Date.now()-864e5);return this.getMetricsByDateRange(e,new Date)}async clearAllMetrics(){if(this.isEnabled)return new Promise((e,t)=>{const r=indexedDB.open(this.dbName,this.dbVersion);r.onsuccess=()=>{const a=r.result.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();a.onsuccess=()=>{e()},a.onerror=()=>{t(a.error)}},r.onerror=()=>{t(r.error)}})}};Rt.measureSync.bind(Rt),Rt.measureAsync.bind(Rt),Rt.startOperation.bind(Rt),Rt.endOperation.bind(Rt);class At{static{this.currentUserId="default_user"}static setCurrentUserId(e){this.currentUserId=e}static getCurrentUserId(){return this.currentUserId}static valueToCents(e){return Math.round(100*e)}static centsToValue(e){return e/100}static async logAction(e,t,r,a,s="success",n){const o=this.getCurrentUserId();try{const i={action_type:e,action_description:t,user_id:o,day:r,payload:a,result:s,error_message:n,metadata:{user_agent:navigator.userAgent,timestamp_local:(new Date).toLocaleString("pt-BR")}};await bt.action_log.add(i)}catch(i){}}static async saveBankingUpload(e,t,r,a){const s=this.getCurrentUserId();try{await bt.transaction("rw",bt.bank_uploads,bt.bank_entries,async()=>{const n=await bt.bank_uploads.add({day:r,bank_name:e[0]?.bankName,account_number:e[0]?.accountNumber,file_name:t,file_upload_date:r,upload_mode:a,user_id:s,metadata:{total_entries:e.length}}),o=e.map(e=>{const t=_t(e.date||r,e.documentNumber||"",e.value||0,e.description||"");return{upload_id:n,source_id:t,day:r,document_number:e.documentNumber,date:e.date,description:e.description,value:e.value,value_cents:this.valueToCents(e.value||0),transaction_type:e.transactionType,balance:e.balance,status:"pending",source:"banking_upload",user_id:s,metadata:e}}),i=(await Promise.all(o.map(e=>bt.bank_entries.where("source_id").equals(e.source_id).first()))).filter(Boolean);if(i.length>0)throw new Error(`${i.length} entradas duplicadas encontradas. Upload cancelado.`);await bt.bank_entries.bulkAdd(o),await this.logAction("banking_upload",`Upload de ${o.length} entradas bancárias do arquivo ${t}`,r,{file_name:t,entry_count:o.length,source_ids:o.map(e=>e.source_id),values:o.map(e=>e.value||0),upload_mode:a})})}catch(o){throw await this.logAction("banking_upload",`Falha no upload do arquivo ${t}`,r,{file_name:t,entry_count:e.length,upload_mode:a},"error",o instanceof Error?o.message:"Erro desconhecido"),o instanceof Error&&o.message.includes("duplicadas")?n.error(o.message):n.error("Erro ao salvar upload bancário. Tente novamente."),o}}static async saveCashConference(e,t,r){const a=this.getCurrentUserId();try{const s=e.source_id||`conf_${Date.now().toString(36)}_${Math.random().toString(36).substring(2,8)}`,n={source_id:s,day:t,document_number:e.documentNumber,description:e.description,value:e.value,value_cents:this.valueToCents(e.value||0),status:r,conferred_at:(new Date).toISOString(),conferred_by:a,source:"cash_conference",user_id:a,metadata:e};if(await bt.cash_conference_entries.where("source_id").equals(s).first())throw new Error("Entrada já foi conferida anteriormente.");await bt.cash_conference_entries.add(n),await this.logAction("cash_conference",`Conferência de caixa: ${"conferred"===r?"Conferido":"Não encontrado"} - ${n.description}`,t,{source_ids:[s],values:[e.value||0],target_status:r})}catch(s){throw await this.logAction("cash_conference",`Falha na conferência de caixa: ${e.description}`,t,{values:[e.value||0],target_status:r},"error",s instanceof Error?s.message:"Erro desconhecido"),s instanceof Error&&s.message.includes("já foi conferida")?n.error(s.message):n.error("Erro ao salvar conferência. Tente novamente."),s}}static async saveNotFound(e,t){const r=this.getCurrentUserId(),a=parseFloat(e.replace(",",".").replace(/[^\d.-]/g,""));try{const s={day:t,value:isNaN(a)?0:a,value_cents:this.valueToCents(isNaN(a)?0:a),status:"not_found",source:"not_found_manual",user_id:r,metadata:{originalValue:e}};await bt.not_found_history.add(s),await this.logAction("not_found",`Valor não encontrado registrado: ${e}`,t,{values:[a],original_value:e})}catch(s){throw await this.logAction("not_found",`Falha ao registrar valor não encontrado: ${e}`,t,{original_value:e},"error",s instanceof Error?s.message:"Erro desconhecido"),s}}static async saveManualEntry(e,t){const r=Rt.startOperation("manual_entry_save",{entryType:e.entry_type,value:e.value,operationDate:t}),a=this.getCurrentUserId();try{const s=Ft(Lt.manualEntry,e);if(!s.success)throw new Error(`Dados inválidos: ${s.error}`);const n=s.data,o={source_id:wt(),day:t,document_number:n.document_number,description:n.description,value:n.value,value_cents:this.valueToCents(n.value),entry_type:n.entry_type,category:n.category,status:"active",source:"manual_entry",user_id:a,metadata:n};if(await bt.manual_entries.where("source_id").equals(o.source_id).first())throw new Error("Lançamento manual já existe.");await bt.manual_entries.add(o),await this.logAction("manual_entry",`Lançamento manual criado: ${n.entry_type} - ${n.description}`,t,{source_ids:[o.source_id],values:[n.value],entry_type:n.entry_type,category:n.category}),Rt.endOperation(r)}catch(s){throw Rt.endOperation(r),await this.logAction("manual_entry",`Falha ao criar lançamento manual: ${e.description||"Sem descrição"}`,t,{values:[e.value||0],entry_type:e.entry_type},"error",s instanceof Error?s.message:"Erro desconhecido"),s instanceof Error&&s.message.includes("já existe")?n.error(s.message):n.error("Erro ao salvar lançamento manual. Tente novamente."),s}}static async getHistoryByDate(e){const t=this.getCurrentUserId();try{const[r,a,s,n]=await Promise.all([bt.bank_entries.where({day:e,user_id:t}).toArray(),bt.cash_conference_entries.where({day:e,user_id:t}).toArray(),bt.not_found_history.where({day:e,user_id:t}).toArray(),bt.manual_entries.where({day:e,user_id:t}).toArray()]),o=[];for(const e of r){const t=await bt.bank_uploads.get(e.upload_id);o.push({id:e.id,operation_date:e.day,operation_type:"banking_upload",operation_timestamp:e.created_at,document_number:e.document_number,date:e.date,description:e.description,value:e.value,bank_name:t?.bank_name,account_number:t?.account_number,transaction_type:e.transaction_type,balance:e.balance,conferred_at:e.conferred_at,conferred_by:e.conferred_by,status:e.status,file_name:t?.file_name,file_upload_date:t?.file_upload_date,upload_mode:t?.upload_mode,metadata:e.metadata,user_id:e.user_id,source:e.source})}for(const e of a)o.push({id:e.id,operation_date:e.day,operation_type:"cash_conference",operation_timestamp:e.created_at,document_number:e.document_number,description:e.description,value:e.value,conferred_at:e.conferred_at,conferred_by:e.conferred_by,status:e.status,metadata:e.metadata,user_id:e.user_id,source:e.source});for(const e of s)o.push({id:e.id,operation_date:e.day,operation_type:"not_found",operation_timestamp:e.created_at,value:e.value,status:e.status,metadata:e.metadata,user_id:e.user_id,source:e.source});for(const e of n)o.push({id:e.id,operation_date:e.day,operation_type:"manual_entry",operation_timestamp:e.created_at,document_number:e.document_number,description:e.description,value:e.value,status:e.status,metadata:e.metadata,user_id:e.user_id,source:e.source});return o.sort((e,t)=>{const r=new Date(e.operation_timestamp||"").getTime();return new Date(t.operation_timestamp||"").getTime()-r})}catch(r){throw r}}static async getDailySummary(e){const t=this.getCurrentUserId();try{const[r,a,s,n,o]=await Promise.all([bt.bank_entries.where({day:e,user_id:t}).toArray(),bt.cash_conference_entries.where({day:e,user_id:t}).toArray(),bt.not_found_history.where({day:e,user_id:t}).toArray(),bt.manual_entries.where({day:e,user_id:t}).toArray(),bt.bank_uploads.where({day:e,user_id:t}).toArray()]);if(0===r.length&&0===a.length&&0===s.length&&0===n.length)return null;const i=r.filter(e=>"conferred"===e.status),c=r.reduce((e,t)=>e+(t.value||0),0),l=i.reduce((e,t)=>e+(t.value||0),0),d=a.filter(e=>"conferred"===e.status),u=a.filter(e=>"not_found"===e.status),m=d.reduce((e,t)=>e+(t.value||0),0),h=n.filter(e=>"active"===e.status),p=h.reduce((e,t)=>e+(t.value||0),0),g=o.sort((e,t)=>new Date(t.created_at||"").getTime()-new Date(e.created_at||"").getTime())[0];return{operation_date:e,banking_total_uploaded:r.length,banking_total_value:c,banking_conferred_count:i.length,banking_conferred_value:l,cash_conferred_count:d.length,cash_conferred_value:m,cash_not_found_count:u.length+s.length,manual_entries_count:h.length,manual_entries_value:p,last_file_name:g?.file_name,last_upload_timestamp:g?.created_at,total_conferred:i.length+d.length,total_value:c+m+p}}catch(r){throw r}}static async transferBankingToCash(e,t){const r=this.getCurrentUserId();try{await bt.transaction("rw",bt.bank_entries,bt.cash_conference_entries,async()=>{const a=await bt.bank_entries.where({id:e,user_id:r}).first();if(!a)throw new Error("Entrada bancária não encontrada");if("transferred"===a.status)throw new Error("Entrada já foi transferida");const s={source_id:a.source_id,day:t,document_number:a.document_number,description:a.description,value:a.value,value_cents:a.value_cents,status:"conferred",conferred_at:(new Date).toISOString(),conferred_by:r,source:"cash_conference",user_id:r,metadata:{...a.metadata,transferred_from_bank_entry:e,original_bank_date:a.date}};await bt.cash_conference_entries.add(s),await bt.bank_entries.where({id:e,user_id:r}).modify({status:"transferred",conferred_at:(new Date).toISOString(),conferred_by:r}),await this.logAction("transfer",`Transferência bancária→caixa: ${a.description}`,t,{source_ids:[a.source_id],values:[a.value||0],original_status:a.status,target_status:"transferred"})})}catch(a){const r=`Falha na transferência: ${a instanceof Error?a.message:"Erro desconhecido"}`;throw await this.logAction("transfer",`Falha na transferência bancária→caixa (ID: ${e})`,t,{bank_entry_id:e},"error",r),n.error(r),new Error(r)}}static async undoManualEntry(e){const t=this.getCurrentUserId();try{await bt.transaction("rw",bt.manual_entries,bt.cash_conference_entries,async()=>{const r=await bt.manual_entries.where({source_id:e,user_id:t}).first();if(!r)throw new Error("Lançamento manual não encontrado");if("cancelled"===r.status)throw new Error("Lançamento já foi cancelado");await bt.cash_conference_entries.where("source_id").equals(e).and(e=>e.user_id===t).delete(),await bt.manual_entries.where({source_id:e,user_id:t}).delete(),await this.logAction("undo",`Lançamento manual desfeito: ${r.description}`,r.day,{source_ids:[e],values:[r.value||0],original_status:r.status,entry_type:r.entry_type})})}catch(r){const t=`Falha ao desfazer lançamento: ${r instanceof Error?r.message:"Erro desconhecido"}`;throw await this.logAction("undo",`Falha ao desfazer lançamento manual com source_id: ${e}`,Je(new Date),{source_ids:[e]},"error",t),n.error(t),new Error(t)}}static async updateConferenceStatus(e,t,r){const a=this.getCurrentUserId();try{const s={status:t,updated_at:(new Date).toISOString()};switch("conferred"===t||"transferred"===t?(s.conferred_at=(new Date).toISOString(),s.conferred_by=a):(s.conferred_at=null,s.conferred_by=null),r){case"banking_upload":await bt.bank_entries.where({id:Number(e),user_id:a}).modify(s);break;case"cash_conference":await bt.cash_conference_entries.where({id:Number(e),user_id:a}).modify(s);break;case"not_found_manual":await bt.not_found_history.where({id:Number(e),user_id:a}).modify(s);break;case"manual_entry":await bt.manual_entries.where({id:Number(e),user_id:a}).modify(s)}}catch(s){throw s}}static async saveDaySelection(e,t){const r=this.getCurrentUserId();try{await bt.day_selection.put({day:e,selected_date:t,user_id:r,last_accessed:(new Date).toISOString()})}catch(a){throw a}}static async getDaySelection(e){const t=this.getCurrentUserId();try{return await bt.day_selection.where({day:e,user_id:t}).first()||null}catch(r){return null}}static async clearDayHistory(e){const t=this.getCurrentUserId();try{await bt.transaction("rw",[bt.bank_uploads,bt.bank_entries,bt.cash_conference_entries,bt.not_found_history,bt.manual_entries],async()=>{const r=(await bt.bank_uploads.where({day:e,user_id:t}).toArray()).map(e=>e.id);for(const e of r)await bt.bank_entries.where("upload_id").equals(e).delete();await bt.bank_uploads.where({day:e,user_id:t}).delete(),await bt.cash_conference_entries.where({day:e,user_id:t}).delete(),await bt.not_found_history.where({day:e,user_id:t}).delete(),await bt.manual_entries.where({day:e,user_id:t}).delete()})}catch(r){throw r}}static async deleteHistoryEntry(e,t){const r=this.getCurrentUserId();try{switch(t){case"banking_upload":const t=await bt.bank_entries.where({id:Number(e),user_id:r}).first();if(t){await bt.bank_entries.delete(Number(e));0===await bt.bank_entries.where("upload_id").equals(t.upload_id).count()&&await bt.bank_uploads.delete(t.upload_id)}break;case"cash_conference":await bt.cash_conference_entries.where({id:Number(e),user_id:r}).delete();break;case"not_found_manual":await bt.not_found_history.where({id:Number(e),user_id:r}).delete();break;case"manual_entry":await bt.manual_entries.where({id:Number(e),user_id:r}).delete()}}catch(a){throw a}}static async searchByValue(e,t){const r=this.getCurrentUserId(),a=this.valueToCents(e);try{let e=bt.bank_entries.where({value_cents:a,user_id:r}),s=bt.cash_conference_entries.where({value_cents:a,user_id:r}),n=bt.not_found_history.where({value_cents:a,user_id:r}),o=bt.manual_entries.where({value_cents:a,user_id:r});t&&(e=e.and(e=>e.day===t),s=s.and(e=>e.day===t),n=n.and(e=>e.day===t),o=o.and(e=>e.day===t));const[i,c,l,d]=await Promise.all([e.toArray(),s.toArray(),n.toArray(),o.toArray()]),u=[];for(const t of i){const e=await bt.bank_uploads.get(t.upload_id);u.push({id:t.id,operation_date:t.day,operation_type:"banking_upload",operation_timestamp:t.created_at,document_number:t.document_number,description:t.description,value:t.value,status:t.status,source:t.source,file_name:e?.file_name,user_id:t.user_id})}for(const t of c)u.push({id:t.id,operation_date:t.day,operation_type:"cash_conference",operation_timestamp:t.created_at,document_number:t.document_number,description:t.description,value:t.value,status:t.status,source:t.source,user_id:t.user_id});for(const t of l)u.push({id:t.id,operation_date:t.day,operation_type:"not_found",operation_timestamp:t.created_at,value:t.value,status:t.status,source:t.source,user_id:t.user_id});for(const t of d)u.push({id:t.id,operation_date:t.day,operation_type:"manual_entry",operation_timestamp:t.created_at,document_number:t.document_number,description:t.description,value:t.value,status:t.status,source:t.source,user_id:t.user_id});return u.sort((e,t)=>new Date(t.operation_timestamp||"").getTime()-new Date(e.operation_timestamp||"").getTime())}catch(s){throw s}}static async getStats(){try{const e=await bt.getStats(),t=.5*e.bank_uploads+1*e.bank_entries+.8*e.cash_conference_entries+.3*e.not_found_history+.8*e.manual_entries+.2*e.day_selection;return{...e,total_storage_mb:Math.round(t/1e3)/1e3}}catch(e){throw e}}}class Vt{static async saveBankingUpload(e,t,r,a){const s=await yt(),[n,o,i]=r.split("-"),c=`${i}-${o}-${n}`,{data:l,error:d}=await ft.from("banking_files").insert({user_id:s,file_name:t,operation_date:c,total_transactions:e.length,total_value:e.reduce((e,t)=>e+(t.value||0),0),status:"uploaded",metadata:{upload_mode:a}}).select("id").single();if(d)throw d;const u=e.map((e,t)=>({file_id:l.id,user_id:s,transaction_date:c,payment_type:e.paymentType||e.transactionType,cpf:e.cpf?.replace(/[^0-9]/g,""),value:e.value,original_history:e.originalHistory||e.description,status:"pending",row_index:t,original_data:e})),{error:m}=await ft.from("banking_transactions").insert(u);if(m)throw m}static async saveCashConference(e,t,r){const a=await yt(),[s,n,o]=t.split("-"),i=`${o}-${n}-${s}`,c={user_id:a,transaction_id:e.transactionId||null,conferred_value:e.value,conference_date:i,transaction_date:e.date?(()=>{const[t,r,a]=e.date.split("-");return`${a}-${r}-${t}`})():i,payment_type:e.paymentType,cpf:e.cpf?.replace(/[^0-9]/g,""),original_value:e.originalValue||e.value,original_history:e.description,conference_status:"conferred"===r?"active":"cancelled",notes:"not_found"===r?"Value not found":null},{error:l}=await ft.from("cash_conference").insert(c);if(l)throw l}static async saveNotFound(e,t){const r=await yt(),a=parseFloat(e.replace(",",".").replace(/[^\d.-]/g,"")),s={user_id:r,searched_value:e,normalized_value:isNaN(a)?0:a,status:"not_found",notes:`Date: ${t}`},{error:n}=await ft.from("not_found_history").insert(s);if(n)throw n}static async getHistoryByDate(e){const t=await yt(),[r,a,s]=e.split("-"),n=`${s}-${a}-${r}`,o=[],{data:i,error:c}=await ft.from("banking_transactions").select("\n        *,\n        banking_files!inner(file_name, upload_date)\n      ").eq("user_id",t).eq("transaction_date",n).order("created_at",{ascending:!1});if(c)throw c;i&&i.forEach(t=>{o.push({id:t.id,operation_date:e,operation_type:"banking_upload",document_number:t.original_data?.documentNumber,date:t.transaction_date,description:t.original_history,value:t.value,status:t.status,file_name:t.banking_files?.file_name,user_id:t.user_id,metadata:t.original_data})});const{data:l,error:d}=await ft.from("cash_conference").select("*").eq("user_id",t).eq("conference_date",n).order("created_at",{ascending:!1});if(d)throw d;l&&l.forEach(t=>{o.push({id:t.id,operation_date:e,operation_type:"cash_conference",description:t.original_history,value:t.conferred_value,status:"active"===t.conference_status?"conferred":"not_found",conferred_at:t.created_at,user_id:t.user_id})});const{data:u,error:m}=await ft.from("not_found_history").select("*").eq("user_id",t).gte("search_timestamp",`${n}T00:00:00`).lt("search_timestamp",`${n}T23:59:59`).order("search_timestamp",{ascending:!1});if(m)throw m;return u&&u.forEach(t=>{o.push({id:t.id,operation_date:e,operation_type:"not_found",value:t.normalized_value,status:"not_found",user_id:t.user_id,metadata:{originalValue:t.searched_value}})}),o.sort((e,t)=>new Date(t.conferred_at||t.operation_timestamp||"").getTime()-new Date(e.conferred_at||e.operation_timestamp||"").getTime())}static async getDailySummary(e){const t=await yt(),[r,a,s]=e.split("-"),n=`${s}-${a}-${r}`,{data:o}=await ft.from("banking_transactions").select("value, status").eq("user_id",t).eq("transaction_date",n),{data:i}=await ft.from("cash_conference").select("conferred_value, conference_status").eq("user_id",t).eq("conference_date",n),{data:c}=await ft.from("banking_files").select("file_name, upload_date").eq("user_id",t).eq("operation_date",n).order("upload_date",{ascending:!1}).limit(1).single(),l={operation_date:e,banking_total_uploaded:o?.length||0,banking_total_value:o?.reduce((e,t)=>e+t.value,0)||0,banking_conferred_count:o?.filter(e=>"conferred"===e.status).length||0,banking_conferred_value:o?.filter(e=>"conferred"===e.status).reduce((e,t)=>e+t.value,0)||0,cash_conferred_count:i?.filter(e=>"active"===e.conference_status).length||0,cash_conferred_value:i?.filter(e=>"active"===e.conference_status).reduce((e,t)=>e+t.conferred_value,0)||0,cash_not_found_count:i?.filter(e=>"cancelled"===e.conference_status).length||0,last_file_name:c?.file_name,last_upload_timestamp:c?.upload_date};return l.total_conferred=l.banking_conferred_count+l.cash_conferred_count,l.total_value=l.banking_total_value+l.cash_conferred_value,l}static async getHistoryByDateRange(e,t){const r=await yt(),[a,s,n]=e.split("-"),[o,i,c]=t.split("-"),l=`${n}-${s}-${a}`,d=`${c}-${i}-${o}`,u=[],{data:m}=await ft.from("banking_transactions").select("*, banking_files!inner(file_name, upload_date)").eq("user_id",r).gte("transaction_date",l).lte("transaction_date",d).order("transaction_date",{ascending:!1}),{data:h}=await ft.from("cash_conference").select("*").eq("user_id",r).gte("conference_date",l).lte("conference_date",d).order("conference_date",{ascending:!1}),{data:p}=await ft.from("not_found_history").select("*").eq("user_id",r).gte("search_timestamp",`${l}T00:00:00`).lte("search_timestamp",`${d}T23:59:59`).order("search_timestamp",{ascending:!1});return m&&m.forEach(e=>{const[t,r,a]=e.transaction_date.split("-");u.push({id:e.id,operation_date:`${a}-${r}-${t}`,operation_type:"banking_upload",document_number:e.original_data?.documentNumber,description:e.original_history,value:e.value,status:e.status,file_name:e.banking_files?.file_name,user_id:e.user_id,metadata:e.original_data})}),h&&h.forEach(e=>{const[t,r,a]=e.conference_date.split("-");u.push({id:e.id,operation_date:`${a}-${r}-${t}`,operation_type:"cash_conference",description:e.original_history,value:e.conferred_value,status:"active"===e.conference_status?"conferred":"not_found",conferred_at:e.created_at,user_id:e.user_id})}),p&&p.forEach(e=>{const t=new Date(e.search_timestamp),r=`${t.getDate().toString().padStart(2,"0")}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getFullYear()}`;u.push({id:e.id,operation_date:r,operation_type:"not_found",value:e.normalized_value,status:"not_found",user_id:e.user_id,metadata:{originalValue:e.searched_value}})}),u.sort((e,t)=>{const r=new Date(e.operation_date.split("-").reverse().join("-"));return new Date(t.operation_date.split("-").reverse().join("-")).getTime()-r.getTime()})}static async updateConferenceStatus(e,t){const r=await yt(),{error:a}=await ft.from("banking_transactions").update({status:t,updated_at:(new Date).toISOString()}).eq("id",e).eq("user_id",r);if(!a)return;const{error:s}=await ft.from("cash_conference").update({conference_status:"conferred"===t?"active":"cancelled",updated_at:(new Date).toISOString()}).eq("id",e).eq("user_id",r);if(s)throw s}static async deleteHistoryEntry(e){const t=await yt(),{error:r}=await ft.from("banking_transactions").delete().eq("id",e).eq("user_id",t);if(!r)return;const{error:a}=await ft.from("cash_conference").delete().eq("id",e).eq("user_id",t);if(!a)return;const{error:s}=await ft.from("not_found_history").delete().eq("id",e).eq("user_id",t);if(s)throw s}static async clearDayHistory(e){const t=await yt(),[r,a,s]=e.split("-"),n=`${s}-${a}-${r}`;await ft.from("banking_transactions").delete().eq("user_id",t).eq("transaction_date",n),await ft.from("cash_conference").delete().eq("user_id",t).eq("conference_date",n),await ft.from("not_found_history").delete().eq("user_id",t).gte("search_timestamp",`${n}T00:00:00`).lt("search_timestamp",`${n}T23:59:59`),await ft.from("banking_files").delete().eq("user_id",t).eq("operation_date",n)}}class zt{static{this.useIndexedDB=!1}static{this.initialized=!1}static async initialize(){if(!this.initialized)try{if(vt()){if(await(async()=>{try{return!!vt()&&(await bt.open(),!0)}catch(e){return!1}})()){this.useIndexedDB=!0;const e=await yt();At.setCurrentUserId(e)}else this.useIndexedDB=!1}else this.useIndexedDB=!1;this.initialized=!0}catch(e){this.useIndexedDB=!1,this.initialized=!0}}static isUsingIndexedDB(){return this.useIndexedDB}static forceIndexedDB(e=!0){this.useIndexedDB=e&&vt()}static async saveBankingUpload(e,t,r,a){return await this.initialize(),this.useIndexedDB?At.saveBankingUpload(e,t,r,a):Vt.saveBankingUpload(e,t,r,a)}static async saveCashConference(e,t,r){return await this.initialize(),this.useIndexedDB?At.saveCashConference(e,t,r):Vt.saveCashConference(e,t,r)}static async saveNotFound(e,t){return await this.initialize(),this.useIndexedDB?At.saveNotFound(e,t):Vt.saveNotFound(e,t)}static async saveManualEntry(e,t){if(await this.initialize(),this.useIndexedDB)return At.saveManualEntry(e,t);throw new Error("Manual entries not yet implemented for Supabase")}static async getHistoryByDate(e){return await this.initialize(),this.useIndexedDB?At.getHistoryByDate(e):Vt.getHistoryByDate(e)}static async getDailySummary(e){return await this.initialize(),this.useIndexedDB?At.getDailySummary(e):Vt.getDailySummary(e)}static async getHistoryByDateRange(e,t){if(await this.initialize(),this.useIndexedDB){const r=[],a=new Date(e.split("-").reverse().join("-")),s=new Date(t.split("-").reverse().join("-"));for(let e=new Date(a);e<=s;e.setDate(e.getDate()+1)){const t=e.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),a=await At.getHistoryByDate(t);r.push(...a)}return r.sort((e,t)=>{const r=new Date(e.operation_timestamp||"").getTime();return new Date(t.operation_timestamp||"").getTime()-r})}return Vt.getHistoryByDateRange(e,t)}static async updateConferenceStatus(e,t){return await this.initialize(),this.useIndexedDB?At.updateConferenceStatus(e,t,"banking_upload"):Vt.updateConferenceStatus(String(e),t)}static async clearDayHistory(e){return await this.initialize(),this.useIndexedDB?At.clearDayHistory(e):Vt.clearDayHistory(e)}static async deleteHistoryEntry(e){return await this.initialize(),this.useIndexedDB?At.deleteHistoryEntry(e,"banking_upload"):Vt.deleteHistoryEntry(String(e))}static async saveDaySelection(e,t){if(await this.initialize(),this.useIndexedDB)return At.saveDaySelection(e,t);try{const r=`day_selection_${e}`,a={day:e,selectedDate:t,timestamp:(new Date).toISOString()};localStorage.setItem(r,JSON.stringify(a))}catch(r){}}static async getDaySelection(e){if(await this.initialize(),this.useIndexedDB)return At.getDaySelection(e);try{const t=`day_selection_${e}`,r=localStorage.getItem(t);if(r){const e=JSON.parse(r);return{day:e.day,selected_date:e.selectedDate}}}catch(t){}return null}static async searchByValue(e,t){if(await this.initialize(),this.useIndexedDB)return At.searchByValue(e,t);return(t?await Vt.getHistoryByDate(t):await Vt.getHistoryByDateRange((new Date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),(new Date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}))).filter(t=>t.value===e)}static async getStorageStats(){if(await this.initialize(),this.useIndexedDB){return{type:"IndexedDB",stats:await At.getStats()}}return{type:"Supabase"}}static async migrateToIndexedDB(){if(!vt())throw new Error("IndexedDB is not available")}static async migrateToSupabase(){if(!this.useIndexedDB)throw new Error("Not using IndexedDB")}}const Ut=r.memo(({index:e,style:t,data:r})=>{const a=r.items[e];return X.jsxs("div",{style:t,className:`grid grid-cols-12 gap-2 px-4 py-3 border-b border-gray-700 text-sm ${e%2==0?"bg-gray-900":"bg-gray-850"} hover:bg-gray-800 transition-colors`,children:[X.jsx("div",{className:"col-span-1 text-gray-400 font-mono flex items-center",children:e+1}),X.jsx("div",{className:"col-span-2 text-gray-300 flex items-center",children:X.jsx("span",{className:"text-xs",children:a.operation_date})}),X.jsx("div",{className:"col-span-2 flex items-center",children:(e=>{const t={banking_upload:"bg-blue-900 text-blue-200",cash_conference:"bg-green-900 text-green-200",not_found:"bg-red-900 text-red-200",manual_entry:"bg-purple-900 text-purple-200"}[e]||"bg-gray-700 text-gray-300",r={banking_upload:"Upload Bancário",cash_conference:"Conf. Caixa",not_found:"Não Encontrado",manual_entry:"Lançamento Manual"}[e]||e;return X.jsx("span",{className:`px-2 py-1 text-xs rounded ${t}`,children:r})})(a.operation_type||"unknown")}),X.jsx("div",{className:"col-span-2 text-right font-semibold flex items-center justify-end",children:a.value?X.jsx("span",{className:a.value>=0?"text-green-400":"text-red-400",children:(s=a.value,new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s))}):X.jsx("span",{className:"text-gray-500",children:"-"})}),X.jsx("div",{className:"col-span-2 flex items-center",children:(e=>{const t={pending:"bg-yellow-900 text-yellow-200",conferred:"bg-green-900 text-green-200",not_found:"bg-red-900 text-red-200",transferred:"bg-blue-900 text-blue-200",active:"bg-green-900 text-green-200",cancelled:"bg-gray-700 text-gray-300"}[e]||"bg-gray-700 text-gray-300",r={pending:"Pendente",conferred:"Conferido",not_found:"Não Encontrado",transferred:"Transferido",active:"Ativo",cancelled:"Cancelado"}[e]||e;return X.jsx("span",{className:`px-2 py-1 text-xs rounded ${t}`,children:r})})(a.status||"unknown")}),X.jsx("div",{className:"col-span-2 text-gray-300 flex items-center",children:X.jsx("span",{className:"truncate",title:a.description,children:a.description||"-"})}),X.jsx("div",{className:"col-span-1 text-gray-400 flex items-center",children:X.jsx("span",{className:"text-xs",children:(e=>{if(!e)return"-";try{const t=new Date(e);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}catch{return e}})(a.operation_timestamp)})})]});var s});Ut.displayName="HistoryTableRow";const Pt=({historyData:t,onExport:r,className:a=""})=>{const[s,n]=He("history_table_filters",{dateFilter:"",typeFilter:"all",statusFilter:"all",searchText:""}),{filteredData:l,stats:d,isEmpty:u,hasFilters:m}=function(t,r){const a=e.useMemo(()=>t.filter(e=>{if(r.dateFilter&&!e.operation_date?.includes(r.dateFilter))return!1;if(r.typeFilter&&"all"!==r.typeFilter&&e.operation_type!==r.typeFilter)return!1;if(r.statusFilter&&"all"!==r.statusFilter&&e.status!==r.statusFilter)return!1;if(r.searchText){const t=r.searchText.toLowerCase();if(![e.description,e.document_number,e.value?.toString(),e.operation_type,e.status].join(" ").toLowerCase().includes(t))return!1}return!(void 0!==r.minValue&&(e.value||0)<r.minValue||void 0!==r.maxValue&&(e.value||0)>r.maxValue)}),[t,r]),s=e.useMemo(()=>{const e=t.reduce((e,t)=>e+(t.value||0),0),r=a.reduce((e,t)=>e+(t.value||0),0),s={};t.forEach(e=>{const t=e.status||"unknown";s[t]=(s[t]||0)+1});const n={};return t.forEach(e=>{const t=e.operation_type||"unknown";n[t]=(n[t]||0)+1}),{totalItems:t.length,totalValue:e,itemsByStatus:s,itemsByType:n,averageValue:t.length>0?e/t.length:0,filteredCount:a.length,filteredValue:r}},[t,a]),n=e.useMemo(()=>[...a].sort((e,t)=>{const r=new Date(e.operation_timestamp||"").getTime();return new Date(t.operation_timestamp||"").getTime()-r}),[a]);return{filteredData:n,stats:s,isEmpty:0===n.length,hasFilters:Object.values(r).some(e=>""!==e&&"all"!==e&&void 0!==e)}}(t,s),h=e.useMemo(()=>({operationTypes:[...new Set(t.map(e=>e.operation_type||"unknown"))].sort(),statuses:[...new Set(t.map(e=>e.status||"unknown"))].sort()}),[t]),p=e.useMemo(()=>({items:l}),[l]),g=e.useCallback((e,t)=>{n(r=>({...r,[e]:t}))},[n]),x=e.useCallback(()=>{n({dateFilter:"",typeFilter:"all",statusFilter:"all",searchText:""})},[n]),f=Math.min(600,Math.max(300,70*l.length+50));return X.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-lg ${a}`,children:[X.jsxs("div",{className:"p-4 border-b border-gray-700",children:[X.jsxs("div",{className:"flex justify-between items-center mb-4",children:[X.jsxs("h3",{className:"text-lg font-semibold text-gray-200 flex items-center",children:[X.jsx(o,{className:"h-5 w-5 mr-2"}),"Histórico de Operações"]}),X.jsxs("div",{className:"flex items-center space-x-4",children:[X.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-400",children:[X.jsxs("span",{children:["Total: ",d.totalItems]}),X.jsxs("span",{children:["Filtrados: ",d.filteredCount]}),X.jsxs("span",{children:["Valor: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d.filteredValue)]})]}),r&&X.jsxs("button",{onClick:r,className:"flex items-center px-3 py-2 text-sm text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:[X.jsx(i,{className:"h-4 w-4 mr-1"}),"Exportar"]})]})]}),X.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[X.jsx("input",{type:"text",placeholder:"Buscar...",value:s.searchText,onChange:e=>g("searchText",e.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),X.jsx("input",{type:"text",placeholder:"Data (DD-MM-YYYY)",value:s.dateFilter,onChange:e=>g("dateFilter",e.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),X.jsxs("select",{value:s.typeFilter,onChange:e=>g("typeFilter",e.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[X.jsx("option",{value:"all",children:"Todos os tipos"}),h.operationTypes.map(e=>X.jsx("option",{value:e,children:"banking_upload"===e?"Upload Bancário":"cash_conference"===e?"Conf. Caixa":"not_found"===e?"Não Encontrado":"manual_entry"===e?"Lançamento Manual":e},e))]}),X.jsxs("select",{value:s.statusFilter,onChange:e=>g("statusFilter",e.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[X.jsx("option",{value:"all",children:"Todos os status"}),h.statuses.map(e=>X.jsx("option",{value:e,children:"pending"===e?"Pendente":"conferred"===e?"Conferido":"not_found"===e?"Não Encontrado":"transferred"===e?"Transferido":"active"===e?"Ativo":"cancelled"===e?"Cancelado":e},e))]}),m&&X.jsxs("button",{onClick:x,className:"flex items-center justify-center px-3 py-2 text-sm text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:[X.jsx(c,{className:"h-4 w-4 mr-1"}),"Limpar"]})]})]}),X.jsxs("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 bg-gray-750 border-b border-gray-700 text-sm font-semibold text-gray-300",children:[X.jsx("div",{className:"col-span-1",children:"#"}),X.jsx("div",{className:"col-span-2",children:"Data"}),X.jsx("div",{className:"col-span-2",children:"Tipo"}),X.jsx("div",{className:"col-span-2 text-right",children:"Valor"}),X.jsx("div",{className:"col-span-2",children:"Status"}),X.jsx("div",{className:"col-span-2",children:"Descrição"}),X.jsx("div",{className:"col-span-1",children:"Timestamp"})]}),u?X.jsx("div",{className:"p-8 text-center text-gray-400",children:m?"Nenhum resultado encontrado com os filtros aplicados":"Nenhum histórico disponível"}):X.jsx(qe,{height:f,itemCount:l.length,itemSize:70,itemData:p,className:"custom-scrollbar",children:Ut}),!u&&X.jsx("div",{className:"p-3 border-t border-gray-700 bg-gray-750",children:X.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400",children:[X.jsx("div",{className:"flex space-x-4",children:X.jsxs("span",{children:["Média: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d.averageValue)]})}),X.jsx("div",{className:"flex space-x-4",children:Object.entries(d.itemsByStatus).slice(0,4).map(([e,t])=>X.jsxs("span",{children:["pending"===e?"Pendente":"conferred"===e?"Conferido":"not_found"===e?"Não Encontrado":"active"===e?"Ativo":e,": ",t]},e))})]})})]})};class qt{static formatCurrency(e){return null==e?"":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}static exportToCSV(e,t){const r=[];e.banking&&e.banking.length>0&&(r.push("DADOS BANCÁRIOS"),r.push(["Data","Documento","Descrição","Valor","Tipo Transação","Status","ID Origem"].join(",")),e.banking.forEach(e=>{r.push([`"${e.date||""}"`,`"${e.document_number||""}"`,`"${e.description?.replace(/"/g,'""')||""}"`,`"${this.formatCurrency(e.value)}"`,`"${e.transaction_type||""}"`,`"${e.status||""}"`,`"${e.source_id||""}"`].join(","))}),r.push("")),e.cash&&e.cash.length>0&&(r.push("CONFERÊNCIA DE CAIXA"),r.push(["Data","Documento","Descrição","Valor","Status","Conferido Em","Conferido Por","ID Origem"].join(",")),e.cash.forEach(e=>{r.push([`"${e.day||""}"`,`"${e.document_number||""}"`,`"${e.description?.replace(/"/g,'""')||""}"`,`"${this.formatCurrency(e.value)}"`,`"${e.status||""}"`,`"${e.conferred_at?Ge(e.conferred_at):""}"`,`"${e.conferred_by||""}"`,`"${e.source_id||""}"`].join(","))}),r.push("")),e.manual&&e.manual.length>0&&(r.push("LANÇAMENTOS MANUAIS"),r.push(["Data","Documento","Descrição","Valor","Tipo","Categoria","Status","ID Origem"].join(",")),e.manual.forEach(e=>{r.push([`"${e.day||""}"`,`"${e.document_number||""}"`,`"${e.description?.replace(/"/g,'""')||""}"`,`"${this.formatCurrency(e.value)}"`,`"${e.entry_type||""}"`,`"${e.category||""}"`,`"${e.status||""}"`,`"${e.source_id||""}"`].join(","))}),r.push("")),e.actions&&e.actions.length>0&&(r.push("HISTÓRICO DE AÇÕES"),r.push(["Data/Hora","Tipo de Ação","Descrição","Resultado","Usuário","Valores","IDs de Origem","Erro"].join(",")),e.actions.forEach(e=>{r.push([`"${Ge(e.timestamp)}"`,`"${this.getActionTypeLabel(e.action_type)}"`,`"${e.action_description.replace(/"/g,'""')}"`,`"${e.result}"`,`"${e.user_id}"`,`"${e.payload.values?.join("; ")||""}"`,`"${e.payload.source_ids?.join("; ")||""}"`,`"${e.error_message||""}"`].join(","))}),r.push("")),e.history&&e.history.length>0&&(r.push("HISTÓRICO POR DATA"),r.push(["Data Operação","Tipo Operação","Documento","Descrição","Valor","Status","Arquivo","Banco"].join(",")),e.history.forEach(e=>{r.push([`"${e.operation_date||""}"`,`"${this.getOperationTypeLabel(e.operation_type)}"`,`"${e.document_number||""}"`,`"${e.description?.replace(/"/g,'""')||""}"`,`"${this.formatCurrency(e.value)}"`,`"${e.status||""}"`,`"${e.file_name||""}"`,`"${e.bank_name||""}"`].join(","))}));const a=r.join("\n");this.downloadFile(a,t,"text/csv;charset=utf-8;")}static exportToXLSX(e,t){const r=B.book_new();if(e.banking&&e.banking.length>0){const t=e.banking.map(e=>({Data:e.date||"",Documento:e.document_number||"","Descrição":e.description||"",Valor:e.value||0,"Tipo Transação":e.transaction_type||"",Status:e.status||"","ID Origem":e.source_id||""})),a=B.json_to_sheet(t);B.book_append_sheet(r,a,"Bancário")}if(e.cash&&e.cash.length>0){const t=e.cash.map(e=>({Data:e.day||"",Documento:e.document_number||"","Descrição":e.description||"",Valor:e.value||0,Status:e.status||"","Conferido Em":e.conferred_at?Ge(e.conferred_at):"","Conferido Por":e.conferred_by||"","ID Origem":e.source_id||""})),a=B.json_to_sheet(t);B.book_append_sheet(r,a,"Caixa")}if(e.manual&&e.manual.length>0){const t=e.manual.map(e=>({Data:e.day||"",Documento:e.document_number||"","Descrição":e.description||"",Valor:e.value||0,Tipo:e.entry_type||"",Categoria:e.category||"",Status:e.status||"","ID Origem":e.source_id||""})),a=B.json_to_sheet(t);B.book_append_sheet(r,a,"Lançamentos")}if(e.actions&&e.actions.length>0){const t=e.actions.map(e=>({"Data/Hora":Ge(e.timestamp),"Tipo de Ação":this.getActionTypeLabel(e.action_type),"Descrição":e.action_description,Resultado:e.result,"Usuário":e.user_id,Valores:e.payload.values?.join("; ")||"","IDs de Origem":e.payload.source_ids?.join("; ")||"",Erro:e.error_message||""})),a=B.json_to_sheet(t);B.book_append_sheet(r,a,"Ações")}if(e.history&&e.history.length>0){const t=e.history.map(e=>({"Data Operação":e.operation_date||"","Tipo Operação":this.getOperationTypeLabel(e.operation_type),Documento:e.document_number||"","Descrição":e.description||"",Valor:e.value||0,Status:e.status||"",Arquivo:e.file_name||"",Banco:e.bank_name||""})),a=B.json_to_sheet(t);B.book_append_sheet(r,a,"Histórico")}const a=O(r,{bookType:"xlsx",type:"array"}),s=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});this.downloadBlob(s,t)}static getActionTypeLabel(e){switch(e){case"banking_upload":return"Upload Bancário";case"cash_conference":return"Conferência";case"manual_entry":return"Lançamento Manual";case"transfer":return"Transferência";case"undo":return"Desfazer";case"not_found":return"Não Encontrado";default:return e}}static getOperationTypeLabel(e){switch(e){case"banking_upload":return"Upload Bancário";case"cash_conference":return"Conferência de Caixa";case"not_found":return"Não Encontrado";case"manual_entry":return"Lançamento Manual";default:return e}}static downloadFile(e,t,r){const a=new Blob([e],{type:r});this.downloadBlob(a,t)}static downloadBlob(e,t){const r=document.createElement("a"),a=URL.createObjectURL(e);r.setAttribute("href",a),r.setAttribute("download",t),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}static generateFilename(e,t,r){return`${e}_${r||Je(new Date)}_${(new Date).toISOString().split("T")[0]}.${t}`}}const Ht=({data:t,prefix:r,date:a,className:s="",disabled:o=!1})=>{const[i,c]=e.useState(!1),l=async e=>{if(o)return;if(!Object.values(t).some(e=>Array.isArray(e)&&e.length>0))return void n.error("Nenhum dado para exportar");const s=Object.values(t).reduce((e,t)=>e+(Array.isArray(t)?t.length:0),0);c(!0);try{await Rt.measureAsync("data_export",async()=>{const s=qt.generateFilename(r,e,a);"csv"===e?qt.exportToCSV(t,s):qt.exportToXLSX(t,s)},{format:e,totalRecords:s,prefix:r}),n.success(`Dados exportados! ${s} registros em formato ${e.toUpperCase()}.`)}catch(i){n.error(i instanceof Error?i.message:"Erro ao exportar dados")}finally{c(!1)}};return X.jsxs("div",{className:`flex space-x-2 ${s}`,children:[X.jsxs("button",{onClick:()=>l("csv"),disabled:o||i,className:"px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center",title:"Exportar para CSV",children:[i?X.jsxs("svg",{className:"animate-spin h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",children:[X.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),X.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):X.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),"CSV"]}),X.jsxs("button",{onClick:()=>l("xlsx"),disabled:o||i,className:"px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center",title:"Exportar para Excel",children:[i?X.jsxs("svg",{className:"animate-spin h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",children:[X.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),X.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):X.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),"XLSX"]})]})},Wt=({className:t="",onDataLoaded:r,onLookupMapBuilt:a})=>{const[s,n]=e.useState(Ke(new Date)),[o,i]=e.useState([]),[c,l]=e.useState(null),[d,u]=e.useState(!1),[m,h]=e.useState(null),[p,g]=e.useState("day");return X.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 border border-gray-700 ${t}`,children:[X.jsxs("h3",{className:"text-sm font-semibold text-gray-100 mb-3 flex items-center",children:[X.jsx("span",{className:"bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center mr-2 text-xs",children:"4"}),"Histórico por Data"]}),X.jsxs("div",{className:"space-y-3",children:[X.jsxs("div",{className:"space-y-2",children:[X.jsxs("div",{children:[X.jsx("label",{htmlFor:"history-date-input",className:"block text-xs text-gray-400 mb-1",children:"Selecionar data"}),X.jsx("input",{id:"history-date-input",type:"date",value:s,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500","aria-label":"Selecionar data"})]}),X.jsxs("div",{children:[X.jsx("label",{htmlFor:"period-select",className:"block text-xs text-gray-400 mb-1",children:"Período"}),X.jsxs("select",{id:"period-select",value:p,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500","aria-label":"Selecionar período",children:[X.jsx("option",{value:"day",children:"Dia específico"}),X.jsx("option",{value:"week",children:"Última semana"}),X.jsx("option",{value:"month",children:"Último mês"})]})]})]}),X.jsxs("div",{className:"flex space-x-2",children:[X.jsx("button",{onClick:async()=>{u(!0),h(null);try{let e=[];if("day"===p){const t=Je(s);e=await zt.getHistoryByDate(t);const r=await zt.getDailySummary(t);l(r)}else{const t=new Date(s),r=new Date(s);"week"===p?r.setDate(r.getDate()-7):"month"===p&&r.setMonth(r.getMonth()-1),e=await zt.getHistoryByDateRange(Je(r),Je(t)),l(null)}i(e),r&&r(e),e.length>0&&a?.(e),0===e.length&&h("Nenhum registro encontrado para o período selecionado.")}catch(e){h("Erro ao carregar histórico. Tente novamente.")}finally{u(!1)}},disabled:d,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d?"Carregando...":"Carregar Histórico"}),X.jsx("button",{onClick:()=>{const e=Ke(new Date);n(e),g("day")},className:"px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",title:"Carregar dia atual",children:"Hoje"})]}),m&&X.jsx("div",{className:"p-2 bg-red-900/20 border border-red-400 rounded-md",children:X.jsx("p",{className:"text-xs text-red-400",children:m})}),c&&X.jsxs("div",{className:"bg-gray-900 rounded p-3 border border-gray-600",children:[X.jsx("h4",{className:"text-xs font-medium text-gray-400 mb-2",children:"Resumo do Dia"}),X.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Uploads:"}),X.jsx("span",{className:"text-gray-200",children:c.banking_total_uploaded})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Conferidos:"}),X.jsx("span",{className:"text-green-400",children:c.total_conferred||0})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Não encontrados:"}),X.jsx("span",{className:"text-red-400",children:c.cash_not_found_count})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Valor total:"}),X.jsx("span",{className:"text-indigo-400",children:(x=c.total_value||0,new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x))})]})]})]}),o.length>0&&X.jsxs("div",{className:"space-y-4",children:[X.jsxs("div",{className:"flex justify-between items-center",children:[X.jsx("h4",{className:"text-sm font-medium text-gray-200",children:"Dados do Histórico"}),X.jsx(Ht,{data:{history:o},prefix:"historico",date:Je(s),disabled:0===o.length})]}),X.jsx(Pt,{historyData:o,onExport:()=>{}})]}),d&&X.jsx("div",{className:"flex items-center justify-center py-8",children:X.jsxs("svg",{className:"animate-spin h-8 w-8 text-indigo-500",fill:"none",viewBox:"0 0 24 24",children:[X.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),X.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]})]});var x};function Jt({items:e,itemHeight:t,height:r,renderItem:a,className:s=""}){return 0===e.length?X.jsx("div",{className:`flex items-center justify-center ${s}`,style:{height:r},children:X.jsx("p",{className:"text-gray-400 text-sm",children:"Nenhum item para exibir"})}):X.jsx(qe,{height:r,itemCount:e.length,itemSize:t,className:s,overscanCount:5,children:a})}const Xt=({className:t=""})=>{const[r,a]=e.useState(Ke(new Date)),[s,n]=e.useState([]),[o,i]=e.useState(!1),[c,l]=e.useState(null),[d,u]=e.useState("all"),[m,h]=e.useState("all"),p=e.useMemo(()=>s.filter(e=>{const t="all"===d||e.action_type===d,r="all"===m||e.result===m;return t&&r}),[s,d,m]),g=e=>{switch(e){case"banking_upload":return"Upload Bancário";case"cash_conference":return"Conferência";case"manual_entry":return"Lançamento Manual";case"transfer":return"Transferência";case"undo":return"Desfazer";case"not_found":return"Não Encontrado";default:return e}},x=e=>{switch(e){case"success":return X.jsx("span",{className:"px-2 py-1 text-xs bg-green-900/30 text-green-400 border border-green-600 rounded",children:"Sucesso"});case"error":return X.jsx("span",{className:"px-2 py-1 text-xs bg-red-900/30 text-red-400 border border-red-600 rounded",children:"Erro"});case"warning":return X.jsx("span",{className:"px-2 py-1 text-xs bg-yellow-900/30 text-yellow-400 border border-yellow-600 rounded",children:"Aviso"});default:return null}};return X.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 border border-gray-700 ${t}`,children:[X.jsxs("h3",{className:"text-sm font-semibold text-gray-100 mb-3 flex items-center",children:[X.jsx("span",{className:"bg-purple-600 text-white w-6 h-6 rounded-full flex items-center justify-center mr-2 text-xs",children:"📝"}),"Histórico de Ações"]}),X.jsxs("div",{className:"space-y-3",children:[X.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[X.jsxs("div",{children:[X.jsx("label",{htmlFor:"action-date-input",className:"block text-xs text-gray-400 mb-1",children:"Data"}),X.jsx("input",{id:"action-date-input",type:"date",value:r,onChange:e=>a(e.target.value),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),X.jsxs("div",{children:[X.jsx("label",{htmlFor:"action-type-filter",className:"block text-xs text-gray-400 mb-1",children:"Tipo de Ação"}),X.jsxs("select",{id:"action-type-filter",value:d,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[X.jsx("option",{value:"all",children:"Todas"}),X.jsx("option",{value:"banking_upload",children:"Upload Bancário"}),X.jsx("option",{value:"cash_conference",children:"Conferência"}),X.jsx("option",{value:"manual_entry",children:"Lançamento Manual"}),X.jsx("option",{value:"transfer",children:"Transferência"}),X.jsx("option",{value:"undo",children:"Desfazer"}),X.jsx("option",{value:"not_found",children:"Não Encontrado"})]})]}),X.jsxs("div",{children:[X.jsx("label",{htmlFor:"result-filter",className:"block text-xs text-gray-400 mb-1",children:"Resultado"}),X.jsxs("select",{id:"result-filter",value:m,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[X.jsx("option",{value:"all",children:"Todos"}),X.jsx("option",{value:"success",children:"Sucesso"}),X.jsx("option",{value:"error",children:"Erro"}),X.jsx("option",{value:"warning",children:"Aviso"})]})]})]}),X.jsxs("div",{className:"flex space-x-2",children:[X.jsx("button",{onClick:async()=>{i(!0),l(null);try{const e=Je(r),t=bt.action_log.where("day").equals(e),a=await t.toArray();a.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()),n(a),0===a.length&&l("Nenhuma ação encontrada para a data selecionada.")}catch(e){l("Erro ao carregar histórico de ações. Tente novamente.")}finally{i(!1)}},disabled:o,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-purple-600 rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Carregando...":"Carregar Histórico"}),X.jsx(Ht,{data:{actions:p},prefix:"acoes",date:Je(r),disabled:0===p.length}),X.jsx("button",{onClick:()=>{const e=Ke(new Date);a(e)},className:"px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",title:"Carregar dia atual",children:"Hoje"})]}),c&&X.jsx("div",{className:"p-2 bg-red-900/20 border border-red-400 rounded-md",children:X.jsx("p",{className:"text-xs text-red-400",children:c})}),p.length>0&&X.jsxs("div",{className:"bg-gray-900 rounded p-3 border border-gray-600",children:[X.jsx("h4",{className:"text-xs font-medium text-gray-400 mb-2",children:"Resumo"}),X.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Total:"}),X.jsx("span",{className:"text-gray-200",children:p.length})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Sucessos:"}),X.jsx("span",{className:"text-green-400",children:p.filter(e=>"success"===e.result).length})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Erros:"}),X.jsx("span",{className:"text-red-400",children:p.filter(e=>"error"===e.result).length})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Avisos:"}),X.jsx("span",{className:"text-yellow-400",children:p.filter(e=>"warning"===e.result).length})]})]})]}),p.length>0&&X.jsx("div",{className:"bg-gray-900 rounded border border-gray-600",children:X.jsx(Jt,{items:p,itemHeight:120,height:400,renderItem:({index:e,style:t})=>{const r=p[e];return X.jsxs("div",{style:t,className:"flex items-start space-x-3 p-3 border-b border-gray-700 hover:bg-gray-700/30 transition-colors",children:[X.jsx("div",{className:"flex-shrink-0 mt-1",children:x(r.result)}),X.jsxs("div",{className:"flex-1 min-w-0",children:[X.jsxs("div",{className:"flex items-center justify-between mb-1",children:[X.jsx("h4",{className:"text-sm font-medium text-gray-200 truncate",children:g(r.action_type)}),X.jsx("span",{className:"text-xs text-gray-400",children:Ge(r.timestamp)})]}),X.jsx("p",{className:"text-sm text-gray-300 mb-2",children:r.action_description}),r.payload.values&&r.payload.values.length>0&&X.jsxs("div",{className:"text-xs text-gray-400 mb-1",children:["Valores: ",r.payload.values.map(e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)).join(", ")]}),r.payload.source_ids&&r.payload.source_ids.length>0&&X.jsxs("div",{className:"text-xs text-gray-400 mb-1",children:["IDs: ",r.payload.source_ids.slice(0,2).join(", "),r.payload.source_ids.length>2&&` +${r.payload.source_ids.length-2} mais`]}),r.error_message&&X.jsxs("div",{className:"text-xs text-red-400 mt-1 p-2 bg-red-900/20 rounded",children:["Erro: ",r.error_message]})]})]})},className:"custom-scrollbar"})}),o&&X.jsx("div",{className:"flex items-center justify-center py-8",children:X.jsxs("svg",{className:"animate-spin h-8 w-8 text-purple-500",fill:"none",viewBox:"0 0 24 24",children:[X.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),X.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]})]})};const Kt=new class{constructor(){this.currentUser=null,this.currentSession=null,this.initializeAuth()}async initializeAuth(){const{data:{session:e}}=await Y.auth.getSession();e&&(this.currentSession=e,this.currentUser=e.user),Y.auth.onAuthStateChange((e,t)=>{this.currentSession=t,this.currentUser=t?.user??null})}async signUp(e,t){try{const{data:r,error:a}=await Y.auth.signUp({email:e.email,password:e.password,options:{data:{username:t?.username,full_name:t?.fullName}}});if(a)throw a;if(r.user){const{error:a}=await Y.from("profiles").insert([{id:r.user.id,username:t?.username||e.email.split("@")[0],full_name:t?.fullName,role:"user",is_active:!0}])}return{data:r,error:null}}catch(r){return{data:null,error:r}}}async signIn(e){try{const{data:t,error:r}=await Y.auth.signInWithPassword({email:e.email,password:e.password});if(r)throw r;return this.currentUser=t.user,this.currentSession=t.session,{data:t,error:null}}catch(t){return{data:null,error:t}}}async signOut(){try{const{error:e}=await Y.auth.signOut();if(e)throw e;return this.currentUser=null,this.currentSession=null,{error:null}}catch(e){return{error:e}}}async resetPassword(e){try{const{error:t}=await Y.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/reset-password`});if(t)throw t;return{error:null}}catch(t){return{error:t}}}async updatePassword(e){try{const{error:t}=await Y.auth.updateUser({password:e});if(t)throw t;return{error:null}}catch(t){return{error:t}}}async getProfile(){if(!this.currentUser)return null;try{const{data:e,error:t}=await Y.from("profiles").select("*").eq("id",this.currentUser.id).single();if(t)throw t;return{id:e.id,email:this.currentUser.email,username:e.username,fullName:e.full_name,avatarUrl:e.avatar_url,role:e.role,isActive:e.is_active}}catch(e){return null}}async updateProfile(e){if(!this.currentUser)return{error:new Error("No user logged in")};try{const{error:t}=await Y.from("profiles").update({username:e.username,full_name:e.fullName,avatar_url:e.avatarUrl}).eq("id",this.currentUser.id);if(t)throw t;return{error:null}}catch(t){return{error:t}}}getUser(){return this.currentUser}getSession(){return this.currentSession}isAuthenticated(){return!!this.currentSession}async checkSession(){const{data:{session:e}}=await Y.auth.getSession();return!!e}async refreshSession(){const{data:{session:e},error:t}=await Y.auth.refreshSession();return t?{session:null,error:t}:(this.currentSession=e,this.currentUser=e?.user??null,{session:e,error:null})}};const Yt=new class{constructor(){this.userId=null,this.initializeUser()}async initializeUser(){const e=Kt.getUser();e&&(this.userId=e.id),Y.auth.onAuthStateChange((e,t)=>{this.userId=t?.user?.id??null})}ensureAuthenticated(){if(!this.userId)throw new Error("User not authenticated")}async uploadBankingFile(e,t,r){this.ensureAuthenticated();const a=performance.now();try{const s=t.reduce((e,t)=>e+(t.value||0),0),{data:n,error:o}=await Y.from("banking_files").insert({user_id:this.userId,file_name:e,operation_date:r?.toISOString().split("T")[0],total_transactions:t.length,total_value:s,status:"processing"}).select().single();if(o)throw o;const{error:i}=await ae(this.userId,n.id,t);if(i)throw i;await Y.from("banking_files").update({status:"completed"}).eq("id",n.id);const c=performance.now()-a;return Rt.logOperation("supabase_upload_file",c,{fileName:e,transactionCount:t.length}),{fileId:n.id,fileName:n.file_name,totalTransactions:n.total_transactions,totalValue:n.total_value}}catch(s){throw s}}async searchTransactionsByValue(e,t=.01){this.ensureAuthenticated();const r=performance.now();try{const{data:t,error:a}=await G(this.userId,e);if(a)throw a;const s=performance.now()-r;return Rt.logOperation("supabase_search_value",s,{value:e,resultCount:t?.length||0}),t||[]}catch(a){return[]}}async getTransactionsByDateRange(e,t){this.ensureAuthenticated();try{const{data:r,error:a}=await Y.from("banking_transactions").select("*").eq("user_id",this.userId).gte("transaction_date",e.toISOString().split("T")[0]).lte("transaction_date",t.toISOString().split("T")[0]).order("transaction_date",{ascending:!1});if(a)throw a;return r||[]}catch(r){return[]}}async transferToConference(e){this.ensureAuthenticated();const t=performance.now();try{const{data:r,error:a}=await Z(this.userId,e);if(a)throw a;const s=performance.now()-t;Rt.logOperation("supabase_transfer",s,{transactionId:e});const{data:n,error:o}=await Y.from("cash_conference").select("*").eq("transaction_id",e).single();if(o)throw o;return{conferenceId:n.id,transactionId:n.transaction_id,value:n.conferred_value}}catch(r){return null}}async removeFromConference(e){this.ensureAuthenticated();try{const{data:t,error:r}=await Q(this.userId,e);if(r)throw r;return!0}catch(t){return!1}}async getActiveConferences(){this.ensureAuthenticated();try{const{data:e,error:t}=await se(this.userId);if(t)throw t;return e||[]}catch(e){return[]}}async addManualEntry(e){this.ensureAuthenticated();try{const{data:t,error:r}=await Y.from("manual_entries").insert({user_id:this.userId,document_number:e.documentNumber,description:e.description,value:e.value,entry_type:e.entryType,category:e.category,is_link:e.isLink||!1}).select().single();if(r)throw r;return t}catch(t){throw t}}async getManualEntries(e){this.ensureAuthenticated();try{let t=Y.from("manual_entries").select("*").eq("user_id",this.userId);if(e){const r=e.toISOString().split("T")[0];t=t.eq("entry_date",r)}const{data:r,error:a}=await t.order("created_at",{ascending:!1});if(a)throw a;return r||[]}catch(t){return[]}}async deleteManualEntry(e){this.ensureAuthenticated();try{const{error:t}=await Y.from("manual_entries").delete().eq("id",e).eq("user_id",this.userId);if(t)throw t;return!0}catch(t){return!1}}async registerNotFound(e,t){this.ensureAuthenticated();try{const{data:r,error:a}=await ee(this.userId,e,t);if(a)throw a;return r}catch(r){return null}}async getNotFoundHistory(){this.ensureAuthenticated();try{const{data:e,error:t}=await ne(this.userId);if(t)throw t;return e||[]}catch(e){return[]}}async getUserStatistics(){this.ensureAuthenticated();try{const{data:e,error:t}=await te(this.userId);if(t)throw t;return e}catch(e){return null}}async restartWorkDay(){this.ensureAuthenticated();try{const{data:e,error:t}=await re(this.userId);if(t)throw t;return!0}catch(e){return!1}}async logPerformance(e,t,r){try{await Y.from("performance_logs").insert({user_id:this.userId,operation:e,duration_ms:t,metadata:r})}catch(a){}}async logAudit(e,t,r,a,s){try{await Y.from("audit_logs").insert({user_id:this.userId,action:e,table_name:t,record_id:r,old_data:a,new_data:s})}catch(n){}}async batchTransferToConference(e){this.ensureAuthenticated();const t=[];for(const r of e){const e=await this.transferToConference(r);e&&t.push(e)}return t}async exportConferences(e,t){this.ensureAuthenticated();try{let r=Y.from("cash_conference").select("*").eq("user_id",this.userId);e&&t&&(r=r.gte("conference_date",e.toISOString().split("T")[0]).lte("conference_date",t.toISOString().split("T")[0]));const{data:a,error:s}=await r.order("conference_date",{ascending:!1});if(s)throw s;return a||[]}catch(r){return[]}}};const Gt=new class{constructor(){this.bucketName="backups"}async initializeBucket(){try{const{data:e}=await Y.storage.listBuckets(),t=e?.some(e=>e.name===this.bucketName);if(!t){const{error:e}=await Y.storage.createBucket(this.bucketName,{public:!1,fileSizeLimit:52428800});if(e)if(e.message.includes("already exists"));else if(!e.message.includes("row-level security")&&!e.message.includes("RLS"))throw e}}catch(e){}}async createBackup(e,t,r=!0,a=!0,s=!0){const n=Kt.getUser();if(!n)throw new Error("User not authenticated");try{await this.initializeBucket();const o={metadata:{createdAt:(new Date).toISOString(),userId:n.id,userEmail:n.email,version:"1.0.0",type:e&&t?"partial":"full"},data:{}};r&&(o.data.conferences=await Yt.exportConferences(e,t)),a&&e&&t&&(o.data.transactions=await Yt.getTransactionsByDateRange(e,t)),s&&(o.data.manualEntries=await Yt.getManualEntries()),o.data.notFoundHistory=await Yt.getNotFoundHistory(),o.data.statistics=await Yt.getUserStatistics();const i=B.book_new(),c=B.json_to_sheet([o.metadata]);if(B.book_append_sheet(i,c,"Metadata"),o.data.conferences?.length>0){const e=B.json_to_sheet(o.data.conferences);B.book_append_sheet(i,e,"Conferences")}if(o.data.transactions?.length>0){const e=B.json_to_sheet(o.data.transactions);B.book_append_sheet(i,e,"Transactions")}if(o.data.manualEntries?.length>0){const e=B.json_to_sheet(o.data.manualEntries);B.book_append_sheet(i,e,"ManualEntries")}if(o.data.notFoundHistory?.length>0){const e=B.json_to_sheet(o.data.notFoundHistory);B.book_append_sheet(i,e,"NotFound")}const l=O(i,{bookType:"xlsx",type:"array"}),d=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=`backup_${(new Date).toISOString().replace(/[:.]/g,"-")}.xlsx`,m=`${n.id}/${u}`,{data:h,error:p}=await Y.storage.from(this.bucketName).upload(m,d,{contentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",upsert:!1});if(p)throw p;const g=(o.data.conferences?.length||0)+(o.data.transactions?.length||0)+(o.data.manualEntries?.length||0)+(o.data.notFoundHistory?.length||0);return{id:h.path,fileName:u,createdAt:new Date,size:d.size,recordCount:g,type:o.metadata.type}}catch(o){return null}}async listBackups(){const e=Kt.getUser();if(!e)throw new Error("User not authenticated");try{const{data:t,error:r}=await Y.storage.from(this.bucketName).list(e.id,{limit:100,sortBy:{column:"created_at",order:"desc"}});if(r)throw r;return(t||[]).map(t=>({id:`${e.id}/${t.name}`,fileName:t.name,createdAt:new Date(t.created_at),size:t.metadata?.size||0,recordCount:0,type:"full"}))}catch(t){return[]}}async downloadBackup(e){if(!Kt.getUser())throw new Error("User not authenticated");try{const{data:t,error:r}=await Y.storage.from(this.bucketName).download(e);if(r)throw r;return t}catch(t){return null}}async restoreFromBackup(e){const t=Kt.getUser();if(!t)throw new Error("User not authenticated");try{const r=await this.downloadBackup(e);if(!r)throw new Error("Failed to download backup");const a=await r.arrayBuffer(),s=M(a,{type:"array"}),n=s.Sheets.Metadata;if(B.sheet_to_json(n)[0].userId!==t.id)throw new Error("Backup belongs to different user");if(s.Sheets.Conferences){B.sheet_to_json(s.Sheets.Conferences)}if(s.Sheets.Transactions){B.sheet_to_json(s.Sheets.Transactions)}if(s.Sheets.ManualEntries){B.sheet_to_json(s.Sheets.ManualEntries)}return!0}catch(r){return!1}}async deleteBackup(e){if(!Kt.getUser())throw new Error("User not authenticated");try{const{error:t}=await Y.storage.from(this.bucketName).remove([e]);if(t)throw t;return!0}catch(t){return!1}}async scheduleAutoBackup(e=24){setInterval(async()=>{await this.createBackup()},60*e*60*1e3)}async getBackupUrl(e){if(!Kt.getUser())throw new Error("User not authenticated");try{const{data:t}=Y.storage.from(this.bucketName).getPublicUrl(e);return t.publicUrl}catch(t){return null}}async getSignedBackupUrl(e,t=3600){if(!Kt.getUser())throw new Error("User not authenticated");try{const{data:r,error:a}=await Y.storage.from(this.bucketName).createSignedUrl(e,t);if(a)throw a;return r.signedUrl}catch(r){return null}}},Zt=({className:t=""})=>{const[r,a]=e.useState(Ke(new Date)),[s,o]=e.useState(!1),[i,c]=e.useState(!1),[l]=e.useState(null),[d,u]=e.useState(null),[m,h]=e.useState(null),p=async e=>{if(d){c(!0);try{const t=await Gt.importDayBackup(d,e);h(t),t.errors.length>0?n.error(`Importação concluída com ${t.errors.length} erros. ${t.imported} importados, ${t.skipped} ignorados.`):n.success(`Backup importado com sucesso! ${t.imported} registros importados, ${t.skipped} ignorados.`)}catch(t){n.error(t instanceof Error?t.message:"Erro ao importar backup")}finally{c(!1)}}},g=()=>{l(null),u(null),h(null);const e=document.getElementById("backup-file-input");e&&(e.value="")};return X.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 border border-gray-700 ${t}`,children:[X.jsxs("h3",{className:"text-sm font-semibold text-gray-100 mb-4 flex items-center",children:[X.jsx("span",{className:"bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center mr-2 text-xs",children:"💾"}),"Backup e Restauração"]}),X.jsxs("div",{className:"space-y-6",children:[X.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 border border-gray-600",children:[X.jsxs("h4",{className:"text-sm font-medium text-gray-200 mb-3 flex items-center",children:[X.jsx("svg",{className:"w-4 h-4 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),"Exportar Backup do Dia"]}),X.jsxs("div",{className:"space-y-3",children:[X.jsxs("div",{children:[X.jsx("label",{htmlFor:"backup-date-input",className:"block text-xs text-gray-400 mb-1",children:"Data para backup"}),X.jsx("input",{id:"backup-date-input",type:"date",value:r,onChange:e=>a(e.target.value),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),X.jsx("button",{onClick:async()=>{o(!0);try{const e=Je(r),t=await Gt.exportDayBackup(e);Gt.downloadBackup(t),n.success(`Backup do dia ${e} exportado com sucesso! ${t.metadata.total_records} registros.`)}catch(e){n.error(e instanceof Error?e.message:"Erro ao exportar backup")}finally{o(!1)}},disabled:s,className:"w-full px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:s?X.jsxs(X.Fragment,{children:[X.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[X.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),X.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Exportando..."]}):X.jsxs(X.Fragment,{children:[X.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),"Exportar Backup JSON"]})}),X.jsx("p",{className:"text-xs text-gray-400",children:"Exporta todas as tabelas do dia selecionado em formato JSON para backup seguro."})]})]}),X.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 border border-gray-600",children:[X.jsxs("h4",{className:"text-sm font-medium text-gray-200 mb-3 flex items-center",children:[X.jsx("svg",{className:"w-4 h-4 text-blue-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),"Importar Backup"]}),X.jsxs("div",{className:"space-y-3",children:[X.jsxs("div",{children:[X.jsx("label",{htmlFor:"backup-file-input",className:"block text-xs text-gray-400 mb-1",children:"Selecionar arquivo de backup (.json)"}),X.jsx("input",{id:"backup-file-input",type:"file",accept:".json",onChange:async e=>{const t=e.target.files?.[0];if(t){l(t),u(null),h(null);try{const e=await Gt.readBackupFromFile(t),r=Gt.validateBackup(e);if(!r.valid)return n.error(`Backup inválido: ${r.errors.join(", ")}`),void l(null);u(e),n.success("Backup carregado e validado com sucesso!")}catch(r){n.error(r instanceof Error?r.message:"Erro ao ler arquivo de backup"),l(null)}}},className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-1 file:px-2 file:rounded file:border-0 file:bg-blue-600 file:text-white file:text-xs hover:file:bg-blue-700"})]}),d&&X.jsxs("div",{className:"bg-gray-800 rounded p-3 border border-gray-600",children:[X.jsx("h5",{className:"text-xs font-medium text-gray-300 mb-2",children:"Preview do Backup"}),X.jsxs("div",{className:"text-xs text-gray-400 space-y-1",children:[X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Data:"}),X.jsx("span",{className:"text-gray-200",children:d.backup_date})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Exportado em:"}),X.jsx("span",{className:"text-gray-200",children:Ge(d.export_timestamp)})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Total registros:"}),X.jsx("span",{className:"text-gray-200",children:d.metadata.total_records})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Usuário:"}),X.jsx("span",{className:"text-gray-200",children:d.user_id})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Versão:"}),X.jsx("span",{className:"text-gray-200",children:d.version})]})]}),X.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-600",children:[X.jsx("h6",{className:"text-xs font-medium text-gray-300 mb-2",children:"Registros por Tabela"}),X.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-400",children:[X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Uploads:"}),X.jsx("span",{className:"text-gray-200",children:d.tables.bank_uploads.length})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Bancário:"}),X.jsx("span",{className:"text-gray-200",children:d.tables.bank_entries.length})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Caixa:"}),X.jsx("span",{className:"text-gray-200",children:d.tables.cash_conference_entries.length})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Manual:"}),X.jsx("span",{className:"text-gray-200",children:d.tables.manual_entries.length})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Não encontrados:"}),X.jsx("span",{className:"text-gray-200",children:d.tables.not_found_history.length})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{children:"Ações:"}),X.jsx("span",{className:"text-gray-200",children:d.tables.action_log.length})]})]})]})]}),d&&!m&&X.jsxs("div",{className:"flex space-x-2",children:[X.jsx("button",{onClick:()=>p("merge"),disabled:i,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?"Importando...":"Mesclar"}),X.jsx("button",{onClick:()=>p("replace"),disabled:i,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-orange-600 rounded-md hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?"Importando...":"Substituir"}),X.jsx("button",{onClick:g,disabled:i,className:"px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Cancelar"})]}),m&&X.jsxs("div",{className:"bg-gray-800 rounded p-3 border border-gray-600",children:[X.jsx("h5",{className:"text-xs font-medium text-gray-300 mb-2",children:"Resultado da Importação"}),X.jsxs("div",{className:"text-xs space-y-1",children:[X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Importados:"}),X.jsx("span",{className:"text-green-400",children:m.imported})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Ignorados:"}),X.jsx("span",{className:"text-yellow-400",children:m.skipped})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-400",children:"Erros:"}),X.jsx("span",{className:"text-red-400",children:m.errors.length})]})]}),m.errors.length>0&&X.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-600",children:[X.jsx("h6",{className:"text-xs font-medium text-red-400 mb-2",children:"Erros de Importação"}),X.jsx("div",{className:"max-h-32 overflow-y-auto custom-scrollbar",children:m.errors.map((e,t)=>X.jsx("div",{className:"text-xs text-red-400 mb-1",children:e},t))})]}),X.jsx("button",{onClick:g,className:"mt-3 w-full px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Novo Backup"})]}),X.jsxs("div",{className:"text-xs text-gray-400 space-y-1",children:[X.jsxs("p",{children:[X.jsx("strong",{children:"Mesclar:"})," Mantém dados existentes, adiciona apenas novos registros."]}),X.jsxs("p",{children:[X.jsx("strong",{children:"Substituir:"})," Remove todos os dados do dia e importa do backup."]})]})]})]})]})]})},Qt=({error:e,className:t="",fieldId:r})=>{if(!e)return null;const a=r?`${r}-error`:void 0;return X.jsxs("div",{id:a,className:`mt-1 text-sm text-red-400 flex items-start space-x-2 ${t}`,role:"alert","aria-live":"polite",children:[X.jsx("svg",{className:"w-4 h-4 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:X.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),X.jsx("span",{children:e})]})},er=(e,t)=>{const r=Boolean(t);return{"aria-invalid":r,"aria-describedby":r?`${e}-error`:void 0,className:r?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-600 focus:border-indigo-500 focus:ring-indigo-500"}},tr={excel_parse:"Parse Excel",excel_filter:"Filtro Excel",conference_search:"Busca Conferência",conference_transfer:"Transferência",manual_entry_save:"Salvar Manual",data_export:"Export Dados",cache_operations:"Cache Ops"},rr=e=>e<1e3?`${e.toFixed(1)}ms`:`${(e/1e3).toFixed(2)}s`,ar=({isVisible:t,onToggle:r})=>{const[a,s]=e.useState([]),[n,o]=e.useState(Rt.isLoggingEnabled()),[i,c]=e.useState(0),[l,d]=e.useState(!1);e.useEffect(()=>{t&&n&&u()},[t,n,i]);const u=async()=>{d(!0);try{const e=await Rt.getTodaysStats();s(e)}catch(e){}finally{d(!1)}},m=()=>{const e=!n;Rt.setEnabled(e),o(e),e?u():s([])};return t?X.jsxs("div",{className:"fixed bottom-4 right-4 z-50 w-96 max-h-96 bg-gray-900 border border-gray-700 rounded-lg shadow-2xl",children:[X.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-700",children:[X.jsx("h3",{className:"text-sm font-semibold text-gray-100 flex items-center",children:"📊 Performance Monitor"}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx("button",{onClick:m,className:"px-2 py-1 text-xs rounded transition-colors "+(n?"bg-green-600 text-white hover:bg-green-700":"bg-gray-600 text-gray-300 hover:bg-gray-500"),title:n?"Desabilitar logging":"Habilitar logging",children:n?"ON":"OFF"}),X.jsx("button",{onClick:r,className:"px-2 py-1 text-xs text-gray-400 hover:text-gray-200 transition-colors",title:"Fechar painel",children:"✕"})]})]}),X.jsx("div",{className:"p-3",children:n?X.jsxs(X.Fragment,{children:[X.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[X.jsxs("button",{onClick:()=>{c(e=>e+1)},disabled:l,className:"px-2 py-1 text-xs bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 transition-colors",children:[l?"⟳":"🔄"," Refresh"]}),X.jsx("button",{onClick:async()=>{confirm("Limpar todas as métricas de performance?")&&(await Rt.clearAllMetrics(),s([]),c(e=>e+1))},className:"px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"🗑️ Limpar"}),X.jsx("button",{onClick:async()=>{try{const e=await Rt.exportMetrics(),t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`performance-metrics-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}catch(e){}},className:"px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"💾 Export"})]}),X.jsx("div",{className:"max-h-64 overflow-y-auto",children:l?X.jsx("div",{className:"text-center py-4",children:X.jsx("p",{className:"text-sm text-gray-400",children:"Carregando estatísticas..."})}):0===a.length?X.jsx("div",{className:"text-center py-4",children:X.jsx("p",{className:"text-sm text-gray-400",children:"Nenhuma métrica registrada hoje"})}):X.jsxs("div",{className:"space-y-2",children:[X.jsxs("div",{className:"grid grid-cols-5 gap-1 text-xs text-gray-400 font-semibold border-b border-gray-700 pb-1",children:[X.jsx("span",{children:"Operação"}),X.jsx("span",{className:"text-center",children:"Count"}),X.jsx("span",{className:"text-right",children:"Avg"}),X.jsx("span",{className:"text-right",children:"P95"}),X.jsx("span",{className:"text-right",children:"Max"})]}),a.map(e=>X.jsxs("div",{className:"grid grid-cols-5 gap-1 text-xs text-gray-300 py-1 hover:bg-gray-800 rounded px-1",children:[X.jsx("span",{className:"truncate",title:tr[e.operation],children:tr[e.operation]}),X.jsx("span",{className:"text-center text-gray-400",children:e.count}),X.jsx("span",{className:"text-right font-mono",children:rr(e.average)}),X.jsx("span",{className:"text-right font-mono text-yellow-400",children:rr(e.p95)}),X.jsx("span",{className:"text-right font-mono text-red-400",children:rr(e.max)})]},e.operation)),X.jsx("div",{className:"pt-2 mt-2 border-t border-gray-700",children:X.jsxs("div",{className:"text-xs text-gray-400",children:[X.jsxs("p",{children:["Total operations: ",a.reduce((e,t)=>e+t.count,0)]}),X.jsxs("p",{children:["Total time: ",rr(a.reduce((e,t)=>e+t.totalTime,0))]})]})})]})})]}):X.jsxs("div",{className:"text-center py-4",children:[X.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Performance logging está desabilitado"}),X.jsx("button",{onClick:m,className:"px-3 py-1 text-xs bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors",children:"Habilitar"})]})}),n&&a.length>0&&X.jsx("div",{className:"p-2 border-t border-gray-700 bg-gray-800",children:(()=>{const e=a[0];if(e?.p95>1e3)return X.jsxs("div",{className:"text-xs text-yellow-400",children:["⚠️ ",tr[e.operation]," está lento (P95: ",rr(e.p95),")"]});const t=a.reduce((e,t)=>e+t.count,0);return t>100?X.jsxs("div",{className:"text-xs text-blue-400",children:["✓ ",t," operações monitoradas hoje"]}):X.jsx("div",{className:"text-xs text-gray-400",children:"📊 Coletando dados de performance..."})})()})]}):X.jsx("button",{onClick:r,className:"fixed bottom-4 right-4 z-50 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg border border-gray-600 hover:bg-gray-700 transition-colors",title:"Abrir painel de performance",children:"📊 Perf"})},sr=[{keys:["Ctrl","L"],description:"Focar no campo de valor",context:"Global"},{keys:["Ctrl","F"],description:"Focar no filtro de data",context:"Global"},{keys:["Enter"],description:"Confirmar ação atual",context:"Global"},{keys:["Esc"],description:"Fechar modais",context:"Global"},{keys:["Enter"],description:"Adicionar lançamento",context:"Lançamentos (quando no input de valor)"},{keys:["Enter"],description:"Selecionar primeiro item",context:"Modal de seleção"}],nr=()=>{const[t,a]=e.useState(!1);return t?X.jsxs("div",{className:"fixed bottom-4 left-4 z-50 w-96 max-h-80 bg-gray-900 border border-gray-700 rounded-lg shadow-2xl",children:[X.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-700",children:[X.jsx("h3",{className:"text-sm font-semibold text-gray-100 flex items-center",children:"⌨️ Atalhos de Teclado"}),X.jsx("button",{onClick:()=>a(!1),className:"px-2 py-1 text-xs text-gray-400 hover:text-gray-200 transition-colors",title:"Fechar",children:"✕"})]}),X.jsxs("div",{className:"p-3 max-h-64 overflow-y-auto",children:[X.jsx("div",{className:"space-y-3",children:sr.map((e,t)=>{return X.jsx("div",{className:"flex items-start justify-between",children:X.jsxs("div",{className:"flex-1 min-w-0",children:[X.jsx("div",{className:"flex items-center space-x-2 mb-1",children:(a=e.keys,a.map((e,t)=>X.jsxs(r.Fragment,{children:[t>0&&X.jsx("span",{className:"text-gray-400 mx-1",children:"+"}),X.jsx("kbd",{className:"px-2 py-1 text-xs bg-gray-700 border border-gray-600 rounded text-gray-200 font-mono",children:e})]},e)))}),X.jsx("p",{className:"text-sm text-gray-300",children:e.description}),e.context&&X.jsx("p",{className:"text-xs text-gray-500 mt-1",children:e.context})]})},t);var a})}),X.jsx("div",{className:"mt-4 pt-3 border-t border-gray-700",children:X.jsxs("div",{className:"text-xs text-gray-400",children:[X.jsxs("p",{className:"mb-1",children:["💡 ",X.jsx("strong",{children:"Dicas:"})]}),X.jsxs("ul",{className:"space-y-1 ml-4",children:[X.jsx("li",{children:"• Os atalhos funcionam em toda a aplicação"}),X.jsxs("li",{children:["• ",X.jsx("kbd",{className:"px-1 py-0.5 bg-gray-700 rounded text-gray-200",children:"Ctrl+L"})," sempre foca no campo de valor mais próximo"]}),X.jsxs("li",{children:["• ",X.jsx("kbd",{className:"px-1 py-0.5 bg-gray-700 rounded text-gray-200",children:"Enter"})," confirma a ação do contexto atual"]}),X.jsxs("li",{children:["• ",X.jsx("kbd",{className:"px-1 py-0.5 bg-gray-700 rounded text-gray-200",children:"Esc"})," sempre fecha modais e volta o foco"]})]})]})})]})]}):X.jsxs("button",{onClick:()=>a(!0),className:"fixed bottom-4 left-4 z-40 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg border border-gray-600 hover:bg-gray-700 transition-colors flex items-center space-x-2",title:"Mostrar atalhos de teclado",children:[X.jsx("span",{children:"⌨️"}),X.jsx("span",{children:"Atalhos"})]})};const or=new class{constructor(){this.syncStatus={lastSync:null,pendingChanges:0,isOnline:navigator.onLine,isSyncing:!1},this.syncListeners=new Set,this.syncInterval=null,this.indexedDbService=new At,this.initializeSync()}initializeSync(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),this.startPeriodicSync();const e=localStorage.getItem("lastSyncTime");e&&(this.syncStatus.lastSync=new Date(e))}handleOnline(){this.syncStatus.isOnline=!0,this.notifyListeners(),this.syncData()}handleOffline(){this.syncStatus.isOnline=!1,this.notifyListeners()}startPeriodicSync(){this.syncInterval=setInterval(()=>{this.syncStatus.isOnline&&!this.syncStatus.isSyncing&&this.syncData()},3e4)}stopPeriodicSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null)}async syncData(){if(!this.syncStatus.isOnline)return{success:!1,uploaded:0,downloaded:0,errors:["App is offline"]};if(!Kt.isAuthenticated())return{success:!1,uploaded:0,downloaded:0,errors:["User not authenticated"]};if(this.syncStatus.isSyncing)return{success:!1,uploaded:0,downloaded:0,errors:["Sync already in progress"]};this.syncStatus.isSyncing=!0,this.notifyListeners();const e={success:!1,uploaded:0,downloaded:0,errors:[]};try{const t=await this.uploadLocalChanges();e.uploaded=t.count,t.errors.length>0&&e.errors.push(...t.errors);const r=await this.downloadRemoteChanges();e.downloaded=r.count,r.errors.length>0&&e.errors.push(...r.errors),this.syncStatus.lastSync=new Date,this.syncStatus.pendingChanges=await this.countPendingChanges(),localStorage.setItem("lastSyncTime",this.syncStatus.lastSync.toISOString()),e.success=0===e.errors.length}catch(t){e.errors.push(t instanceof Error?t.message:"Unknown sync error")}finally{this.syncStatus.isSyncing=!1,this.notifyListeners()}return e}async uploadLocalChanges(){const e=[];let t=0;try{const a=await this.indexedDbService.getPendingUploads();for(const s of a)try{switch(s.type){case"banking_file":await Yt.uploadBankingFile(s.data.fileName,s.data.transactions,s.data.operationDate);break;case"manual_entry":await Yt.addManualEntry(s.data);break;case"conference":await Yt.transferToConference(s.data.transactionId);break;case"not_found":await Yt.registerNotFound(s.data.searchedValue,s.data.normalizedValue)}await this.indexedDbService.markAsUploaded(s.id),t++}catch(r){e.push(`Failed to upload ${s.type}: ${r}`)}}catch(r){e.push(`Upload error: ${r}`)}return{count:t,errors:e}}async downloadRemoteChanges(){const e=[];let t=0;try{const e=this.syncStatus.lastSync||new Date(0),r=await Yt.getActiveConferences();for(const n of r){new Date(n.created_at)>e&&(await this.indexedDbService.saveRemoteConference(n),t++)}const a=await Yt.getManualEntries();for(const n of a){new Date(n.created_at)>e&&(await this.indexedDbService.saveRemoteEntry(n),t++)}const s=await Yt.getNotFoundHistory();for(const n of s){new Date(n.created_at)>e&&(await this.indexedDbService.saveRemoteNotFound(n),t++)}}catch(r){e.push(`Download error: ${r}`)}return{count:t,errors:e}}async countPendingChanges(){try{return(await this.indexedDbService.getPendingUploads()).length}catch(e){return 0}}async queueOperation(e,t){if(this.syncStatus.isOnline)try{switch(e){case"manual_entry":await Yt.addManualEntry(t);break;case"conference":await Yt.transferToConference(t.transactionId);break;case"not_found":await Yt.registerNotFound(t.searchedValue,t.normalizedValue)}}catch(r){await this.indexedDbService.queueForUpload(e,t),this.syncStatus.pendingChanges++,this.notifyListeners()}else await this.indexedDbService.queueForUpload(e,t),this.syncStatus.pendingChanges++,this.notifyListeners()}getSyncStatus(){return{...this.syncStatus}}onSyncStatusChange(e){return this.syncListeners.add(e),()=>this.syncListeners.delete(e)}notifyListeners(){const e=this.getSyncStatus();this.syncListeners.forEach(t=>t(e))}async resolveConflicts(e="merge"){}async forceSyncNow(){return this.syncData()}async clearLocalCache(){await this.indexedDbService.clearAll(),this.syncStatus.pendingChanges=0,this.syncStatus.lastSync=null,localStorage.removeItem("lastSyncTime"),this.notifyListeners()}destroy(){this.stopPeriodicSync(),this.syncListeners.clear()}};const ir=new class{constructor(){this.mode="indexeddb",this.initializeMode()}initializeMode(){Kt.isAuthenticated()?this.mode="supabase":this.mode="indexeddb"}setMode(e){this.mode=e}getMode(){return this.mode}async saveBankingUpload(e,t,r,a){"supabase"===this.mode?await Yt.uploadBankingFile(t,e,new Date(r)):"hybrid"===this.mode?(await At.saveBankingUpload(e,t,r,a),await or.queueOperation("banking_file",{fileName:t,transactions:e,operationDate:new Date(r)})):await At.saveBankingUpload(e,t,r,a)}async saveCashConference(e,t,r){"supabase"===this.mode?"conferred"===r&&e.id?await Yt.transferToConference(e.id):"not_found"===r&&await Yt.registerNotFound(e.value?.toString()||"0",e.value||0):"hybrid"===this.mode?(await At.saveCashConference(e,t,r),"conferred"===r&&e.id?await or.queueOperation("conference",{transactionId:e.id}):"not_found"===r&&await or.queueOperation("not_found",{searchedValue:e.value?.toString()||"0",normalizedValue:e.value||0})):await At.saveCashConference(e,t,r)}async saveNotFound(e,t){const r=parseFloat(e.replace(",",".").replace(/[^\d.-]/g,""));"supabase"===this.mode?await Yt.registerNotFound(e,r):"hybrid"===this.mode?(await At.saveNotFound(e,t),await or.queueOperation("not_found",{searchedValue:e,normalizedValue:r})):await At.saveNotFound(e,t)}async saveManualEntry(e,t){"supabase"===this.mode?await Yt.addManualEntry({documentNumber:e.document_number,description:e.description||"",value:e.value,entryType:e.entry_type,category:e.category,isLink:e.isLink}):"hybrid"===this.mode?(await At.saveManualEntry(e,t),await or.queueOperation("manual_entry",{documentNumber:e.document_number,description:e.description,value:e.value,entryType:e.entry_type,category:e.category,isLink:e.isLink})):await At.saveManualEntry(e,t)}async getHistoryByDate(e){if("supabase"===this.mode){const t=new Date(e),r=await Yt.getTransactionsByDateRange(t,t),a=await Yt.getActiveConferences(),s=await Yt.getManualEntries(t);return[...r.map(e=>({...e,operation_type:"banking_upload"})),...a.map(e=>({...e,operation_type:"cash_conference"})),...s.map(e=>({...e,operation_type:"manual_entry"}))]}return await At.getHistoryByDate(e)}async getDailySummary(e){if("supabase"===this.mode){const t=await Yt.getUserStatistics();return t?{operation_date:e,banking_total_uploaded:Number(t.total_transactions),banking_conferred_count:Number(t.total_conferred),total_value:Number(t.total_value),total_conferred:Number(t.total_conferred)}:null}return await At.getDailySummary(e)}async searchByValue(e,t=.01){return"supabase"===this.mode?await Yt.searchTransactionsByValue(e,t):await At.searchByValue(e)}async restartWorkDay(e){"supabase"===this.mode?await Yt.restartWorkDay():"hybrid"===this.mode?(await At.clearDayHistory(e),await Yt.restartWorkDay()):await At.clearDayHistory(e)}async syncNow(){return"hybrid"===this.mode||"supabase"===this.mode?await or.forceSyncNow():{success:!0,uploaded:0,downloaded:0,errors:[]}}getSyncStatus(){return"hybrid"===this.mode||"supabase"===this.mode?or.getSyncStatus():{lastSync:null,pendingChanges:0,isOnline:!0,isSyncing:!1}}onSyncStatusChange(e){return"hybrid"===this.mode||"supabase"===this.mode?or.onSyncStatusChange(e):()=>{}}async undoManualEntry(e){"supabase"===this.mode?await Yt.deleteManualEntry(e):await At.undoManualEntry(e)}async getStats(){if("supabase"===this.mode){const e=await Yt.getUserStatistics();return e?{bank_uploads:0,bank_entries:Number(e.total_transactions),cash_conference_entries:Number(e.total_conferred),not_found_history:Number(e.total_not_found),manual_entries:0,day_selection:0,total_storage_mb:0}:{bank_uploads:0,bank_entries:0,cash_conference_entries:0,not_found_history:0,manual_entries:0,day_selection:0,total_storage_mb:0}}return await At.getStats()}async searchConferenceValue(e,t){if("supabase"===this.mode){const t=parseFloat(e.replace(",",".").replace(/[^\d.-]/g,""));if(isNaN(t))throw new Error("Valor inválido para busca");return await Yt.searchTransactionsByValue(t)}return await At.searchByValue(parseFloat(e.replace(",",".")))}async exportConferences(e,t){if("supabase"===this.mode)return await Yt.exportConferences(e,t);return(await At.getHistoryByDate((new Date).toISOString().split("T")[0])).filter(e=>"cash_conference"===e.operation_type)}},cr="dashboard_launches",lr=()=>{try{const e=localStorage.getItem(cr);if(e){return JSON.parse(e).map(e=>{let t=new Date,r=new Date;try{if(e.date){const r=new Date(e.date);isNaN(r.getTime())||(t=r)}}catch{}try{if(e.timestamp){const t=new Date(e.timestamp);isNaN(t.getTime())||(r=t)}}catch{}return{...e,date:t,timestamp:r}})}}catch(e){}return[]},dr=e=>{try{localStorage.setItem(cr,JSON.stringify(e))}catch(t){}},ur=({currentDate:t,operationDate:r,onLaunchAdded:a,conferredItems:s})=>{const[n,o]=We(),[i,c]=e.useState(null),[l,d]=e.useState(null),[u,m]=e.useState(""),[h,p]=e.useState(lr),[g,x]=e.useState(null),[f,y]=e.useState(null),[b,v]=e.useState("date"),[_,w]=e.useState("desc"),[j,N]=e.useState(null),[S,k]=e.useState("all"),[C,D]=e.useState(!1),[I,E]=e.useState(null),T=e.useRef(null);ct();const M=e.useCallback(()=>{if(n.selectedDate){const[e,t,r]=n.selectedDate.split("-");return new Date(parseInt(e),parseInt(t)-1,parseInt(r))}if(r){const[e,t,a]=r.split("/");return new Date(parseInt(a),parseInt(t)-1,parseInt(e))}return t},[n.selectedDate,r,t]),B=e.useMemo(()=>[{id:"credit_1x",label:"Cartão de Crédito 1x",group:"credit"},{id:"credit_2x",label:"Cartão de Crédito 2x",group:"credit"},{id:"credit_3x",label:"Cartão de Crédito 3x",group:"credit"},{id:"credit_4x",label:"Cartão de Crédito 4x",group:"credit"},{id:"credit_5x",label:"Cartão de Crédito 5x",group:"credit"},{id:"debit",label:"Débito",group:"other"},{id:"cash",label:"Dinheiro",group:"other"},{id:"coins",label:"Moedas",group:"other"},{id:"deposit",label:"Depósito",group:"other"}],[]),O=e=>{const t=e.replace(/[^\d,]/g,"").replace(",","."),r=parseFloat(t);return isNaN(r)?"":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r)},$=e.useCallback(()=>{if(x(null),y(null),!i)return void x("Selecione um método de pagamento");if(i.startsWith("credit")&&null===l)return void x("Informe se é link (Sim/Não)");const e=Ft(Lt.conferenceValue,{value:u});if(!e.success)return void x(e.error);const t=e.data.value,r=B.find(e=>e.id===i)?.label||"",n=i.startsWith("credit")&&null!==l?" / Link: "+(l?"Sim":"Não"):"",o=M(),c={id:`launch-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,date:o,paymentType:`${r}${n}`,isLink:i.startsWith("credit")?l||!1:void 0,value:t,timestamp:new Date};"credit_1x"===i&&(c.credit1x=t),"credit_2x"===i&&(c.credit2x=t),"credit_3x"===i&&(c.credit3x=t),"credit_4x"===i&&(c.credit4x=t),"credit_5x"===i&&(c.credit5x=t);const d=[c,...h];p(d),dr(d);const g={id:c.id,date:Ye(c.date),description:c.paymentType,value:c.value,originalHistory:"Manual",source:"manual",cpf:"",conferredAt:new Date,conferredId:c.id};s.some(e=>e.conferredId===c.id)?y("Lançamento adicionado com sucesso"):(a(g),y("Lançamento criado e enviado para Conferência de Caixa")),m(""),T.current&&T.current.focus(),setTimeout(()=>y(null),3e3)},[i,l,u,M,h,s,a]),F=e.useCallback(()=>{k("all"),o(e=>({...e,selectedDate:""})),N("Todos os filtros foram removidos"),setTimeout(()=>N(null),3e3),T.current&&T.current.focus()},[o]),L=e.useCallback(e=>{if(k(e),"all"===e)N("Exibindo todos os tipos de pagamento");else{const t=B.find(t=>t.id===e);N(`Filtrado por: ${t?.label||e}`)}setTimeout(()=>N(null),3e3),T.current&&T.current.focus()},[B]),R=e=>{c(e),x(null),e.startsWith("credit")||d(null)},A=e=>{b===e?w(e=>"asc"===e?"desc":"asc"):(v(e),w("asc"))},V=()=>{D(!1),E(null)},z=[...h].sort((e,t)=>{const r="asc"===_?1:-1;return"date"===b?(e.timestamp.getTime()-t.timestamp.getTime())*r:(e.value-t.value)*r}),U=M(),P=z.filter(e=>{const t=e.date.toDateString()===U.toDateString();let r=!0;if("all"!==S){const t=e.paymentType.toLowerCase().replace(/\s+/g,"_"),a=S.toString();if(a.startsWith("credit_")){r=t.includes("crédito")||t.includes("credito");const e=a.match(/credit_(\d+)x/);if(e){const a=e[1];r=r&&t.includes(`${a}x`)}}else"debit"===a?r=t.includes("débito")||t.includes("debito"):"cash"===a?r=t.includes("dinheiro"):"coins"===a?r=t.includes("moedas"):"deposit"===a&&(r=t.includes("depósito")||t.includes("deposito"))}return t&&r}),q={general:P.reduce((e,t)=>e+t.value,0),credit1x:P.reduce((e,t)=>e+(t.credit1x||0),0),credit2x:P.reduce((e,t)=>e+(t.credit2x||0),0),credit3x:P.reduce((e,t)=>e+(t.credit3x||0),0),credit4x:P.reduce((e,t)=>e+(t.credit4x||0),0),credit5x:P.reduce((e,t)=>e+(t.credit5x||0),0)};return it([{key:"l",ctrlKey:!0,action:()=>{T.current&&(T.current.focus(),T.current.select())},description:"Focar no campo de valor (Ctrl+L)"},{key:"Escape",action:()=>{C&&V()},description:"Fechar modal de desfazer (Esc)"}],!0),e.useEffect(()=>{const e=e=>{"Enter"===e.key&&T.current===document.activeElement&&$()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[$]),X.jsxs(X.Fragment,{children:[X.jsx("aside",{className:"w-80 bg-gray-900 border-r border-gray-800 sticky top-32 self-start",children:X.jsxs("div",{className:"p-4 space-y-4",children:[X.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[X.jsx("h3",{className:"text-sm font-semibold text-gray-100 mb-3",children:"Selecionar Pagamento"}),X.jsxs("div",{className:"space-y-2 mb-3",children:[X.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider",children:"Cartão de Crédito"}),B.filter(e=>"credit"===e.group).map(e=>X.jsx("button",{onClick:()=>R(e.id),className:"w-full text-left px-3 py-2 text-sm rounded-md transition-colors "+(i===e.id?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-gray-100"),"aria-label":e.label,children:e.label},e.id)),i?.startsWith("credit")&&X.jsxs("div",{className:"pl-3 space-y-2 mt-2",children:[X.jsx("p",{className:"text-xs text-gray-400",children:"É link?"}),X.jsxs("div",{className:"flex space-x-2",children:[X.jsx("button",{onClick:()=>d(!0),className:"flex-1 px-3 py-1 text-xs rounded-md transition-colors "+(!0===l?"bg-green-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"Sim"}),X.jsx("button",{onClick:()=>d(!1),className:"flex-1 px-3 py-1 text-xs rounded-md transition-colors "+(!1===l?"bg-red-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"Não"})]})]})]}),X.jsxs("div",{className:"space-y-2",children:[X.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider",children:"Outros Métodos"}),B.filter(e=>"other"===e.group).map(e=>X.jsx("button",{onClick:()=>R(e.id),className:"w-full text-left px-3 py-2 text-sm rounded-md transition-colors "+(i===e.id?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-gray-100"),"aria-label":e.label,children:e.label},e.id))]})]}),X.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[X.jsx("h3",{className:"text-sm font-semibold text-gray-100 mb-3",children:"Preencher Valor"}),X.jsxs("div",{className:"space-y-2",children:[X.jsx("input",{id:"launch-value-input",ref:T,type:"text",placeholder:"Digite o valor (ex: 123,45)",value:u,onChange:e=>{const t=e.target.value;if(m(t),t.trim()){const e=Ft(Lt.conferenceValue,{value:t});e.success?x(null):x(e.error)}else x(null)},...er("launch-value-input",g),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border rounded-md focus:ring-2 "+(g?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-600 focus:ring-indigo-500 focus:border-indigo-500"),"aria-label":"Valor do lançamento"}),X.jsx(Qt,{error:g,fieldId:"launch-value-input"}),X.jsx("button",{onClick:$,disabled:!i||!u,className:"w-full px-3 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Adicionar"})]}),f&&X.jsx("div",{className:"mt-2 p-2 bg-green-900/20 border border-green-400 rounded-md",children:X.jsx("p",{className:"text-xs text-green-400",children:f})})]}),X.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[X.jsx("h3",{className:"text-sm font-semibold text-gray-100 mb-3",children:"Filtrar por Data"}),X.jsxs("div",{className:"space-y-2",children:[X.jsx("div",{className:"bg-gray-900 rounded p-2 border border-gray-600",children:X.jsxs("div",{className:"flex items-center justify-between",children:[X.jsx("span",{className:"text-xs text-gray-400",children:"Data atual:"}),X.jsx("span",{className:"text-sm text-indigo-400 font-medium",children:Ye(U)})]})}),X.jsx("input",{type:"date",value:n.selectedDate,onChange:e=>o(t=>({...t,selectedDate:e.target.value})),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500","aria-label":"Selecionar data para filtro"}),X.jsxs("div",{className:"flex space-x-2",children:[X.jsx("button",{onClick:()=>{N("Filtro aplicado"),setTimeout(()=>N(null),2e3),T.current&&T.current.focus()},className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors",children:"Aplicar"}),X.jsx("button",{onClick:()=>{const e=(new Date).toISOString().split("T")[0];o(t=>({...t,selectedDate:e})),N("Data de hoje selecionada"),setTimeout(()=>N(null),2e3),T.current&&T.current.focus()},className:"flex-1 px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Hoje"}),X.jsx("button",{onClick:()=>{o(e=>({...e,selectedDate:""})),N("Filtro limpo"),setTimeout(()=>N(null),2e3),T.current&&T.current.focus()},className:"flex-1 px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Limpar"})]}),j&&X.jsx("div",{className:"p-2 bg-indigo-900/20 border border-indigo-400 rounded-md",children:X.jsx("p",{className:"text-xs text-indigo-400",children:j})}),0===P.length&&h.length>0&&X.jsx("div",{className:"p-2 bg-yellow-900/20 border border-yellow-400 rounded-md",children:X.jsxs("p",{className:"text-xs text-yellow-400",children:["Nenhum lançamento encontrado para ",Ye(U)]})})]})]})]})}),X.jsx("main",{className:"flex-1 bg-gray-950 p-6 min-h-[calc(100vh-8rem)] min-w-0",children:X.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 h-full flex flex-col",children:[X.jsx("div",{className:"p-4 border-b border-gray-700",children:X.jsxs("div",{className:"flex justify-between items-center",children:[X.jsxs("div",{children:[X.jsx("h2",{className:"text-lg font-semibold text-gray-100",children:"Lançamentos Manuais"}),X.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[P.length," lançamento(s) para ",Ye(U)]})]}),X.jsx(Ht,{data:{manual:P.map(e=>({day:r,document_number:"",description:`${e.paymentType} - Lançamento manual`,value:e.value,entry_type:e.value>=0?"income":"expense",category:e.paymentType,status:"active",source_id:`manual_${e.id}`}))},prefix:"lancamentos",date:r,disabled:0===P.length})]})}),X.jsx("div",{className:"bg-gray-800 border-b border-gray-700 p-4",children:X.jsxs("div",{className:"flex flex-wrap gap-4",children:[X.jsxs("div",{className:"flex-1 min-w-[200px]",children:[X.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Filtrar por Tipo de Pagamento"}),X.jsxs("select",{value:S,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[X.jsx("option",{value:"all",children:"Todos"}),X.jsx("option",{value:"credit_1x",children:"Crédito 1x"}),X.jsx("option",{value:"credit_2x",children:"Crédito 2x"}),X.jsx("option",{value:"credit_3x",children:"Crédito 3x"}),X.jsx("option",{value:"credit_4x",children:"Crédito 4x"}),X.jsx("option",{value:"credit_5x",children:"Crédito 5x"}),X.jsx("option",{value:"debit",children:"Débito"}),X.jsx("option",{value:"cash",children:"Dinheiro"}),X.jsx("option",{value:"coins",children:"Moedas"}),X.jsx("option",{value:"deposit",children:"Depósito"})]})]}),X.jsx("div",{className:"flex items-end",children:X.jsx("button",{onClick:F,className:"px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Limpar Filtros"})})]})}),X.jsx("div",{className:"flex-1 overflow-auto",children:X.jsxs("table",{className:"w-full text-sm text-left text-gray-300",children:[X.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-gray-900 sticky top-0",children:X.jsxs("tr",{children:[X.jsx("th",{scope:"col",className:"px-6 py-3 cursor-pointer hover:bg-gray-800",onClick:()=>A("date"),children:X.jsxs("div",{className:"flex items-center",children:["Data",X.jsx("svg",{className:"w-3 h-3 ml-1",fill:"currentColor",viewBox:"0 0 20 20",children:X.jsx("path",{d:"M5 12a1 1 0 102 0V6.414l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L5 6.414V12zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z"})})]})}),X.jsx("th",{scope:"col",className:"px-6 py-3",children:"Tipo de Pagamento"}),X.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Crédito 1x"}),X.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Crédito 2x"}),X.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Crédito 3x"}),X.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Crédito 4x"}),X.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Crédito 5x"}),X.jsx("th",{scope:"col",className:"px-6 py-3 text-right cursor-pointer hover:bg-gray-800",onClick:()=>A("value"),children:X.jsxs("div",{className:"flex items-center justify-end",children:["Valor (R$)",X.jsx("svg",{className:"w-3 h-3 ml-1",fill:"currentColor",viewBox:"0 0 20 20",children:X.jsx("path",{d:"M5 12a1 1 0 102 0V6.414l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L5 6.414V12zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z"})})]})}),X.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Ações"})]})}),X.jsx("tbody",{children:0===P.length?X.jsx("tr",{children:X.jsx("td",{colSpan:9,className:"px-6 py-8 text-center text-gray-500",children:"Nenhum lançamento registrado para esta data"})}):P.map(e=>X.jsxs("tr",{className:"bg-gray-800 border-b border-gray-700 hover:bg-gray-750",children:[X.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:Ye(e.date)}),X.jsx("td",{className:"px-6 py-4",children:X.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-700 text-gray-300",children:e.paymentType})}),X.jsx("td",{className:"px-6 py-4 text-right font-mono",children:e.credit1x?O(e.credit1x.toString()):"-"}),X.jsx("td",{className:"px-6 py-4 text-right font-mono",children:e.credit2x?O(e.credit2x.toString()):"-"}),X.jsx("td",{className:"px-6 py-4 text-right font-mono",children:e.credit3x?O(e.credit3x.toString()):"-"}),X.jsx("td",{className:"px-6 py-4 text-right font-mono",children:e.credit4x?O(e.credit4x.toString()):"-"}),X.jsx("td",{className:"px-6 py-4 text-right font-mono",children:e.credit5x?O(e.credit5x.toString()):"-"}),X.jsx("td",{className:"px-6 py-4 text-right font-mono text-green-400",children:O(e.value.toString())}),X.jsx("td",{className:"px-6 py-4 text-center",children:X.jsx("button",{onClick:()=>(e=>{E(e),D(!0)})(e),className:"px-2 py-1 text-xs font-medium text-red-300 bg-red-900/20 border border-red-600 rounded hover:bg-red-900/30 transition-colors","aria-label":"Desfazer lançamento",children:"Desfazer"})})]},e.id))}),P.length>0&&X.jsx("tfoot",{className:"text-xs text-gray-300 bg-gray-900 border-t-2 border-indigo-500",children:X.jsxs("tr",{children:[X.jsx("td",{colSpan:2,className:"px-6 py-3 font-semibold",children:"Total Geral"}),X.jsx("td",{className:"px-6 py-3 text-right font-mono font-semibold",children:q.credit1x>0?O(q.credit1x.toString()):"-"}),X.jsx("td",{className:"px-6 py-3 text-right font-mono font-semibold",children:q.credit2x>0?O(q.credit2x.toString()):"-"}),X.jsx("td",{className:"px-6 py-3 text-right font-mono font-semibold",children:q.credit3x>0?O(q.credit3x.toString()):"-"}),X.jsx("td",{className:"px-6 py-3 text-right font-mono font-semibold",children:q.credit4x>0?O(q.credit4x.toString()):"-"}),X.jsx("td",{className:"px-6 py-3 text-right font-mono font-semibold",children:q.credit5x>0?O(q.credit5x.toString()):"-"}),X.jsx("td",{className:"px-6 py-3 text-right font-mono font-semibold text-green-400",children:O(q.general.toString())}),X.jsx("td",{className:"px-6 py-3"})]})})]})})]})}),C&&X.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:X.jsx("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 p-6 max-w-md w-full mx-4",children:X.jsxs("div",{className:"flex items-start",children:[X.jsx("div",{className:"flex-shrink-0",children:X.jsx("svg",{className:"h-6 w-6 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),X.jsxs("div",{className:"ml-3 flex-1",children:[X.jsx("h3",{className:"text-lg font-medium text-gray-100 mb-2",children:"Confirmar Desfazer"}),X.jsx("p",{className:"text-sm text-gray-300 mb-6",children:"Tem certeza que deseja desfazer este lançamento? Ele será removido de todas as abas."}),I&&X.jsx("div",{className:"bg-gray-900 rounded p-3 mb-4 border border-gray-700",children:X.jsxs("div",{className:"text-xs text-gray-400",children:[X.jsxs("p",{children:["Tipo: ",I.paymentType]}),X.jsxs("p",{children:["Valor: ",O(I.value.toString())]}),X.jsxs("p",{children:["Data: ",Ye(I.date)]})]})}),X.jsxs("div",{className:"flex space-x-3",children:[X.jsx("button",{onClick:()=>{if(!I)return;const e=h.filter(e=>e.id!==I.id);p(e),dr(e),a&&a({id:I.id,conferredId:I.id,remove:!0}),y("Lançamento desfeito com sucesso"),D(!1),E(null),T.current&&T.current.focus(),setTimeout(()=>y(null),3e3)},className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-red-500 transition-colors",children:"Confirmar"}),X.jsx("button",{onClick:V,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-gray-500 transition-colors",children:"Cancelar"})]})]})]})})})]})};const mr=()=>{const[t,r]=e.useState(null),[a,s]=e.useState(!1);return e.useEffect(()=>{(async()=>{try{const e=await zt.getStorageStats();r(e)}catch(e){}})()},[]),t?X.jsxs("div",{className:"fixed bottom-4 left-4 z-50",children:[X.jsx("button",{onClick:()=>s(!a),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors "+("IndexedDB"===t.type?"bg-green-600 text-white hover:bg-green-700":"bg-blue-600 text-white hover:bg-blue-700"),children:t.type}),a&&t.stats&&X.jsxs("div",{className:"absolute bottom-8 left-0 bg-gray-800 text-white rounded-lg p-3 shadow-lg min-w-[200px]",children:[X.jsx("h4",{className:"font-semibold mb-2",children:"Storage Stats"}),X.jsxs("div",{className:"text-xs space-y-1",children:[X.jsxs("div",{children:["Bank Uploads: ",t.stats.bank_uploads]}),X.jsxs("div",{children:["Bank Entries: ",t.stats.bank_entries]}),X.jsxs("div",{children:["Cash Conferences: ",t.stats.cash_conference_entries]}),X.jsxs("div",{children:["Not Found: ",t.stats.not_found_history]}),X.jsxs("div",{children:["Manual Entries: ",t.stats.manual_entries]}),X.jsxs("div",{children:["Day Selections: ",t.stats.day_selection]}),void 0!==t.stats.total_storage_mb&&X.jsxs("div",{className:"pt-1 border-t border-gray-600",children:["Storage: ~",t.stats.total_storage_mb," MB"]})]})]})]}):null},hr={parsing:{icon:l,message:"Lendo planilha...",color:"text-blue-400"},normalizing:{icon:d,message:"Normalizando dados...",color:"text-yellow-400"},indexing:{icon:d,message:"Criando índices...",color:"text-green-400"},saving:{icon:u,message:"Salvando...",color:"text-indigo-400"}};function pr({message:e,progress:t,stage:r="parsing",show:a,showStallWarning:s=!1,canCancel:n=!1,onCancel:o}){if(!a)return null;const i=hr[r],c=i.icon,l=e||i.message;return X.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:X.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-8 max-w-md w-full mx-4 shadow-2xl",children:[X.jsx("div",{className:"text-center mb-6",children:X.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[X.jsx("div",{className:"absolute inset-0 animate-spin",children:X.jsx("div",{className:"h-12 w-12 border-2 border-gray-600 border-t-transparent rounded-full"})}),X.jsx(c,{className:`h-6 w-6 ${i.color} animate-pulse`})]})}),X.jsxs("div",{className:"text-center mb-4",children:[X.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-2",children:"Processando..."}),X.jsx("p",{className:"text-gray-400 text-sm",children:l})]}),"number"==typeof t&&X.jsxs("div",{className:"mb-4",children:[X.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mb-1",children:[X.jsx("span",{children:"Progresso"}),X.jsxs("span",{children:[Math.round(t),"%"]})]}),X.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:X.jsx("div",{className:"bg-indigo-500 h-2 rounded-full transition-all duration-300 ease-out",style:{width:`${Math.min(100,Math.max(0,t))}%`}})})]}),X.jsx("div",{className:"flex justify-center space-x-2",children:Object.entries(hr).map(([e],t)=>X.jsx("div",{className:"h-2 w-2 rounded-full transition-all duration-300 "+(e===r?"bg-indigo-500 scale-125":t<Object.keys(hr).indexOf(r)?"bg-gray-500":"bg-gray-700")},e))}),s&&X.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-700 rounded-md",children:X.jsxs("div",{className:"flex items-center",children:[X.jsx("div",{className:"flex-shrink-0",children:X.jsx("svg",{className:"h-5 w-5 text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),X.jsxs("div",{className:"ml-3 flex-1",children:[X.jsx("p",{className:"text-sm text-yellow-400",children:"Processamento mais lento que o esperado..."}),X.jsx("p",{className:"text-xs text-yellow-300 mt-1",children:"Isso pode acontecer com arquivos grandes ou complexos"})]})]})}),n&&o&&X.jsx("div",{className:"mt-4",children:X.jsx("button",{onClick:o,className:"w-full px-4 py-2 text-sm font-medium text-red-300 bg-red-900/20 border border-red-600 rounded-md hover:bg-red-900/30 transition-colors",children:"Cancelar Processamento"})}),X.jsx("div",{className:"mt-6 p-3 bg-gray-900 rounded-md",children:X.jsx("p",{className:"text-xs text-gray-400 text-center",children:"💡 Processamento em background para manter a UI responsiva"})})]})})}const gr=new class{valueToCents(e){return Math.round(100*e)}parseDate(e){if(!e)return"";try{if(e instanceof Date)return Je(e);if("number"==typeof e){const t=$.parse_date_code(e);return Je(new Date(t.y,t.m-1,t.d))}if("string"==typeof e){const t=e.trim();if(t.includes("/")){const e=t.split("/");if(3===e.length){const[t,r,a]=e,s=parseInt(t),n=parseInt(r),o=parseInt(a);if(s>=1&&s<=31&&n>=1&&n<=12&&o>=1900){return Je(new Date(o,n-1,s))}}}const r=new Date(e);if(!isNaN(r.getTime()))return Je(r)}return""}catch(t){return""}}parseValue(e){if("number"==typeof e)return e;if(!e)return 0;const t=e.toString().replace(/[^\d,.-]/g,"").replace(",","."),r=parseFloat(t);return isNaN(r)?0:r}extractCPF(e){if(!e)return"";const t=e.match(/(\d{3}\.?\d{3}\.?\d{3}-?\d{2})/);return t?t[1].replace(/[^\d]/g,""):""}detectPaymentType(e){if(!e)return"OUTROS";const t=e.toUpperCase(),r={"PIX RECEBIDO":/pix\s*recebid/i,"PIX ENVIADO":/pix\s*enviad/i,TED:/\bted\b/i,DOC:/\bdoc\b/i,"CARTÃO":/cart[aã]o/i,DINHEIRO:/dinheiro/i,BOLETO:/boleto/i,"TRANSFERÊNCIA":/transfer[eê]ncia/i,"DEPÓSITO":/dep[oó]sito/i,SAQUE:/saque/i};for(const[a,s]of Object.entries(r))if(s.test(t))return a;return"OUTROS"}detectColumns(e){const t={date:["data","date","data do lançamento","data do lancamento","dt","data mov","data movimento"],history:["histórico","historico","histórico original","historico original","histã³rico original","histã³rico","descrição","descricao","histórico/descrição","historico/descricao","descrição/histórico","descricao/historico","desc"],value:["valor","valor (r$)","valor r$","vlr","val"],credit:["crédito","credito","entrada","receita"],debit:["débito","debito","saída","saida","despesa"]},r={dateCol:-1,historyCol:-1,valueCol:-1,creditCol:-1,debitCol:-1};return e.forEach((e,a)=>{if(!e)return;const s=e.toString().toLowerCase().trim();-1===r.dateCol&&t.date.some(e=>s.includes(e))&&(r.dateCol=a),-1===r.historyCol&&t.history.some(e=>s.includes(e))&&(r.historyCol=a),-1===r.valueCol&&t.value.some(e=>s.includes(e))&&(r.valueCol=a),-1===r.creditCol&&t.credit.some(e=>s.includes(e))&&(r.creditCol=a),-1===r.debitCol&&t.debit.some(e=>s.includes(e))&&(r.debitCol=a)}),r}async processExcelFile(e,t,r){try{r?.(10);const s=M(e,{type:"array",cellDates:!0,raw:!1});if(r?.(30),0===s.SheetNames.length)throw new Error("Nenhuma planilha encontrada");const n=s.SheetNames[0],o=s.Sheets[n];if(!o)throw new Error("Planilha não encontrada ou vazia");r?.(50);const i=B.sheet_to_json(o,{header:1});if(i.length<2)throw new Error("Planilha deve conter pelo menos uma linha de dados além do cabeçalho");r?.(70);let c={dateCol:-1,historyCol:-1,valueCol:-1,creditCol:-1,debitCol:-1},l=-1;for(let e=0;e<Math.min(5,i.length);e++){const t=i[e],r=this.detectColumns(t);if(-1!==r.dateCol&&-1!==r.historyCol){c=r,l=e;break}}if(-1===c.dateCol||-1===c.historyCol)throw new Error("Não foi possível detectar as colunas obrigatórias (Data e Histórico)");const d=[],u=[],m=[];let h=0,p=0;for(let e=l+1;e<i.length;e++){const t=i[e];if(t&&0!==t.length)try{const r=this.parseDate(t[c.dateCol]),a=t[c.historyCol]?.toString()||"";let s=0;if(-1!==c.valueCol)s=this.parseValue(t[c.valueCol]);else if(-1!==c.creditCol||-1!==c.debitCol){const e=-1!==c.creditCol?this.parseValue(t[c.creditCol]):0,r=-1!==c.debitCol?this.parseValue(t[c.debitCol]):0;s=e||-Math.abs(r)}const n={date:r,paymentType:this.detectPaymentType(a),cpf:this.extractCPF(a),value:s,originalHistory:a,validationStatus:"valid"};r?0===s?(n.validationStatus="warning",n.validationMessage="Valor zero",m.push(`Linha ${e+1}: Valor zero`)):(p++,h+=Math.abs(s)):(n.validationStatus="warning",n.validationMessage="Data inválida",m.push(`Linha ${e+1}: Data inválida`)),d.push(n)}catch(a){const t=`Linha ${e+1}: ${a instanceof Error?a.message:"Erro desconhecido"}`;u.push(t)}}r?.(90);const g={success:0===u.length,data:d,errors:u,warnings:m,stats:{totalRows:d.length,validRows:p,rowsWithWarnings:m.length,rowsWithErrors:u.length,totalValue:h}},x=d.map((e,r)=>({id:r,source_id:_t(e.date,e.cpf||"",e.value,e.originalHistory),document_number:e.cpf||void 0,date:e.date,description:e.originalHistory,value:e.value,value_cents:this.valueToCents(e.value),transaction_type:e.paymentType,status:"pending",day:t})),f=new Map;return x.forEach(e=>{f.has(e.value_cents)||f.set(e.value_cents,[]),f.get(e.value_cents).push(e.id)}),r?.(100),{parseResult:g,valueCentsMap:f,normalizedEntries:x}}catch(s){throw s}}};const xr=()=>{const{user:t,logout:a}=pe(),{processExcelFile:s,terminateWorker:o}=function(){const t=e.useRef(null),r=e.useRef(null),a=e.useCallback(async()=>{if(!t.current)try{const e=new Worker(new URL("/assets/excelProcessor.worker-DFNGWd18.js",import.meta.url),{type:"module"});e.onerror=e=>{},e.onmessageerror=e=>{},t.current=e,r.current=F(e)}catch(w){throw w}return r.current},[]);return{processExcelFile:e.useCallback(async(e,s,n,o={})=>{const{signal:i,timeout:c=12e4}=o;if(e.size<1e5){const t=await e.arrayBuffer();return await gr.processExcelFile(t,s,n)}if(i?.aborted)throw new DOMException("Operação cancelada pelo usuário","AbortError");let l,d=null;try{l=await a();const t=await e.arrayBuffer();if(i?.aborted)throw new DOMException("Operação cancelada pelo usuário","AbortError");n?.(10);const r=new Promise((e,t)=>{d=setTimeout(()=>{t(new DOMException(`Timeout de ${c}ms excedido`,"TimeoutError"))},c)}),o=new Promise((e,t)=>{i&&i.addEventListener("abort",()=>{t(new DOMException("Operação cancelada pelo usuário","AbortError"))})});n?.(30);const u=Date.now(),m=setInterval(()=>{const e=Date.now()-u,t=30+Math.min(50,e/1e3);n?.(t)},500);try{const e=[l.processExcelFile(t,s)];c>0&&e.push(r),i&&e.push(o);const a=await Promise.race(e);return clearInterval(m),n?.(90),n?.(100),a}catch(w){throw clearInterval(m),w}}catch(w){if(t.current&&(t.current.terminate(),t.current=null,r.current=null),w instanceof DOMException&&"TimeoutError"===w.name)try{const t=await e.arrayBuffer();return await gr.processExcelFile(t,s,n)}catch(u){throw new Error(`Erro no processamento (Worker e Fallback): ${u instanceof Error?u.message:"Erro desconhecido"}`)}if(w instanceof DOMException)throw w;throw new Error(`Erro no processamento: ${w instanceof Error?w.message:"Erro desconhecido"}`)}finally{d&&clearTimeout(d),n?.(100)}},[a]),processExistingEntries:e.useCallback(async e=>(await a()).processExistingEntries(e),[a]),terminateWorker:e.useCallback(()=>{if(r.current){try{r.current[L]()}catch(w){}r.current=null}if(t.current){try{t.current.terminate()}catch(w){}t.current=null}},[])}}(),i=function(){const[e,t]=r.useState(!1),[a,s]=r.useState("parsing"),[n,o]=r.useState(void 0),[i,c]=r.useState(void 0),[l,d]=r.useState(0),[u,m]=r.useState(!1),[h,p]=r.useState(!1);r.useEffect(()=>{if(!e)return void m(!1);const t=setInterval(()=>{Date.now()-l>1e4&&(m(!0),p(!0))},2e3);return()=>clearInterval(t)},[e,l]);const g=r.useCallback((e="parsing")=>{t(!0),s(e),o(void 0),c(void 0),d(Date.now()),m(!1),p(!1)},[]),x=r.useCallback((e,t)=>{s(e),c(t),d(Date.now()),m(!1)},[]),f=r.useCallback(e=>{o(e),d(Date.now()),m(!1)},[]),y=r.useCallback(()=>{t(!1),o(void 0),c(void 0),m(!1),p(!1)},[]);return{isProcessing:e,stage:a,progress:n,message:i,showStallWarning:u,canCancel:h,startProcessing:g,updateStage:x,updateProgress:f,stopProcessing:y}}(),c=e.useRef(null),l=function(){const[t,r]=e.useState({lookup:new Map,totalEntries:0,uniqueValues:0,lastUpdated:new Date}),a=e.useCallback(e=>Math.round(100*e),[]),s=e.useCallback(e=>{const t=new Map;let r=0;for(const s of e){if(!s.value||0===s.value)continue;const e=a(s.value),n={id:s.id,source:s.source,value:s.value,value_cents:e,status:s.status||"unknown",description:s.description,document_number:s.document_number,date:s.date,entry:s};t.has(e)||t.set(e,[]),t.get(e).push(n),r++}return{lookup:t,totalEntries:r,uniqueValues:t.size,lastUpdated:new Date}},[a]),n=e.useCallback(e=>{const t=s(e);return r(t),t},[s]),o=e.useCallback(e=>{const r=a(e);return t.lookup.get(r)||[]},[t.lookup,a]),i=e.useCallback(e=>{if(!e.value||0===e.value||!e.id)return;const t=a(e.value),s={id:e.id,source:e.source,value:e.value,value_cents:t,status:e.status||"unknown",description:e.description,document_number:e.document_number,date:e.date,entry:e};r(r=>{const a=new Map(r.lookup);a.has(t)||a.set(t,[]);const n=a.get(t),o=n.findIndex(t=>t.id===e.id);return-1===o?n.push(s):n[o]=s,{lookup:a,totalEntries:Array.from(a.values()).reduce((e,t)=>e+t.length,0),uniqueValues:a.size,lastUpdated:new Date}})},[a]),c=e.useCallback((e,t)=>{const s=a(t);r(t=>{const r=new Map(t.lookup),a=r.get(s);if(a){const t=a.filter(t=>t.id!==e);0===t.length?r.delete(s):r.set(s,t)}return{lookup:r,totalEntries:Array.from(r.values()).reduce((e,t)=>e+t.length,0),uniqueValues:r.size,lastUpdated:new Date}})},[a]),l=e.useCallback((e,t,s)=>{const n=a(t);r(t=>{const r=new Map(t.lookup),a=r.get(n);if(a){const t=a.findIndex(t=>t.id===e);if(-1!==t){const e=[...a];e[t]={...e[t],status:s},r.set(n,e)}}return{...t,lookup:r,lastUpdated:new Date}})},[a]),d=e.useCallback((e,t)=>{const r=o(e),a=Array.isArray(t)?t:[t];return r.filter(e=>a.includes(e.status))},[o]),u=e.useMemo(()=>{const e=new Map,r=new Map;for(const a of t.lookup.values())for(const t of a)e.set(t.status,(e.get(t.status)||0)+1),r.set(t.source,(r.get(t.source)||0)+1);return{totalEntries:t.totalEntries,uniqueValues:t.uniqueValues,statusCounts:Object.fromEntries(e),sourceCounts:Object.fromEntries(r),lastUpdated:t.lastUpdated}},[t]),m=e.useCallback(()=>{r({lookup:new Map,totalEntries:0,uniqueValues:0,lastUpdated:new Date})},[]);return{lookupMap:t,updateLookupMap:n,findByValue:o,findByValueAndStatus:d,addEntry:i,removeEntry:c,updateEntryStatus:l,clearLookupMap:m,valueToCents:a,stats:u}}(),[d,u]=We(),[m,h]=He("dashboard_active_tab","banking"),[p,g]=He("dashboard_show_history",!1),[x,f]=e.useState(null),[y,b]=e.useState(Ze()),[v,_]=e.useState("automatic"),[w,j]=e.useState(null),[N,S]=e.useState([]),[k,C]=e.useState(!1),{registerFocusTarget:D,focusTarget:I,getFocusTarget:E}=(()=>{const t=e.useRef({});return{registerFocusTarget:e.useCallback((e,r)=>{t.current[e]=r},[]),focusTarget:e.useCallback(e=>{const r=t.current[e];r&&(r.focus(),r.select?.())},[]),getFocusTarget:e.useCallback(e=>t.current[e],[])}})(),{saveFocus:T,restoreFocus:M}=ct(),B=e.useRef(null),O=e.useRef(null),[$,R]=He("dashboard_parse_result",null),[A,V]=e.useState(null),[z,U]=He("dashboard_conferred_items",[],{serialize:e=>JSON.stringify(e.map(e=>({...e,conferredAt:e.conferredAt.toISOString()}))),deserialize:e=>JSON.parse(e).map(e=>{let t=new Date;try{if(e.conferredAt){const r=new Date(e.conferredAt);isNaN(r.getTime())||(t=r)}}catch(r){}return{...e,conferredAt:t}})}),[P,q]=He("dashboard_transferred_ids",new Set,{serialize:e=>JSON.stringify(Array.from(e)),deserialize:e=>new Set(JSON.parse(e))}),[H,W]=He("dashboard_not_found_history",[],{serialize:e=>JSON.stringify(e.map(e=>({...e,timestamp:e.timestamp.toISOString()}))),deserialize:e=>JSON.parse(e).map(e=>{let t=new Date;try{if(e.timestamp){const r=new Date(e.timestamp);isNaN(r.getTime())||(t=r)}}catch(r){}return{...e,timestamp:t}})}),[J,K]=e.useState(!1),[Y,G]=e.useState([]),[Z,Q]=e.useState(!1),[ee,te]=e.useState(null),[re,ae]=e.useState(null),[se,ne]=e.useState(!1),[oe,ie]=e.useState(null),[ce,le]=e.useState([]),[de,ue]=e.useState(!1),me=e.useCallback(()=>{Q(!1),ne(!1),C(!1),M()},[M]),he=e.useCallback(async()=>{const e=Ft(Lt.conferenceValue,{value:d.conferenceValue});if(e.success){K(!0),te(null),G([]);try{const e=d.conferenceValue.trim(),t=await Rt.time("conference-search",async()=>{return await ir.searchConferenceValue(e,d.selectedDate||(t=new Date,Ke(t)));var t});if(0===t.length)return void te("Nenhum valor encontrado para conferência");if(G(t),1===t.length){const e={...t[0],conferredAt:new Date,conferredId:`conf-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};U(t=>[e,...t]),u(e=>({...e,conferenceValue:""})),G([]),ae("Valor conferido automaticamente!"),setTimeout(()=>ae(null),3e3)}else T(),Q(!0)}catch(t){te(t.message||"Erro interno na busca")}finally{K(!1)}}else te(e.error)},[d.conferenceValue,d.selectedDate,te,G,U,u,ae,T,Q,K]),ge=e.useCallback(()=>{if(Z&&Y.length>0){const e=Y[0];if(e){T(),Q(!1);const t={...e,conferredAt:new Date,conferredId:`conf-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};U(e=>[t,...e]),u(e=>({...e,conferenceValue:""})),G([]),ae("Valor conferido com sucesso!"),setTimeout(()=>ae(null),3e3),M()}}else d.conferenceValue&&!Z&&he()},[Z,Y,d.conferenceValue,T,M,U,u,he]),xe=e.useCallback(()=>{const e=E("dateFilter");e?e.focus():I("dateFilter")},[E,I]);e.useEffect(()=>{D("conferenceValue",B.current),D("dateFilter",O.current)},[D]),((e,t)=>{const r=[{key:"l",ctrlKey:!0,action:()=>{e.valueInput?(e.valueInput.focus(),e.valueInput.select()):e.conferenceValue&&(e.conferenceValue.focus(),e.conferenceValue.select())},description:"Focar no campo de valor (Ctrl+L)"},{key:"f",ctrlKey:!0,action:()=>{t.openDateFilter?t.openDateFilter():e.dateFilter&&e.dateFilter.focus()},description:"Abrir filtro de data (Ctrl+F)"},{key:"Escape",action:()=>{t.closeModals&&t.closeModals()},description:"Fechar modais (Esc)"},{key:"Enter",action:()=>{t.confirmAction&&t.confirmAction()},description:"Confirmar ação (Enter)"}];it(r,!0)})({valueInput:E("valueInput"),conferenceValue:E("conferenceValue"),dateFilter:E("dateFilter")},{openDateFilter:xe,closeModals:me,confirmAction:ge});const fe=function(t,r){const[a,s]=e.useState(t);return e.useEffect(()=>{const e=setTimeout(()=>{s(t)},r);return()=>{clearTimeout(e)}},[t,r]),a}(d.conferenceValue,300);e.useEffect(()=>{if(fe&&$?.data&&A){if(function(e){if(!e||""===e.trim())return{isValid:!1,error:"Digite um valor para conferir"};const t=at(e);return 0===t?{isValid:!1,error:"Informe um valor válido (ex.: 123,45)"}:t<0?{isValid:!1,error:"O valor deve ser positivo"}:{isValid:!0}}(fe).isValid){const e=Rt.measureSync("conference_search",()=>function(e,t,r){const a=at(e);if(0===a)return{hasMatches:!1,matches:[],normalizedInput:0};if(r){const e=r.get(a)||[];return{hasMatches:e.length>0,matches:e,normalizedInput:a}}const s=[];return t.forEach((e,t)=>{let r=st.get(e);void 0===r&&(r=at(e.value),st.set(e,r)),r===a&&s.push({id:`row-${t}-${e.date}-${e.value}`,date:e.date,paymentType:e.paymentType,cpf:e.cpf,value:e.value,originalHistory:e.originalHistory,rowIndex:t})}),{hasMatches:s.length>0,matches:s,normalizedInput:a}}(fe,$.data,A),{valueSearched:fe,dataSize:$.data.length});ie(e.matches.length)}else ie(null)}else ie(null)},[fe,$,A]),e.useEffect(()=>{if($&&$.data&&$.data.length>0&&!A){const e=nt($.data);V(e)}},[$]);const ye=e.useCallback(()=>{c.current&&c.current.abort(),o(),i.stopProcessing(),j(null),n.info("Processamento cancelado pelo usuário")},[o,i]),be=()=>{f(null),R(null),V(null),j(null),q(new Set),U([]),W([]);const e=document.getElementById("fileInput");e&&(e.value="")},ve=e.useCallback(async e=>{const t=`conf-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r={...e,conferredAt:new Date,conferredId:t};U(e=>[...e,r]),q(t=>new Set([...t,e.id])),l.updateEntryStatus(e.id,e.value,"conferred");try{await zt.saveCashConference(e,y,"conferred")}catch(a){}ke(""),ae("Valor encontrado e transferido para Conferência de Caixa."),setTimeout(()=>{const e=document.querySelector('input[placeholder*="Digite o valor"]');e&&(e.focus(),e.select())},100),setTimeout(()=>ae(null),3e3)},[y]),_e=e.useCallback(e=>{ve(e),Q(!1),G([])},[ve]),we=e.useCallback(()=>{Q(!1),G([]),K(!1)},[]),je=e.useCallback(e=>{const t=z.find(t=>t.conferredId===e);t&&(U(t=>t.filter(t=>t.conferredId!==e)),q(e=>{const r=new Set(e);return r.delete(t.id),r}),l.updateEntryStatus(t.id,t.value,"pending"))},[z,l]),Ne=e=>{h(e),te(null),ae(null)},ke=e=>{u(t=>({...t,conferenceValue:e}))},Ce=e.useCallback(e=>{if(e.remove)U(t=>t.filter(t=>t.conferredId!==e.conferredId)),l.removeEntry(e.id,e.value);else{const t={id:e.id,date:e.date,description:e.description,value:e.value,cpf:e.cpf||"",originalHistory:e.originalHistory,source:e.source,conferredAt:e.conferredAt,conferredId:e.conferredId};if(U(e=>[...e,t]),"manual_entry"===e.source){const t={id:e.id,operation_date:e.date,operation_type:"manual_entry",value:e.value,description:e.description,status:"active",source:"manual_entry",user_id:"default_user"};l.addEntry(t)}}},[l]);return X.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 to-black",children:[X.jsx("header",{className:"bg-gray-900 shadow-lg border-b border-gray-800",children:X.jsxs("div",{className:"px-4 sm:px-6 lg:px-8",children:[X.jsxs("div",{className:"flex justify-between items-center h-16",children:[X.jsxs("div",{className:"flex items-center",children:[X.jsx("img",{src:Se,alt:"Manipularium Logo",className:"h-8 w-auto drop-shadow-lg"}),X.jsx("h1",{className:"ml-3 text-xl font-semibold text-gray-100",children:"Manipularium - Sistema de Conferência"})]}),X.jsxs("div",{className:"flex items-center space-x-4",children:[X.jsx("span",{className:"text-sm text-gray-300",children:X.jsx("strong",{className:"text-gray-100",children:t?.username})}),X.jsxs("button",{onClick:a,className:"inline-flex items-center px-3 py-2 border border-gray-700 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-300 bg-gray-800 hover:bg-gray-700 hover:text-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-colors",children:[X.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Sair"]})]})]}),X.jsxs("div",{className:"flex space-x-1 border-t border-gray-800 pt-2",children:[X.jsx("button",{onClick:()=>Ne("launches"),className:"px-4 py-2 text-sm font-medium rounded-t-lg transition-colors "+("launches"===m?"bg-gray-800 text-gray-100 border-b-2 border-indigo-500":"text-gray-400 hover:text-gray-100 hover:bg-gray-800/50"),children:"Lançamentos"}),X.jsxs("button",{onClick:()=>Ne("banking"),className:"px-4 py-2 text-sm font-medium rounded-t-lg transition-colors "+("banking"===m?"bg-gray-800 text-gray-100 border-b-2 border-indigo-500":"text-gray-400 hover:text-gray-100 hover:bg-gray-800/50"),children:["Conferência Bancária",$&&X.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-indigo-600 text-white rounded-full",children:$.stats.totalRows-P.size})]}),X.jsxs("button",{onClick:()=>Ne("cash"),className:"px-4 py-2 text-sm font-medium rounded-t-lg transition-colors "+("cash"===m?"bg-gray-800 text-gray-100 border-b-2 border-indigo-500":"text-gray-400 hover:text-gray-100 hover:bg-gray-800/50"),children:["Conferência de Caixa",z.length>0&&X.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-green-600 text-white rounded-full",children:z.length})]}),X.jsx("button",{onClick:()=>Ne("relatorio-diario"),className:"px-4 py-2 text-sm font-medium rounded-t-lg transition-colors "+("relatorio-diario"===m?"bg-gray-800 text-gray-100 border-b-2 border-orange-500":"text-gray-400 hover:text-gray-100 hover:bg-gray-800/50"),children:"📊 Relatório Diário"}),X.jsx("button",{onClick:()=>Ne("actions"),className:"px-4 py-2 text-sm font-medium rounded-t-lg transition-colors "+("actions"===m?"bg-gray-800 text-gray-100 border-b-2 border-purple-500":"text-gray-400 hover:text-gray-100 hover:bg-gray-800/50"),children:"📝 Ações"}),X.jsx("button",{onClick:()=>Ne("backup"),className:"px-4 py-2 text-sm font-medium rounded-t-lg transition-colors "+("backup"===m?"bg-gray-800 text-gray-100 border-b-2 border-blue-500":"text-gray-400 hover:text-gray-100 hover:bg-gray-800/50"),children:"💾 Backup"})]})]})}),X.jsx("div",{className:"flex min-h-[calc(100vh-8rem)]",children:"launches"===m?X.jsx(ur,{currentDate:y?(()=>{try{const[e,t,r]=y.split("/");return new Date(parseInt(r),parseInt(t)-1,parseInt(e))}catch{return new Date}})():new Date,operationDate:y,onLaunchAdded:Ce,conferredItems:z}):"banking"===m?X.jsxs(X.Fragment,{children:[X.jsx("aside",{className:"w-80 bg-gray-900 border-r border-gray-800 sticky top-32 self-start",children:X.jsxs("div",{className:"p-4 space-y-4",children:[X.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[X.jsxs("h3",{className:"text-sm font-semibold text-gray-100 mb-3 flex items-center",children:[X.jsx("span",{className:"bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center mr-2 text-xs",children:"1"}),"Carregar Planilha"]}),X.jsxs("div",{className:"space-y-2",children:[X.jsx("input",{type:"file",id:"fileInput",accept:".xlsx,.xls,.csv",onChange:e=>{const t=e.target.files?.[0];t&&(f(t),j(null))},className:"hidden"}),X.jsx("label",{htmlFor:"fileInput",className:"block w-full px-3 py-2 text-sm text-gray-300 bg-gray-700 border border-gray-600 rounded-md cursor-pointer hover:bg-gray-600 transition-colors text-center",onClick:()=>{},children:x?`✅ ${x.name}`:"📁 Escolher arquivo"}),X.jsxs("div",{className:"flex space-x-2",children:[X.jsx("button",{onClick:async()=>{if(!x)return;if(x.size>52428800){const e=(x.size/1048576).toFixed(2);return j(`Arquivo muito grande: ${e}MB (máximo: 50MB)`),void n.error(`📁 Arquivo muito grande\n📊 Tamanho atual: ${e}MB\n⚠️ Tamanho máximo: 50MB\n💡 Reduza o arquivo ou divida em partes menores`,{duration:8e3})}const e=x.name.toLowerCase().substring(x.name.lastIndexOf("."));if(![".xlsx",".xls",".csv"].includes(e)){return j(`Tipo de arquivo não suportado: ${e}`),void n.error(`📄 Formato de arquivo não suportado\n❌ Arquivo atual: ${e}\n✅ Formatos aceitos: .xlsx, .xls, .csv\n🔄 Converta o arquivo para um formato suportado`,{duration:8e3})}if(0===x.size)return j("Arquivo vazio ou corrompido"),void n.error("📄 Arquivo vazio\n⚠️ O arquivo selecionado não tem conteúdo\n🔧 Verifique se o arquivo não está corrompido",{duration:6e3});const r=Date.now();c.current=new AbortController,i.startProcessing("parsing"),j(null);try{const e={signal:c.current.signal,timeout:6e4};i.updateStage("parsing","Lendo planilha...");const o=await s(x,y,e=>{i.updateProgress(e)},e);if(c.current?.signal.aborted)return;const l=Date.now()-r;if(o.parseResult.success){i.updateStage("indexing","Criando índices de busca...");const e=o.parseResult.data.map((e,t)=>({id:`row_${t}`,date:e.date,paymentType:e.paymentType,cpf:e.cpf,value:e.value,originalHistory:e.originalHistory,rowIndex:t,validationStatus:e.validationStatus,validationMessage:e.validationMessage,bankData:{date:e.date,description:e.originalHistory,value:e.value,documentNumber:e.cpf,transactionType:e.paymentType}})),r={success:o.parseResult.success,data:e,errors:o.parseResult.errors,warnings:o.parseResult.warnings,stats:o.parseResult.stats};R(r);const s=nt(e);V(s),i.updateStage("saving","Salvando no banco de dados...");try{const e={entries:o.normalizedEntries.map(e=>({source_id:e.source_id,day:e.day,document_number:e.document_number,date:e.date,description:e.description,value_cents:e.value_cents,value:e.value,transaction_type:e.transaction_type,balance:e.balance,status:e.status,source:"banking_upload"})),fileName:x.name,operationDate:y,uploadMode:v,userId:t?.username||"default_user"},r=await async function(e){Date.now();try{if(!e.entries||0===e.entries.length)throw new Error("Nenhuma entrada fornecida para salvar");if(!e.fileName||!e.operationDate)throw new Error("Dados obrigatórios ausentes (fileName ou operationDate)");const t=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Timeout: Transação do banco excedeu 60 segundos"))},6e4)}),r=bt.transaction("rw",[bt.bank_uploads,bt.bank_entries],async t=>{const r={day:e.operationDate,file_name:e.fileName,file_upload_date:(new Date).toISOString(),upload_mode:e.uploadMode,user_id:e.userId||"default_user",metadata:{totalEntries:e.entries.length,uploadTimestamp:Date.now()}},a=await t.table("bank_uploads").add(r),s=e.entries.map(t=>({...t,upload_id:Number(a),user_id:e.userId||"default_user",source:"banking_upload"})),n=await t.table("bank_entries").bulkAdd(s,{allKeys:!0});return{uploadId:Number(a),entryIds:n.map(e=>Number(e))}}),a=await Promise.race([r,t]);return Date.now(),{success:!0,data:a}}catch(w){Date.now();let t="UnknownError",r="Erro desconhecido ao salvar no banco de dados";if(w instanceof Error){const a=w.name,s=w.message.toLowerCase();"ConstraintError"===a||s.includes("constraint")?(t="ConstraintError",r="Dados duplicados ou inválidos detectados"):"VersionError"===a||s.includes("version")?(t="VersionError",r="Banco de dados desatualizado. Recarregue a página."):s.includes("database")||s.includes("indexeddb")?(t="DatabaseError",r="Erro de acesso ao banco de dados local"):r=w.message}return{success:!1,error:r,errorType:t}}}(e);r.success?n.success(`✅ Arquivo processado com sucesso!\n⏱️ Tempo: ${l}ms\n📊 ${o.parseResult.stats.totalRows} linhas processadas\n✔️ ${o.parseResult.stats.validRows} válidas`,{duration:5e3}):(!function(e,t=""){if(e.success)return;const r=t?`${t}: `:"";switch(e.errorType){case"ConstraintError":n.error(`${r}Dados duplicados ou inválidos detectados`);break;case"VersionError":n.error(`${r}Banco desatualizado. Recarregue a página.`);break;case"DatabaseError":n.error(`${r}Erro de acesso ao banco local`);break;default:n.error(`${r}${e.error||"Erro desconhecido"}`)}}(r,"Erro ao salvar no banco"),n.error(`⚠️ Dados processados mas erro ao salvar no banco\n📊 ${o.parseResult.stats.totalRows} linhas ainda disponíveis na tabela\n❌ ${r.error}`,{duration:8e3}))}catch(a){n.error("❌ Erro crítico no banco de dados\n📊 Dados processados e visíveis na tabela\n🔧 Verifique a configuração do banco",{duration:8e3})}}else{const e=o.parseResult.errors.join("\n");j(e),R(null),n.error(`❌ Erro no processamento da planilha\n📄 Verifique se o formato está correto\n🔍 ${o.parseResult.errors.length} erro(s) encontrado(s)`,{duration:8e3})}}catch(l){if(l instanceof DOMException){if("AbortError"===l.name)return;if("TimeoutError"===l.name){j("⏰ Timeout: Arquivo muito grande ou complexo"),n.error("⏰ Processamento interrompido por timeout\n📁 Arquivo muito grande ou complexo\n💡 Tente reduzir o tamanho ou simplificar os dados",{duration:1e4})}}else{const e=l instanceof Error?l.message:"Erro desconhecido ao processar arquivo";j(e),e.includes("XLSX")||e.includes("planilha")?n.error("📄 Erro no formato da planilha\n✅ Formatos suportados: .xlsx, .xls, .csv\n🔧 Verifique se o arquivo não está corrompido",{duration:8e3}):e.includes("network")||e.includes("fetch")?n.error("🌐 Erro de conexão\n🔄 Verifique sua conexão com a internet\n⚡ Tente novamente em alguns segundos",{duration:8e3}):e.includes("memory")||e.includes("heap")?n.error("💾 Erro de memória\n📁 Arquivo muito grande para o sistema\n📉 Tente um arquivo menor ou feche outras abas",{duration:8e3}):n.error(`❌ Erro inesperado no processamento\n🔍 ${e}\n🔄 Tente recarregar a página`,{duration:8e3})}R(null),o()}finally{c.current=null,i.stopProcessing()}},disabled:!x||i.isProcessing,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i.isProcessing?"Processando...":"Carregar"}),X.jsx("button",{onClick:be,className:"flex-1 px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Limpar"})]})]})]}),X.jsx(xt,{selectedFile:x,onDateSelected:(e,t)=>{b(e),_(t)}}),X.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[X.jsxs("h3",{className:"text-sm font-semibold text-gray-100 mb-3 flex items-center",children:[X.jsx("span",{className:"bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center mr-2 text-xs",children:"3"}),"Conferir Valor"]}),X.jsxs("div",{className:"space-y-2",children:[X.jsxs("div",{className:"relative",children:[X.jsx("input",{ref:B,id:"conference-value-input",type:"text",placeholder:"Digite o valor (ex: 123,45)",value:d.conferenceValue,onChange:e=>{return t=e.target.value,ke(t),te(null),void ae(null);var t},onKeyDown:e=>"Enter"===e.key&&!J&&he(),disabled:!$||J,...er("conference-value-input",ee),className:"w-full px-3 py-2 pr-20 text-sm text-gray-100 bg-gray-700 border rounded-md focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed "+(ee?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-600 focus:ring-indigo-500 focus:border-indigo-500")}),null!==oe&&X.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:X.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+(oe>0?"bg-green-900/50 text-green-400 border border-green-600":"bg-red-900/50 text-red-400 border border-red-600"),children:oe>0?`${oe} ${1===oe?"resultado":"resultados"}`:"Sem resultados"})})]}),X.jsx(Qt,{error:ee,fieldId:"conference-value-input"}),X.jsx("button",{onClick:he,disabled:!$||J||!d.conferenceValue.trim(),className:"w-full px-3 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:J?X.jsxs(X.Fragment,{children:[X.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[X.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),X.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Buscando..."]}):"OK"}),ee&&X.jsx("div",{className:"p-2 bg-red-900/20 border border-red-400 rounded-md",children:X.jsx("p",{className:"text-xs text-red-400",children:ee})}),re&&X.jsx("div",{className:"p-2 bg-green-900/20 border border-green-400 rounded-md",children:X.jsx("p",{className:"text-xs text-green-400",children:re})}),!$&&X.jsx("div",{className:"p-2 bg-gray-700 border border-gray-600 rounded-md",children:X.jsx("p",{className:"text-xs text-gray-400",children:"Carregue uma planilha para usar esta função"})}),X.jsx("button",{onClick:()=>{ne(!0)},className:"w-full px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Reiniciar dia atual"}),X.jsxs("button",{onClick:()=>g(!p),className:"w-full px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors flex items-center justify-between",children:[X.jsx("span",{children:"Histórico de valores não encontrados"}),X.jsxs("div",{className:"flex items-center space-x-2",children:[H.length>0&&X.jsx("span",{className:"px-2 py-1 text-xs bg-red-600 text-white rounded-full",children:H.length}),X.jsx("svg",{className:"w-4 h-4 transform transition-transform "+(p?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),p&&X.jsx("div",{className:"mt-2 p-2 bg-gray-900 rounded-md border border-gray-700 max-h-40 overflow-y-auto",children:0===H.length?X.jsx("p",{className:"text-xs text-gray-400",children:"Nenhum valor não encontrado"}):X.jsxs("div",{className:"space-y-2",children:[X.jsxs("div",{className:"flex justify-between items-center mb-2",children:[X.jsxs("span",{className:"text-xs font-medium text-gray-300",children:[H.length," valor(es) não encontrado(s)"]}),X.jsx("button",{onClick:()=>W([]),className:"text-xs text-red-400 hover:text-red-300 transition-colors",title:"Limpar histórico",children:"Limpar"})]}),H.map((e,t)=>X.jsxs("div",{className:"bg-gray-800 rounded p-2 border border-gray-600",children:[X.jsxs("div",{className:"flex justify-between items-start",children:[X.jsx("span",{className:"text-xs text-gray-200 font-mono",children:e.value}),X.jsx("span",{className:"text-xs text-red-400 bg-red-900/30 px-1 rounded",children:"Não encontrado"})]}),X.jsx("div",{className:"mt-1 text-xs text-gray-400",children:new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e.timestamp)})]},t))]})})]})]}),X.jsx(Wt,{onDataLoaded:e=>{S(e);const t=e.filter(e=>"cash_conference"===e.operation_type&&"conferred"===e.status).map(e=>({...e.metadata,conferredAt:(()=>{try{const t=e.conferred_at||e.operation_timestamp||"";return t?new Date(t):new Date}catch{return new Date}})(),conferredId:e.id||`hist-${e.operation_timestamp}`}));t.length>0&&(le(t),ue(!0),h("cash"))},onLookupMapBuilt:e=>{l.updateLookupMap(e)}})]})}),X.jsx("main",{className:"flex-1 bg-gray-950 p-6 min-h-[calc(100vh-8rem)] min-w-0",children:i.isProcessing?X.jsx("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 min-h-full p-8 flex items-center justify-center",children:X.jsxs("div",{className:"text-center",children:[X.jsxs("svg",{className:"animate-spin h-12 w-12 text-indigo-500 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[X.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),X.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),X.jsx("p",{className:"mt-4 text-gray-300",children:"Processando arquivo..."})]})}):w?X.jsx("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 min-h-full p-8",children:X.jsx("div",{className:"max-w-md mx-auto",children:X.jsx("div",{className:"bg-red-900/20 border border-red-400 rounded-md p-4",children:X.jsxs("div",{className:"flex",children:[X.jsx("div",{className:"flex-shrink-0",children:X.jsx("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:X.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),X.jsxs("div",{className:"ml-3",children:[X.jsx("h3",{className:"text-sm font-medium text-red-400",children:"Erro ao processar arquivo"}),X.jsx("div",{className:"mt-2 text-sm text-red-300",children:X.jsx("p",{style:{whiteSpace:"pre-line"},children:w})}),X.jsx("div",{className:"mt-4",children:X.jsx("button",{onClick:be,className:"px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Tentar novamente"})})]})]})})})}):$?X.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 min-h-[calc(100vh-12rem)] flex flex-col overflow-auto",children:[$.warnings.length>0&&X.jsx("div",{className:"bg-yellow-900/20 border-b border-yellow-700 p-4",children:X.jsxs("div",{className:"flex items-start",children:[X.jsx("svg",{className:"h-5 w-5 text-yellow-400 mt-0.5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:X.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),X.jsxs("div",{className:"ml-3 flex-1",children:[X.jsx("h3",{className:"text-sm font-medium text-yellow-400",children:"Avisos encontrados durante o processamento"}),X.jsxs("div",{className:"mt-2 text-xs text-yellow-300 max-h-20 overflow-y-auto",children:[$.warnings.slice(0,5).map((e,t)=>X.jsx("p",{children:e},t)),$.warnings.length>5&&X.jsxs("p",{className:"mt-1 font-semibold",children:["... e mais ",$.warnings.length-5," avisos"]})]})]})]})}),X.jsxs("div",{className:"space-y-4",children:[X.jsxs("div",{className:"flex justify-between items-center",children:[X.jsx("h3",{className:"text-lg font-medium text-gray-200",children:"Dados Bancários"}),X.jsx(Ht,{data:{banking:$?.data?.filter(e=>!P.has(e.id))||[]},prefix:"bancario",date:y,disabled:!$?.data?.length})]}),X.jsx(et,{parseResult:$,transferredIds:P})]})]}):X.jsx("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 min-h-full p-8",children:X.jsx("div",{className:"flex items-center justify-center h-full",children:X.jsxs("div",{className:"text-center",children:[X.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),X.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-300",children:"Conferência Bancária"}),X.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Carregue uma planilha para começar a conferir valores."})]})})})})]}):"actions"===m?X.jsx(Xt,{className:"flex-1"}):"backup"===m?X.jsx(Zt,{className:"flex-1",currentDate:y}):"relatorio-diario"===m?X.jsx("div",{className:"flex-1 p-6",children:X.jsxs("div",{className:"max-w-6xl mx-auto",children:[X.jsxs("div",{className:"mb-6",children:[X.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-2",children:"📊 Relatório Diário"}),X.jsxs("p",{className:"text-gray-400",children:["Resumo das operações do dia ",y]})]}),X.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[X.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[X.jsxs("div",{className:"flex items-center mb-4",children:[X.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg mr-3",children:X.jsx("svg",{className:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),X.jsxs("div",{children:[X.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Caixa"}),X.jsx("p",{className:"text-sm text-gray-400",children:"Dinheiro e moedas"})]})]}),X.jsxs("div",{className:"space-y-2",children:[X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-300",children:"Total conferido:"}),X.jsxs("span",{className:"text-green-400 font-medium",children:[z.length," item(s)"]})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-300",children:"Valor total:"}),X.jsx("span",{className:"text-green-400 font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z.reduce((e,t)=>e+(t.value||0),0))})]})]})]}),X.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[X.jsxs("div",{className:"flex items-center mb-4",children:[X.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg mr-3",children:X.jsx("svg",{className:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),X.jsxs("div",{children:[X.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Bancário"}),X.jsx("p",{className:"text-sm text-gray-400",children:"Transferências processadas"})]})]}),X.jsxs("div",{className:"space-y-2",children:[X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-300",children:"Total processado:"}),X.jsxs("span",{className:"text-blue-400 font-medium",children:[$?.stats?.totalRows||0," item(s)"]})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-300",children:"Transferidos:"}),X.jsxs("span",{className:"text-blue-400 font-medium",children:[P.size," item(s)"]})]})]})]}),X.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[X.jsxs("div",{className:"flex items-center mb-4",children:[X.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg mr-3",children:X.jsx("svg",{className:"w-6 h-6 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),X.jsxs("div",{children:[X.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Status"}),X.jsx("p",{className:"text-sm text-gray-400",children:"Resumo das operações"})]})]}),X.jsxs("div",{className:"space-y-2",children:[X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-300",children:"Data operação:"}),X.jsx("span",{className:"text-purple-400 font-medium",children:y})]}),X.jsxs("div",{className:"flex justify-between",children:[X.jsx("span",{className:"text-gray-300",children:"Arquivo carregado:"}),X.jsx("span",{className:"text-purple-400 font-medium",children:$?"✅ Sim":"❌ Não"})]})]})]})]}),X.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6",children:[X.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"📈 Resumo Visual"}),X.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[X.jsxs("div",{className:"bg-gray-900 rounded-lg p-4",children:[X.jsx("h4",{className:"text-md font-medium text-gray-300 mb-3",children:"Conferência de Caixa"}),X.jsx("div",{className:"space-y-2",children:X.jsxs("div",{className:"flex justify-between items-center",children:[X.jsx("span",{className:"text-sm text-gray-400",children:"Items conferidos"}),X.jsxs("div",{className:"flex items-center",children:[X.jsx("div",{className:"w-20 bg-gray-700 rounded-full h-2 mr-2",children:X.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:z.length>0?"100%":"0%"}})}),X.jsx("span",{className:"text-sm text-green-400 font-medium",children:z.length})]})]})})]}),X.jsxs("div",{className:"bg-gray-900 rounded-lg p-4",children:[X.jsx("h4",{className:"text-md font-medium text-gray-300 mb-3",children:"Processamento Bancário"}),X.jsx("div",{className:"space-y-2",children:X.jsxs("div",{className:"flex justify-between items-center",children:[X.jsx("span",{className:"text-sm text-gray-400",children:"Items processados"}),X.jsxs("div",{className:"flex items-center",children:[X.jsx("div",{className:"w-20 bg-gray-700 rounded-full h-2 mr-2",children:X.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:$?`${Math.min(100,P.size/$.stats.totalRows*100)}%`:"0%"}})}),X.jsx("span",{className:"text-sm text-blue-400 font-medium",children:$?`${P.size}/${$.stats.totalRows}`:"0/0"})]})]})})]})]})]}),X.jsxs("div",{className:"flex flex-wrap gap-3",children:[X.jsxs("button",{onClick:()=>h("banking"),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[X.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),"Ver Conferência Bancária"]}),X.jsxs("button",{onClick:()=>h("cash"),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[X.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),"Ver Conferência de Caixa"]}),X.jsxs("button",{onClick:()=>h("actions"),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[X.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Ver Histórico de Ações"]})]})]})}):X.jsxs(X.Fragment,{children:[X.jsx("aside",{className:"w-80 bg-gray-900 border-r border-gray-800 sticky top-32 self-start",children:X.jsx("div",{className:"p-4",children:X.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[X.jsxs("h3",{className:"text-sm font-semibold text-gray-100 mb-3 flex items-center",children:[X.jsx("svg",{className:"w-5 h-5 text-indigo-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Filtrar por Data"]}),X.jsxs("div",{className:"space-y-3",children:[X.jsxs("div",{children:[X.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Data específica"}),X.jsx("input",{ref:O,type:"date",value:d.selectedDate,onChange:e=>u(t=>({...t,selectedDate:e.target.value})),className:"w-full px-3 py-2 text-sm text-gray-100 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),X.jsx("button",{onClick:()=>{if(d.selectedDate)try{if(!d.selectedDate||"Invalid Date"===d.selectedDate)return void te("Data inválida selecionada.");const e=new Date(d.selectedDate+"T00:00:00"),t=Ye(e),r=z.filter(t=>{if(!t.conferredAt)return!1;const r=new Date(t.conferredAt);return!isNaN(r.getTime())&&r.toDateString()===e.toDateString()}),a=H.filter(t=>{if(!t.timestamp)return!1;const r=new Date(t.timestamp);return!isNaN(r.getTime())&&r.toDateString()===e.toDateString()}),s=r.length,n=a.length,o=r.reduce((e,t)=>e+t.value,0);if(0===s&&0===n)te(`Nenhum registro encontrado para ${t}.`),le([]),ue(!1);else{const e=[`Histórico de ${t}:`,`• ${s} conferências realizadas`,`• ${n} valores não encontrados`,o>0?`• Valor total: ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o)}`:""].filter(Boolean).join("\n");ae(e),setTimeout(()=>ae(null),5e3),le(r),ue(!0),s>0&&h("cash")}}catch(e){te("Erro ao carregar histórico. Verifique a data selecionada.")}else te("Selecione uma data para carregar o histórico.")},className:"w-full px-3 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors",children:"Aplicar Filtro"}),X.jsx("button",{onClick:()=>u(e=>({...e,selectedDate:""})),className:"w-full px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 transition-colors",children:"Limpar Filtro"})]}),X.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-700",children:[X.jsx("h4",{className:"text-xs font-medium text-gray-400 mb-3",children:"Resumo"}),X.jsxs("div",{className:"space-y-2",children:[X.jsxs("div",{className:"flex justify-between text-xs",children:[X.jsx("span",{className:"text-gray-400",children:"Total de itens:"}),X.jsx("span",{className:"text-gray-200 font-medium",children:z.length})]}),X.jsxs("div",{className:"flex justify-between text-xs",children:[X.jsx("span",{className:"text-gray-400",children:"Valor total:"}),X.jsx("span",{className:"text-green-400 font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z.reduce((e,t)=>e+t.value,0))})]}),z.length>0&&X.jsxs("div",{className:"flex justify-between text-xs",children:[X.jsx("span",{className:"text-gray-400",children:"Última conferência:"}),X.jsx("span",{className:"text-gray-200 font-medium",children:new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format([...z].sort((e,t)=>t.conferredAt.getTime()-e.conferredAt.getTime())[0].conferredAt)})]})]})]})]})})}),X.jsx("main",{className:"flex-1 bg-gray-950 p-6 min-h-[calc(100vh-8rem)] min-w-0",children:X.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 h-full",children:[de&&X.jsx("div",{className:"bg-indigo-900/20 border-b border-indigo-700 p-3",children:X.jsxs("div",{className:"flex items-center justify-between",children:[X.jsxs("div",{className:"flex items-center",children:[X.jsx("svg",{className:"w-4 h-4 text-indigo-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),X.jsxs("span",{className:"text-sm font-medium text-indigo-400",children:["Filtrado por: ",d.selectedDate&&Ye(d.selectedDate)]})]}),X.jsxs("span",{className:"text-xs text-indigo-300",children:[ce.length," registro(s)"]})]})}),X.jsxs("div",{className:"space-y-4",children:[X.jsxs("div",{className:"flex justify-between items-center",children:[X.jsx("h3",{className:"text-lg font-medium text-gray-200",children:"Conferência de Caixa"}),X.jsx(Ht,{data:{cash:de?ce:z},prefix:"caixa",date:y,disabled:0===(de?ce:z).length})]}),X.jsx(rt,{conferredItems:de?ce:z,onRemoveItem:je})]})]})})]})}),X.jsx(lt,{isOpen:Z,matches:Y,searchValue:Y.length>0?Y[0].value:0,onSelect:_e,onClose:we}),se&&X.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:X.jsx("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 p-6 max-w-md w-full mx-4",children:X.jsxs("div",{className:"flex items-start",children:[X.jsx("div",{className:"flex-shrink-0",children:X.jsx("svg",{className:"h-6 w-6 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),X.jsxs("div",{className:"ml-3 flex-1",children:[X.jsx("h3",{className:"text-lg font-medium text-gray-100 mb-2",children:"Confirmar Reinício"}),X.jsx("p",{className:"text-sm text-gray-300 mb-6",children:"Tem certeza que deseja reiniciar o dia atual? Todos os dados transferidos e históricos serão apagados."}),X.jsxs("div",{className:"flex space-x-3",children:[X.jsx("button",{onClick:()=>{U([]),q(new Set),W([]),ke(""),te(null),ae("Dia atual reiniciado com sucesso."),setTimeout(()=>ae(null),3e3),ne(!1),setTimeout(()=>{const e=document.querySelector('input[placeholder*="Digite o valor"]');e&&(e.focus(),e.select())},100)},className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-red-500 transition-colors",children:"Confirmar"}),X.jsx("button",{onClick:()=>{ne(!1)},className:"flex-1 px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-gray-500 transition-colors",children:"Cancelar"})]})]})]})})}),X.jsx(mr,{}),X.jsx(ar,{isVisible:k,onToggle:()=>C(!k)}),X.jsx(nr,{}),X.jsx(pr,{show:i.isProcessing,stage:i.stage,progress:i.progress,message:i.message,showStallWarning:i.showStallWarning,canCancel:i.canCancel,onCancel:ye})]})};class fr extends e.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null,errorInfo:null},this.handleReload=()=>{window.location.reload()},this.handleClearStorage=()=>{localStorage.clear(),window.location.reload()}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?X.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 to-black flex items-center justify-center p-4",children:X.jsx("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 p-6 max-w-2xl w-full",children:X.jsxs("div",{className:"flex items-start mb-4",children:[X.jsx("div",{className:"flex-shrink-0",children:X.jsx("svg",{className:"h-8 w-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:X.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),X.jsxs("div",{className:"ml-3 flex-1",children:[X.jsx("h1",{className:"text-xl font-semibold text-gray-100 mb-2",children:"Erro na Aplicação"}),X.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Ocorreu um erro inesperado. Isso pode ser causado por dados corrompidos no armazenamento local ou um problema na aplicação."}),!1,X.jsxs("div",{className:"flex space-x-3",children:[X.jsx("button",{onClick:this.handleReload,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500 transition-colors",children:"Recarregar Página"}),X.jsx("button",{onClick:this.handleClearStorage,className:"px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-gray-500 transition-colors",children:"Limpar Dados e Recarregar"})]}),X.jsx("p",{className:"mt-3 text-xs text-gray-400",children:"Se o problema persistir, entre em contato com o suporte técnico."})]})]})})}):this.props.children}}function yr(){const{user:t,isLoading:r}=pe(),a=function(){const[t,r]=e.useState({isInitialized:!1,isLoading:!0,usingIndexedDB:!1,error:null});return e.useEffect(()=>{let e=!0;return(async()=>{try{await zt.initialize(),e&&r({isInitialized:!0,isLoading:!1,usingIndexedDB:zt.isUsingIndexedDB(),error:null})}catch(t){e&&r({isInitialized:!1,isLoading:!1,usingIndexedDB:!1,error:t instanceof Error?t.message:"Unknown error"})}})(),()=>{e=!1}},[]),t}();if(r||a.isLoading)return X.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 to-black",children:X.jsxs("div",{className:"text-center",children:[X.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4"}),X.jsx("p",{className:"text-gray-400",children:r?"Carregando...":"Inicializando storage..."}),a.usingIndexedDB&&X.jsx("p",{className:"text-green-400 text-sm mt-2",children:"IndexedDB disponível"})]})});try{return X.jsxs(I,{children:[X.jsx(E,{path:"/",element:t?X.jsx(D,{to:"/dashboard",replace:!0}):X.jsx(ke,{})}),X.jsx(E,{path:"/dashboard",element:X.jsx(Ce,{children:X.jsx(xr,{})})}),X.jsx(E,{path:"*",element:X.jsx(D,{to:"/",replace:!0})})]})}catch(s){return X.jsxs("div",{className:"min-h-screen bg-red-900 text-white p-8",children:[X.jsx("h1",{children:"Application Error"}),X.jsxs("p",{children:["Error in routing: ",String(s)]}),X.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-700 rounded",children:"Reload"})]})}}function br(){return X.jsx(fr,{children:X.jsxs(he,{children:[X.jsx(yr,{}),X.jsx(m,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#1f2937",color:"#f3f4f6",border:"1px solid #374151"},success:{iconTheme:{primary:"#10b981",secondary:"#f3f4f6"}},error:{iconTheme:{primary:"#ef4444",secondary:"#f3f4f6"}}}})]})})}try{localStorage.getItem("app_error")&&localStorage.clear()}catch(_r){}const vr=document.getElementById("root");if(vr)try{J(vr).render(X.jsx(e.StrictMode,{children:X.jsx(T,{children:X.jsx(br,{})})}))}catch(wr){localStorage.setItem("app_error","true"),vr.innerHTML=`<div style="color: red; padding: 20px; font-family: monospace; background: #000;">\n      <h1>Application Error</h1>\n      <p>Failed to initialize the application.</p>\n      <pre>${String(wr)}</pre>\n      <button onclick="localStorage.clear(); window.location.reload();" style="padding: 10px; margin-top: 10px;">Clear Data and Reload</button>\n    </div>`}else document.body.innerHTML='<div style="color: red; padding: 20px; font-family: monospace;">Error: Root element not found</div>';
